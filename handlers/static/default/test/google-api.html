<!--
You are free to copy and use this sample in accordance with the terms of the
Apache license (http://www.apache.org/licenses/LICENSE-2.0.html)
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>
      Google Visualization API Sample
    </title>
    <script type="text/javascript">
    var URL = {"main":"/","host":"http://chains.my","public":"/public/","js":"/public/js/","img":"/public/img/","css":"/public/css/","html":"/public/html/","lang":"/public/lang/","mohawk":"/public/js/mohawk/","icons":"/public/img/icons/","home":"/","this":"/goals/","self":"/goals/","sso":"http://chains.my/api/login/"};
    
    var Mohawk = {
            version: '0.1',
            UI: {
                selection: false,
                selectables: []
            },
            
            Utils: {
            },
            
            DOM: {
            },
            
            url: URL.js,
            
            XHR: function () {
                var XHR = null;
                if (window.XMLHttpRequest) {
                    XHR = new XMLHttpRequest();
                } else if (window.ActiveXObject) {
                    XHR = new ActiveXObject('Microsoft.XMLHTTP');
                } else {
                    alert('XMLHttpRequest is disabled in your browser');
                    return false;
                }
                
                return XHR;
            }
        };
            
        var IE = typeof(window.ActiveXObject) != 'undefined';
        var FF = navigator.userAgent.match('Gecko') != null;
        var OPERA = typeof(window.opera) != 'undefined';
        var WEBKIT = navigator.userAgent.match('WebKit') != null;
        if (WEBKIT) {
            FF = false;
        }

        var BTN_LEFT = IE ? 1 : 0;
        var BTN_MIDDLE = IE ? 4 : 1;
        var BTN_RIGHT = 2;

        function is_scalar(variable) {
            return ['number', 'string', 'boolean'].has(typeof(variable));
        }

        function is_numeric(variable) {
            return (typeof(variable) == 'number') || (typeof(variable) == 'string' && variable * 1 + '' == variable);
        }

        function empty(variable) {
            if (variable === 0
                || variable === '0'
                || variable === ''
                || variable === false
                || variable === null
                || typeof(variable) == 'undefined') {
                return true;
            }
            
            if (variable instanceof Array) {
                return !variable.length;
            }
            
            if (variable instanceof Object) {
                return !variable.keys().length;
            }

            return false;
        };

        function extend(target, source, directly) {
            if (target.prototype && !directly) {
                extend(target.prototype, source);
            } else {
                /*if (typeof(target._b) == 'undefined') {
                    target._b = {};
                }*/
                for (var i in source) {
                   /* if (typeof(target[i]) != 'undefined') {
                        if (typeof(target._base[i]) == 'undefined') {
                            target._base[i] = target[i];
                        }
                    }*/
                    target[i] = source[i];
                }
            }
        };

        Function.prototype.parse = function () {
            //var source = this.toSource instanceof Function ? this.toSource() : this.toString().replace(new RegExp('\n', 'g'), ' ');
            var source = this.toSource instanceof Function ? this.toSource() : this.toString();
            // opera 9.5 does not work with '\\{(.*)\\}'
            // so instead we use \\{([^\x01]*)\\}
            // hope that \x01 character won't appear in code
            var regex = new RegExp('\\(?\\s*function\\s*([a-z$_][a-z$_0-9]*)?\\s*\\(\\s*([^\\)]*)\\s*\\)\\s*\\{([^\x01]*)\\}\\s*\\)?\\s*', 'img');
            var m = null;
            if (m = regex.exec(source)) {
                return {
                    name: m[1],
                    params: m[2].split(new RegExp('\\s*,\\s*')),
                    body: m[3]
                };
            } else {
                return null;
            }
        };

        var ObjectInterface = {
            exists: function (key) {
                return typeof(this[key]) != 'undefined';
            },
            
            get: function (key, default_value) {
                if (typeof(this[key]) != 'undefined') {
                    return this[key];
                } else {
                    return default_value ? default_value : '';
                }
            },

            has: function (value) {
                for (var i in this) {
                    if (value == this[i]) {
                        return true;
                    }
                }
                return false;
            },

            _key: function (value) {
                for (var i in this) {
                    if (value == this[i]) {
                        return i;
                    }
                }
                return false;
            },

            keys: function () {
                var keys = [];
                for (var i in this) {
                    if (typeof(Object.prototype[i]) == 'undefined') {
                        keys.push(i);
                    }
                }
                return keys;
            },
            
            values: function () {
                var values = [];
                var obj = this;
                obj.forEach(function () {
                    values.push(this);
                });
                return values;
            },

            forEach: function (action) {
                if (!action || !action.call) {
                    return;
                }
                for (var i in this) {
                    if (typeof(Object.prototype[i]) == 'undefined') {
                        var value = action.call(this[i], i, this[i]);
                        if (value === false) {
                            break;
                        }
                    }
                }
            },
            
            _clone: function() {
                var clone = {};
                var obj = this;
                this.forEach(function (key) {
                    clone[key] = obj[key];
                });
                return clone;
            }
        };

        var ArrayInterface = {
            keys: function () {
                var keys = [];
                for (var i in this) {
                    if (typeof(Object.prototype[i]) == 'undefined' && typeof(Array.prototype[i]) == 'undefined' ) {
                        keys.push(i);
                    }
                }
                return keys;
            },
            
            last: function () {
                return this.slice(-1)[0];
            },

            pull: function (value) {
                for (var i in this) {
                    if (value == this[i]) {
                        this.splice(i, 1);
                    }
                }
            },

            forEach: function (action) {
                for (var i = 0; i < this.length; i ++) {
                    var value = action.call(this[i], i, this[i]);
                    if (value === false) {
                        break;
                    }
                }
            },
            
            binSearch: function (value) {
                var l = 0;
                var r = this.length - 1;
                if (this[l] >= value) {
                    return l;
                }
                if (this[r] < value) {
                    return r + 1;
                }
                do {
                    var m = Math.round((r + l) / 2);
                    if (m == l || m == r || this[m] == value) {
                        break;
                    } else if (this[m] < value) {
                        l = m;
                    } else {
                        r = m;
                    }
                } while (true);
                return m;
            },
            
            intersect: function (array, sorted) {
                if (!sorted) {
                    this.sort();
                    array.sort();
                }
                var i = 0, j = 0;
                var unique = [];
                while (i < this.length && j < array.length) {
                    if (this[i] < array[j]) {
                        i ++;
                    } else if (this[i] > array[j]) {
                        j ++;
                    } else {
                        unique.push(this[i]);
                        i ++;
                        j ++;
                    }
                }
                return unique;
            },
            
            divide: function (num) {
                var length = Math.ceil(this.length / num);
                var chunks = [];
                for (var i = 0; i < num; i ++) {
                    chunks.push(this.slice(i * length, (i + 1) * length));
                }
                return chunks;
            }
        };

        Array.prototype._forEach = Array.prototype.forEach;
        extend(Object, ObjectInterface);
        extend(Array, ArrayInterface);

        Object.combine = function (keys, values) {
            var obj = {};
            for (var i = 0; i < keys.length; i ++) {
                obj[keys[i]] = values[i];
            }
            return obj;
        };

        Math._round = Math.round;
        var MathInterface = {
            sign: function (x) {
                return x == 0 ? 0 : (x > 0 ? 1 : -1);
            },

            rand: function (min, max) {
                if (!max) {
                    min = 0;
                    max = min;
                }
                return Math.round(Math.random() * (max - min)) + min;
            },
            
            round: function (num, precision) {
                if (!precision || precision < 0) {
                    return Math._round(num);
                } else {
                    var base = Math.pow(10, precision);
                    return Math._round(num * base) / base;
                }
            }
        };
        extend(Math, MathInterface);

        var NumberInterface = {
            toHex: function () {
                if (this == 0) {
                     return '0';
                }
                var hex = '';
                var digits = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F'];
                var d = this;
                var pow = Math.floor(Math.log(d) / Math.log(16));
                var base = Math.pow(16, pow);
                for (var i = pow; i >= 0; i --) {
                    var q = Math.floor(d / base);
                    d -= q * base;
                    hex += digits[q];
                    base /= 16;
                }
                return hex;
            }
        };
        extend(Number, NumberInterface);

        RegExp.quote = function (str) {
            var regexp = new RegExp('([\\<\\>\\/\\?\\.\\$\\^\\[\\]\\*\\+\\\\])', 'g');
            return str.replace(regexp, '\\$1');
        };

        var Class = function (object) {
            return this.extend(object);
        };

        var Singletone = function (object) {
            var class_interface = new Class(object);
            var instance = new class_interface();
            return instance;
        };

        Class.prototype = {
            self: null,
            parent: null,
            extend: function (descendant) {
                var child = Class.method(descendant.__construct || (this.prototype && this.prototype.__construct ? this.prototype.__construct : function () {}), 'Class.setSelf(this); var self = this.self; var parent = this.parent; this.static = arguments.callee; var static = this.static; ');

                // copy parent prototype
                var methods = descendant.keys();
                child.prototype.parent = {};
//                child.prototype.__base = child.prototype; // uncomment this line if you need base class

                for (var i in this.prototype) {
                    if (this.prototype[i] instanceof Function) {
                        child.prototype.parent[i] = Class.method(this.prototype[i]);
                    } else {
                        child.prototype.parent[i] = this.prototype[i];
                    }

                    if (i != 'parent') {
                        if (this.prototype[i] instanceof Function) {
                            child.prototype[i] = Class.method(this.prototype[i], !methods.has(i) ? 'if (parent && parent.parent) {parent = parent.parent};' + Class.label : '');
                        } else {
                            child.prototype[i] = this.prototype[i];
                        }
                    }
                }
                
                // copy static properties
                if (typeof(child.base) == 'undefined') {
                    child.base = {};
                }
                for (var i in this) {
                    if (typeof(child[i]) == 'undefined') {
                        child[i] = this[i];
                    }
                }        

                // copy child prototype
                for (var i in descendant) {
                    if (descendant[i] instanceof Function) {
                        child.prototype[i] = Class.method(descendant[i], 'var __function__ = "' + i + '"; var self = this.self; var parent = this.parent; var static = this.static; ' + Class.label + 'if (self) {try {parent.self = self} catch (e) {}}');
                    } else {
                        child.prototype[i] = descendant[i];
                    }
                }

                child.extend = this.extend;

                return child;
            }
        };

        Class.extend = Class.prototype.extend;
        Class.label = 'Class.here();';
        Class.here = function () {};
        Class.method = function (action, add) {
            var source = action.parse();
            var f = function () {};
            if (source) {
                if (source.body.indexOf(Class.label) > 0) {
                    source.body = source.body.replace(Class.label, add || '');
                } else {
                    source.body = (add || '') + source.body;
                }
                
                var str = 'f = function (' + source.params.join(',') + ') {var __line__=0;' + source.body + '};';
                
                //str = str.replace(new RegExp('\r\n', 'g'), '\n');
                //str = str.replace(new RegExp('\n', 'g'), '\r\n');
                eval(str);
            } else {
                // TODO: some error here
                f = false;
            }
            return f;
        };
        Class.setSelf = function (object) {
            var base = object;
            do {
                object.self = base;
                object = object.parent;
            } while (object && object.parent);
        };

        // onDOMContentLoaded simulation
        document.loaders = [];

        document.callLoaders = function () {
            if (document.loaded) {
                while (document.loaders.length) {
                    var loader = document.loaders.shift();
                    if (loader instanceof Function) {
                        loader.call(document);
                    }
                }
            }
        };

        if (FF) {
            document.addEventListener('DOMContentLoaded',
                function () {
                    document.loaded = true;
                    document.callLoaders.call(document);
                }, false
            );
        } else if (WEBKIT) {
            function callLoaders () {
                if (['loaded', 'complete'].has(document.readyState)) {
                    document.loaded = true;
                    document.callLoaders.call(document);
                } else {
                    setTimeout(callLoaders, 0);
                }
            }
            setTimeout(callLoaders, 0);
        } else {
            document.onreadystatechange = function () {
                if (['loaded', 'complete'].has(document.readyState)) {
                    document.loaded = true;
                    document.callLoaders();
                }
            };
        }

        document.addLoader = function (action) {
            if (document.loaded) {
                action.call(document);
            } else {
                if (!document.loaders.has(action)) {
                    document.loaders.push(action);
                }
            }
        };

        Mohawk.included = [];
        function include(path) {
            var first = path.substr(0, path.indexOf('.'));
            var url = Mohawk.url;
            if (typeof(URL[first]) != 'undefined') {
                url = URL[first];
                path = path.substr(path.indexOf('.') + 1);
            }
            var include_path = url + path.replace(new RegExp('\\.', 'g'), '/') + '.js';
            if (!Mohawk.included.has(include_path)) {
                // create XHR
                var XHR = Mohawk.XHR();
                XHR.open('GET', include_path + '?' + (new Date).valueOf(), false);
                XHR.setRequestHeader('Pragma', 'no-cache');
                XHR.setRequestHeader('Expires', '-1');
                XHR.send(null);
                eval(XHR.responseText);
                Mohawk.included.push(include_path);
                delete(XHR);
            }
        }

        include('mohawk.kernel.geom');
        include('mohawk.kernel.Template');
        include('mohawk.kernel.Effects');
        include('mohawk.kernel.DOM');
        include('mohawk.kernel.Loader');
        include('mohawk.kernel.Observer');

        var DOM = Mohawk.DOM;
        var Loader = Mohawk.Loader;
        var Template = Mohawk.Template;
        Template.assign('URL', URL);
        var Effects = Mohawk.Effects;
        var Observer = Mohawk.Observer;
    </script>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load('visualization', '1', {packages: ['corechart']});
    </script>
    <script type="text/javascript">
      function drawVisualization() {
        // Create and populate the data table.
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'x');
        data.addColumn('number', 'Cats');
        data.addColumn('number', 'Blanket 1');
        data.addColumn('number', 'Blanket 2');
        data.addRow(["A", 1, 1, 0.5]);
        data.addRow(["B", 2, 0.5, 1]);
        data.addRow(["C", 4, 1, 0.5]);
        data.addRow(["D", 8, 0.5, 1]);
        data.addRow(["E", 7, 1, 0.5]);
        data.addRow(["F", 7, 0.5, 1]);
        data.addRow(["G", 8, 1, 0.5]);
        data.addRow(["H", 4, 0.5, 1]);
        data.addRow(["I", 2, 1, 0.5]);
        data.addRow(["J", 3.5, 0.5, 1]);
        data.addRow(["K", 3, 1, 0.5]);
        data.addRow(["L", 3.5, 0.5, 1]);
        data.addRow(["M", 1, 1, 0.5]);
        data.addRow(["N", 1, 0.5, 1]);

        Array.prototype.mohawk_forEach = Array.prototype.forEach;
        Array.prototype.forEach = Array.prototype._forEach;
        
        // Create and draw the visualization.
        new google.visualization.LineChart(document.getElementById('visualization')).
            draw(data, {curveType: "function",
                        width: 500, height: 400,
                        vAxis: {maxValue: 10}}
                );
      }
      Array.prototype.forEach = Array.prototype.mohawk_forEach;

      google.setOnLoadCallback(drawVisualization);
    </script>
  </head>
  <body style="font-family: Arial;border: 0 none;">
    <div id="visualization" style="width: 500px; height: 400px;"></div>
  </body>
</html>
​