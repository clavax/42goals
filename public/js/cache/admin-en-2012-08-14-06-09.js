
var Mohawk={version:'0.1',UI:{selection:false,selectables:[]},Utils:{},DOM:{},url:URL.js,XHR:function(){var XHR=null;if(window.XMLHttpRequest){XHR=new XMLHttpRequest();}else if(window.ActiveXObject){XHR=new ActiveXObject('Microsoft.XMLHTTP');}else{alert('XMLHttpRequest is disabled in your browser');return false;}
return XHR;}};var IE=typeof(window.ActiveXObject)!='undefined';var FF=navigator.userAgent.match('Gecko')!=null;var OPERA=typeof(window.opera)!='undefined';var WEBKIT=navigator.userAgent.match('WebKit')!=null;if(WEBKIT){FF=false;}
var BTN_LEFT=IE?1:0;var BTN_MIDDLE=IE?4:1;var BTN_RIGHT=2;function extend(target,source,directly){if(target.prototype&&!directly){extend(target.prototype,source);}else{for(var i in source){target[i]=source[i];}}};Function.prototype.parse=function(){var source=this.toSource instanceof Function?this.toSource():this.toString();var regex=new RegExp('\\(?\\s*function\\s*([a-z$_][a-z$_0-9]*)?\\s*\\(\\s*([^\\)]*)\\s*\\)\\s*\\{([^\x01]*)\\}\\s*\\)?\\s*','img');var m=null;if(m=regex.exec(source)){return{name:m[1],params:m[2].split(new RegExp('\\s*,\\s*')),body:m[3]};}else{return null;}};function foreach(iterable,action){if(!action||!action.call){return;}
if(iterable instanceof Array||(typeof(iterable.length)=='number'&&(IE||typeof(iterable.item)=='function'))){for(var i=0;i<iterable.length;i++){var value=action.call(iterable[i],i,iterable[i]);if(value===false){break;}}}else if(iterable instanceof Object){for(var i in iterable){if(typeof(Object.prototype[i])=='undefined'){var value=action.call(iterable[i],i,iterable[i]);if(value===false){break;}}}}}
var ObjectInterface={combine:function(keys,values){var obj={};for(var i=0;i<keys.length;i++){obj[keys[i]]=values[i];}
return obj;},find:function(object,value){for(var i in object){if(value==object[i]){return i;}}
return false;},keys:function(object){var keys=[];for(var i in object){if(typeof(Object.prototype[i])=='undefined'){keys.push(i);}}
return keys;},values:function(object){var values=[];foreach(object,function(){values.push(this);});return values;},clone:function(object){var clone={};foreach(object,function(key){clone[key]=object[key];});return clone;}};var ArrayInterface={remove:function(array,value){var index=Array.find(array,value);if(index!==false){array.splice(index,1);}},find:function(array,value){for(var i=0;i<array.length;i++){if(value==array[i]){return i;}}
return false;},intersect:function(array1,array2,sorted){if(!sorted){array1.sort();array2.sort();}
var i=0,j=0;var unique=[];while(i<array1.length&&j<array2.length){if(array1[i]<array2[j]){i++;}else if(array1[i]>array2[j]){j++;}else{unique.push(array1[i]);i++;j++;}}
return unique;}};extend(Object,ObjectInterface,true);extend(Array,ArrayInterface,true);Math._round=Math.round;var MathInterface={sign:function(x){return x==0?0:(x>0?1:-1);},rand:function(min,max){if(!max){min=0;max=min;}
return Math.round(Math.random()*(max-min))+min;},round:function(num,precision){if(!precision||precision<0){return Math._round(num);}else{var base=Math.pow(10,precision);return Math._round(num*base)/base;}}};extend(Math,MathInterface);var NumberInterface={toHex:function(){if(this==0){return'0';}
var hex='';var digits=['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'];var d=this;var pow=Math.floor(Math.log(d)/Math.log(16));var base=Math.pow(16,pow);for(var i=pow;i>=0;i--){var q=Math.floor(d/base);d-=q*base;hex+=digits[q];base/=16;}
return hex;}};extend(Number,NumberInterface);RegExp.quote=function(str){var regexp=new RegExp('([\\<\\>\\/\\?\\.\\$\\^\\[\\]\\*\\+\\\\])','g');return str.replace(regexp,'\\$1');};var Class=function(object){return this.extend(object);};var Singletone=function(object){var class_interface=new Class(object);var instance=new class_interface();return instance;};Class.prototype={self:null,parent:null,extend:function(descendant){var child=Class.method(descendant.__construct||(this.prototype&&this.prototype.__construct?this.prototype.__construct:function(){}),'Class.setSelf(this); var self = this.self; var parent = this.parent; this.static = arguments.callee; var static = this.static; ');var methods=Object.keys(descendant);child.prototype.parent={};for(var i in this.prototype){if(this.prototype[i]instanceof Function){child.prototype.parent[i]=Class.method(this.prototype[i]);}else{child.prototype.parent[i]=this.prototype[i];}
if(i!='parent'){if(this.prototype[i]instanceof Function){child.prototype[i]=Class.method(this.prototype[i],Array.find(methods,i)===false?'if (parent && parent.parent) {parent = parent.parent};'+Class.label:'');}else{child.prototype[i]=this.prototype[i];}}}
if(typeof(child.base)=='undefined'){child.base={};}
for(var i in this){if(typeof(child[i])=='undefined'){child[i]=this[i];}}
for(var i in descendant){if(descendant[i]instanceof Function){child.prototype[i]=Class.method(descendant[i],'var __function__ = "'+i+'"; var self = this.self; var parent = this.parent; var static = this.static; '+Class.label+'if (self) {try {parent.self = self} catch (e) {}}');}else{child.prototype[i]=descendant[i];}}
child.extend=this.extend;return child;}};Class.extend=Class.prototype.extend;Class.label='Class.here();';Class.here=function(){};Class.method=function(action,add){var source=action.parse();var f=function(){};if(source){if(source.body.indexOf(Class.label)>0){source.body=source.body.replace(Class.label,add||'');}else{source.body=(add||'')+source.body;}
var str='f = function ('+source.params.join(',')+') {'+source.body+'};';eval(str);}else{f=false;}
return f;};Class.setSelf=function(object){var base=object;do{object.self=base;object=object.parent;}while(object&&object.parent);};document.loaders=[];document.callLoaders=function(){if(document.loaded){while(document.loaders.length){var loader=document.loaders.shift();if(loader instanceof Function){loader.call(document);}}}};if(FF){document.addEventListener('DOMContentLoaded',function(){document.loaded=true;document.callLoaders.call(document);},false);}else if(WEBKIT){function callLoaders(){if(Array.find(['loaded','complete'],document.readyState)!==false){document.loaded=true;document.callLoaders.call(document);}else{setTimeout(callLoaders,0);}}
setTimeout(callLoaders,0);}else{document.onreadystatechange=function(){if(Array.find(['loaded','complete'],document.readyState)!==false){document.loaded=true;document.callLoaders();}};}
document.addLoader=function(action){if(document.loaded){action.call(document);}else{if(Array.find(document.loaders,action)===false){document.loaders.push(action);}}};Mohawk.included=[];function include(path){var first=path.substr(0,path.indexOf('.'));var url=Mohawk.url;if(typeof(URL[first])!='undefined'){url=URL[first];path=path.substr(path.indexOf('.')+1);}
var include_path=url+path.replace(new RegExp('\\.','g'),'/')+'.js';if(Array.find(Mohawk.included,include_path)===false){var XHR=Mohawk.XHR();XHR.open('GET',include_path+'?'+(new Date).valueOf(),false);XHR.setRequestHeader('Pragma','no-cache');XHR.setRequestHeader('Expires','-1');XHR.send(null);eval(XHR.responseText);Mohawk.included.push(include_path);delete(XHR);}}
window.Pixel=new Class({x:0,y:0,__construct:function(x,y){if(typeof x!='undefined'){if(typeof y!='undefined'){self.x=x||0;self.y=y||0;}else{self.x=x.x;self.y=x.y;}}},inside:function(rect){return self.x>=rect.start.x&&self.x<=rect.end.x&&self.y>=rect.start.y&&self.y<=rect.end.y;},toString:function(){return[self.x,self.y].toString();}});window.Rect=new Class({start:null,end:null,__construct:function(start,end){if(start&&end){self.start=start;self.end=end;}else{self.start=new Pixel;self.end=new Pixel;}},toString:function(){return[self.start.toString(),self.end.toString()].toString();}});Rect.fromNode=function(node){var start=node.coordinates();return new Rect(start,new Pixel(start.x+node.offsetWidth,start.y+node.offsetHeight));}
Mohawk.Template=new Singletone({vars:{},keywords:['end','else'],assign:function(name,value){if(Array.find(self.keywords,name)!==false){alert(name+' is a keyword');}
self.vars[name]=value;},transform:function(text){var init='';foreach(self.vars,function(name){init+='var '+name+' = self.vars["'+name+'"];';});var variable='[a-z_][a-z_0-9]*(?:\\[[^\\]]*\\]|\\.[a-z_][a-z_0-9]*)*';var modifier='[a-z_][a-z_0-9]*(?:\\.[a-z_][a-z_0-9]*)*';var condition='[^\\}]+';text=text.replace(new RegExp('\"','g'),'\\\"');text=text.replace(new RegExp('\\n','g'),'\\n');text=text.replace(new RegExp('\\{%for\\s+('+variable+') in ('+variable+')\\}','gmi'),'"; for (var __k__ in $2) {'+'if (typeof Object.prototype[__k__] != \'undefined\' || typeof Array.prototype[__k__] != \'undefined\') continue; var $1 = $2[__k__]; __s__ += "');text=text.replace(new RegExp('\\{%for\\s+('+variable+') in ('+variable+')\\s+=>\\s+('+variable+')\\}','gmi'),'"; for (var $3 in $2) {'+'if (typeof Object.prototype[$3] != \'undefined\' || typeof Array.prototype[$3] != \'undefined\') continue; var $1 = $2[$3]; __s__ += "');text=text.replace(new RegExp('\\{%if\\s+('+condition+')\\}','gmi'),'"; if ($1) {__s__ += "');text=text.replace(new RegExp('\\{%elseif\\s+('+condition+')\\}','gmi'),'"; } else if ($1) {__s__ += "');text=text.replace(new RegExp('\\{%else\\}','gmi'),'"; } else { __s__ += "');text=text.replace(new RegExp('\\{%end\\}','gmi'),'"; } __s__ += "');text=text.replace(new RegExp('\\{%('+variable+')\\|('+modifier+')\\}','gmi'),'" + $2($1) + "');text=text.replace(new RegExp('\\{%('+variable+')\\}','gmi'),'" + $1 + "');eval(init+'__s__ = "'+text+'"');return __s__;}});Mohawk.NodeEffectInterface={show:function(effect){if(this.style.visibility=='hidden'){this.style.visibility='visible';if(effect instanceof Function){effect.call(this,this,this.show);}}},hide:function(effect){if(this.style.visibility!='hidden'){if(effect instanceof Function){effect.call(this,this,this.hide);}else{this.style.visibility='hidden';}}},display:function(effect,display){this.style.display=display?display:(this._display?this._display:'block');if(effect instanceof Function){effect.call(this,this,this.display);}},collapse:function(effect){if(this.style.display!='none'){if(effect instanceof Function){effect.call(this,this,this.collapse);}else{this._display=this.style.display;this.style.display='none';}}},toggleDisplay:function(effect){if(e.offsetWidth==0){this.display(effect);}else{this.collapse(effect);}},remove:function(effect){if(this.parentNode){if(effect instanceof Function){effect(this,this.remove);}else{this.parentNode.removeChild(this);}}},setOpacity:function(opacity){if(IE){if(this.tagName&&this.tagName.toUpperCase()=='IMG'&&this.src.match(/\.png$/)){this.style.filter='AlphaImageLoader(src="'+this.src+'", sizingMethod="scale") Alpha(Opacity="'+(opacity*100)+'")';}else{this.style.filter='Alpha(Opacity="'+(opacity*100)+'")';}}else{this.style.opacity=opacity;}},getOpacity:function(opacity){if(IE){}else{return this.style.opacity;}}};Mohawk.Effects=new Singletone({opacity_delay:10,opacity_step:0.025,blink_delay:100,blink_number:3,_stop:false,moving:null,opacity:function(object,start,end,finalize,current){self=Mohawk.Effects;if(typeof current=='undefined'){current=start;object._opacity=object.getOpacity();if(IE){object._filter=object.style.filter;}}
current+=self.opacity_step*Math.sign(end-start);object.setOpacity(current);if(Math.sign(end-start)!=0&&(Math.sign(end-start)==Math.sign(end-current)||!Math.sign(end-current))){setTimeout(function(){self.opacity(object,start,end,finalize,current);},self.opacity_delay);}else{object.setOpacity(end);if(finalize instanceof Function){finalize.call(object);}
object.setOpacity(object._opacity);if(IE){object.style.filter=object._filter;}}},appear:function(object,finalize){Mohawk.Effects.opacity(object,0,1,finalize);},vanish:function(object,finalize){Mohawk.Effects.opacity(object,1,0,finalize);},fold:function(object,finalize){var height=object.offsetHeight;var step=Math.floor(height/48);var _fold=function(){if(height<step||step<=0){object.style.height='0px';if(finalize instanceof Function){finalize.call();}
object.style.overflow='auto';object.style.height='auto';}else{height-=step;object.style.height=height+'px';setTimeout(_fold,1);}};object.style.overflow='hidden';_fold();},unfold:function(object,finalize){var height=0;var end=object.offsetHeight;var step=Math.floor(end/48);var _unfold=function(){if(end-height<step||step<=0){if(finalize instanceof Function){finalize.call();}
object.style.overflow='auto';object.style.height='auto';}else{height+=step;object.style.height=height+'px';setTimeout(_unfold,1);}};object.style.overflow='hidden';object.style.height='0px';_unfold();},strike:function(node,finalize){var html=node.innerHTML;var text=node.textContent||node.innerText;var del=DOM.element('DEL');var span=DOM.element('SPAN');var len=Math.ceil(text.length/5);var _strike=function(){if(text.length<=len){if(finalize instanceof Function){finalize.call();}
node.setHTML(html);}else{var str=text.substr(0,len);text=text.substr(len);del.innerHTML+=str;span.innerHTML=text;setTimeout(_strike,100);}};node.removeChildren();node.appendChild(del);node.appendChild(span);_strike();},blink:function(object,finalize,start,counter){self=Mohawk.Effects;if(typeof counter=='undefined'){counter=0;start=Array.find(['hidden','off'],object.style.visibility)!==false;}
counter++;if(counter<self.blink_number*2){object.style.visibility=(counter+start)%2?'hidden':'visible';setTimeout(function(){self.blink(object,finalize,start,counter)},self.blink_delay);}else{object.style.visibility=start?'visible':'hidden';if(finalize instanceof Function){finalize.call(object);}}},move:function(e,x,y,step_x,step_y,acc_x,acc_y,finalize,offset){var self=Mohawk.Effects;var cur_x=e.offsetLeft;var cur_y=e.offsetTop;if(!offset){var temp=document.createElement('DIV');temp.style.left='0px';temp.style.top='0px';temp.style.position='absolute';e.parentNode.appendChild(temp);offset=new Pixel(temp.offsetLeft,temp.offsetTop);temp.remove();}
if(!x&&x!==0){x=cur_x;}
if(!y&&y!==0){y=cur_y;}
if(!step_x){step_x=1;}
if(!step_y){step_y=1;}
if(!acc_x){acc_x=1;}
if(!acc_y){acc_y=1;}
self._move(e,x,y,step_x,step_y,acc_x,acc_y,finalize,offset);},_move:function(e,x,y,step_x,step_y,acc_x,acc_y,finalize,offset){var self=Mohawk.Effects;var cur_x=e.offsetLeft;var cur_y=e.offsetTop;var moved_x=false;if(Math.abs(cur_x-x)>=step_x){e.style.left=(cur_x+Math.sign(x-cur_x)*step_x)+'px';moved_x=true;}else{e.style.left=x-offset.x+'px';}
var moved_y=false;if(Math.abs(cur_y-y)>=step_y){e.style.top=(cur_y+Math.sign(y-cur_y)*step_y)+'px';moved_y=true;}else{e.style.top=y-offset.y+'px';}
if(moved_x||moved_y){self.moving=setTimeout(function(){self._move(e,x,y,step_x*acc_x,step_y*acc_y,acc_x,acc_y,finalize,offset);},1);}else{if(finalize instanceof Function){finalize.call(e);}}},stop:function(){clearTimeout(self.moving);},scrollTo:function(obj){var to=obj.coordinates().y;var from=document.scrollTop();var step=Math.abs(to-from)/10;var prev=0;var scroll=function(){var now=document.scrollTop();if(now==prev){return;}
if(Math.abs(to-now)<=step){window.scrollTo(0,to);}else{window.scrollBy(0,Math.sign(to-now)*step);setTimeout(scroll,1);}
prev=now;};scroll();}});Mohawk.EventInterface={preventDefault:function(){if(this.button==BTN_RIGHT){if(OPERA){no_ctmenu=window.no_ctmenu;if(!no_ctmenu){no_ctmenu=document.createElement('input');no_ctmenu.type='button';document.body.appendChild(no_ctmenu);}
no_ctmenu.style.position='fixed';no_ctmenu.style.top=this.clientY-2+'px';no_ctmenu.style.left=this.clientX-2+'px';no_ctmenu.style.width='5px';no_ctmenu.style.height='5px';no_ctmenu.style.opacity=0;no_ctmenu.style.zIndex=10000;}}
if(typeof this.returnValue!='undefined'){this.returnValue=false;}else{if(window._preventDefault instanceof Function){window._preventDefault.call(this);}}
return false;},stopPropagation:function(){if(typeof this.cancelBubble!='undefined'){this.cancelBubble=true;}else{if(window._stopPropagation instanceof Function){window._stopPropagation.call(this);}}
return false;},cursor:function(){var x=0,y=0;if(this.pageX||this.pageY){x=this.pageX;y=this.pageY;}else if(this.clientX||this.clientY){x=this.clientX+document.scrollLeft();y=this.clientY+document.scrollTop();}else if(this.screenX||this.screenY){x=this.screenX;y=this.screenY;}
return new Pixel(x,y);},wheel:function(){var delta=0;if(this.wheelDelta){delta=event.wheelDelta/120;}else if(this.detail){delta=-this.detail/3;}
return delta;},key:function(){return this.keyCode||this.which||null;},element:function(){return this.srcElement||this.currentTarget;}};if(window.Event){window._preventDefault=window.Event.prototype.preventDefault;window._stopPropagation=window.Event.prototype.stopPropagation;if(FF){delete(Mohawk.EventInterface.preventDefault);}
extend(window.Event,Mohawk.EventInterface);}
Mohawk.NodeClassInterface={getClasses:function(){return this.className?this.className.split(/\s+/):[];},hasClass:function(className){var classes=this.getClasses();for(var i=0;i<arguments.length;i++){if(Array.find(classes,arguments[i])!==false){return true;}}
return false;},addClass:function(className){if(!this.className.length){this.className=className;}else if(!this.hasClass(className)){this.className+=' '+className;}
for(var i=1;i<arguments.length;i++){if(!this.hasClass(arguments[i])){this.className+=' '+arguments[i];}}},removeClass:function(className){var classes=this.getClasses();for(var i=0;i<arguments.length;i++){Array.remove(classes,arguments[i]);}
this.className=classes.join(' ');},replaceClass:function(find,replace){var classes=this.getClasses();if((key=Array.find(classes,find))!==false){classes[key]=replace;this.className=classes.join(' ');}else{this.addClass(replace);}},flipClass:function(className){for(var i=0;i<arguments.length;i++){if(this.hasClass(arguments[i])){this.removeClass(arguments[i]);}else{this.addClass(arguments[i]);}}},copyClassesTo:function(element){var classes=this.getClasses();classes.forEach(function(){element.addClass(this);});},setClassesTo:function(element){element.className=this.className;}};Mohawk.NodeEventInterface={addEvent:function(event,action,useCapture){if(!useCapture){useCapture=false;}
if(this.addEventListener){this.addEventListener(event,action,useCapture);}else if(this.attachEvent){this.attachEvent('on'+event,action);}
return action;},removeEvent:function(event,action,useCapture){if(!useCapture){useCapture=false;}
if(this.removeEventListener){this.removeEventListener(event,action,useCapture);}else if(this.detachEvent){this.detachEvent('on'+event,action);}}};Mohawk.NodeStructureInterface={coordinates:function(){var x=0,y=0;var element=this;while(element){x+=element.offsetLeft;y+=element.offsetTop;element=element.offsetParent;}
return new Pixel(x,y);},isDescendantOf:function(node){var parent=this.parentNode;while(parent){if(parent==node){return true;}
parent=parent.parentNode;}
return false;},isAncestorOf:function(node){var parent=node.parentNode;while(parent){if(parent==this){return true;}
parent=parent.parentNode;}
return false;},removeChildren:function(){while(this.firstChild){this.removeChild(this.firstChild);}},firstTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.firstChild;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.nextSibling;}
return current;},nextTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.nextSibling;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.nextSibling;}
return current;},ancestorTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.parentNode;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.parentNode;}
return current;},previousTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.previousSibling;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.previousSibling;}
return current;},replace:function(node){this.parentNode.replaceChild(node,this);},insertFirst:function(node){this.insertBefore(node,this.firstChild);},insertAfter:function(node,before){this.insertBefore(node,before.nextSibling);},getElementsByClassName:function(class_name){var elements=this.getElementsByTagName('*');var found=[];for(var i=0;i<elements.length;i++){if(elements[i].hasClass&&elements[i].hasClass(class_name)){found.push(elements[i]);}}
return found;},getElementsByLang:function(lang){var elements=this.getElementsByTagName('*');var found=[];for(var i=0;i<elements.length;i++){if(elements[i].lang==lang){found.push(elements[i]);}}
return found;},setHTML:function(html){this.purgeChildren();this.innerHTML=html;Mohawk.DOM.enchaseDocumentNodes(this);},prependHTML:function(html){this.innerHTML=html+this.innerHTML;Mohawk.DOM.enchaseDocumentNodes(this);},appendHTML:function(html){this.innerHTML+=html;Mohawk.DOM.enchaseDocumentNodes(this);},purge:function(){this.parentNode.purgeChild(this);},purgeChild:function(node){var a=node.attributes,i,l,n;if(a){l=a.length;for(i=0;i<l;i+=1){n=a[i].name;if(node[n]instanceof Function){node[n]=null;}}}
if(node.purgeChildren instanceof Function){node.purgeChildren();}
this.removeChild(node);node=null;},purgeChildren:function(){while(this.firstChild){this.purgeChild(this.firstChild);}},setChild:function(node){this.purgeChildren();this.appendChild(node);},appendTo:function(node){node.appendChild(this);}};Mohawk.ElementOnlyInterface={getElementById:function(id){var elements=this.getElementsByTagName('*');var found=false;for(var i=0;i<elements.length;i++){if(elements[i].id==id){found=elements[i];break;}}
return found;}};Mohawk.NodePositionInterface={alignTo:function(node,side,absolute){switch(side){case'left':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+'px';break;case'right':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+node.offsetWidth-this.offsetWidth+'px';break;case'center':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+(node.offsetWidth-this.offsetWidth)/2+'px';break;case'top':this.style.top=(absolute?node.coordinates().y:node.offsetTop)+'px';break;case'bottom':this.style.bottom=(absolute?node.coordinates().y:node.offsetTop)+node.offsetHeight+'px';break;case'middle':this.style.top=(absolute?node.coordinates().y:node.offsetTop)+(node.offsetHeight-this.offsetHeight)/2+'px';break;}},adjoinTo:function(node,side,absolute){switch(side){case'left':this.style.right=(absolute?node.coordinates().x:node.offsetLeft)+'px';break;case'right':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+node.offsetWidth+'px';break;case'top':this.style.bottom=(absolute?node.coordinates().y:node.offsetTop)+'px';break;case'bottom':this.style.top=(absolute?node.coordinates().y:node.offsetTop)+node.offsetHeight+'px';break;}}};Mohawk.DOM=new Singletone({ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,DOCUMENT_NODE:9,enchaseNode:function(node){if(!node){return;}
if(IE&&typeof(HTMLGenericElement)!='undefined'&&node instanceof HTMLGenericElement){return;}
if(Array.find([self.ELEMENT_NODE,self.DOCUMENT_NODE],node.nodeType)===false){return;}
if(node._enchased instanceof Function&&node._enchased()===true){return;}
if(!node.nodeName||node.nodeName.match(/^(?:svg|OBJECT)/)){return;}
node._cloneNode=node.cloneNode;node.cloneNode=function(flag){var clone=this._cloneNode(flag);self.enchaseNode(clone);return clone;};switch(node.nodeName.toUpperCase()){case'TABLE':node._insertRow=node.insertRow;node.insertRow=function(index){var row=IE?this._insertRow(index):HTMLTableElement.prototype.insertRow.call(this,index);self.enchaseNode(row);return row;};node._createTHead=node.createTHead;node.createTHead=function(){var thead=IE?this._createTHead():HTMLTableElement.prototype.createTHead.call(this);self.enchaseNode(thead);return thead;};node._createTFoot=node.createTFoot;node.createTFoot=function(){var tfoot=IE?this._createTFoot():HTMLTableElement.prototype.createTFoot.call(this);self.enchaseNode(tfoot);return tfoot;};break;case'TR':node._insertCell=node.insertCell;node.insertCell=function(index){var cell=IE?this._insertCell(index):HTMLTableRowElement.prototype.insertCell.call(this,index);self.enchaseNode(cell);return cell;};break;case'FORM':if(typeof Mohawk.FormsInterface!='undefined'){extend(node,Mohawk.FormsInterface);}
break;}
extend(node,Mohawk.NodeClassInterface);extend(node,Mohawk.NodeEventInterface);extend(node,Mohawk.NodeStructureInterface);extend(node,Mohawk.NodePositionInterface);if(node.nodeType==self.ELEMENT_NODE){extend(node,Mohawk.ElementOnlyInterface);}
if(Mohawk.NodeEffectInterface instanceof Object){extend(node,Mohawk.NodeEffectInterface);}
node._enchased=function(){return true;};},enchaseDocument:function(){if(document._document_enchased){return;}
document._document_enchased=true;var createElement=document.createElement;document.createElement=function(tag_name){if(typeof Document=='undefined'){var element=createElement(tag_name);}else{var element=(Document.prototype.createElement||createElement).call(document,tag_name);}
self.enchaseNode(element);return element;};var getElementById=document.getElementById;document.getElementById=function(id){if(typeof Document=='undefined'){var element=getElementById(id);}else{var element=(Document.prototype.getElementById||getElementById).call(document,id);}
self.enchaseNode(element);return element;};document.scrollLeft=function(){return self.pageXOffset||(document.documentElement&&document.documentElement.scrollLeft)||(document.body&&document.body.scrollLeft);};document.scrollTop=function(){return self.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||(document.body&&document.body.scrollTop);};document.size=function(){var w=0,h=0;var win=window.window;if(win.self.innerHeight){w=win.self.innerWidth;h=win.self.innerHeight;}else if(win.document.documentElement&&win.document.documentElement.clientWidth){w=win.document.documentElement.clientWidth;h=win.document.documentElement.clientHeight;}else if(win.document.body){w=win.document.body.clientWidth;h=win.document.body.clientHeight;}
return{width:w,height:h};};extend(document,Mohawk.NodeEventInterface);extend(document,Mohawk.NodeStructureInterface);extend(document,Mohawk.NodePositionInterface);document._toHideOnClick=[];document.addEvent('click',function(){foreach(document._toHideOnClick,function(){this.hide();});});if(typeof document.defaultView=='undefined'){document.defaultView={};}
if(typeof document.defaultView.getComputedStyle=='undefined'){document.defaultView.getComputedStyle=function(element,pseudoElement){return element.currentStyle;};}},enchaseWindow:function(){if(window._window_enchased){return;}
window._window_enchased=true;extend(window,Mohawk.NodeEventInterface);},enchaseDocumentNodes:function(node){if(node){self.enchaseNode(node);}
self.enchaseNode(document.body);var all=(node||document.body).getElementsByTagName('*');if(all.forEach instanceof Function){foreach(all,function(){self.enchaseNode(this);});}else{for(var i=0;i<all.length;i++){self.enchaseNode(all[i]);}}}});Mohawk.DOM.element=function(tag_name,args){var element;if(tag_name.toUpperCase()=='INPUT'){if(IE&&!IE9){var str='<input';if(args){if(args.name!=undefined){str+=' name="'+args.name+'"';}
if(args.type!=undefined){str+=' type="'+args.type+'"';}}
str+='>';element=document.createElement(str);}else{element=document.createElement('INPUT');if(args){if(args.name!=undefined){element.name=args.name;}
if(args.type!=undefined){element.type=args.type;}}}}else if(tag_name.toUpperCase()=='BUTTON'){if(IE&&!IE9){var str='<button';if(args){if(args.name!=undefined){str+=' name="'+args.name+'"';}
if(args.type!=undefined){str+=' type="'+args.type+'"';}}
str+='>';element=document.createElement(str);}else{element=document.createElement('BUTTON');if(args){if(args.name!=undefined){element.name=args.name;}
if(args.type!=undefined){element.type=args.type;}}}}else{element=document.createElement(tag_name);}
if(args&&args instanceof Object){delete(args['name']);delete(args['type']);foreach(args,function(arg,value){if(arg=='className'){if(value instanceof Array){element.addClass.apply(element,value);}else{element.addClass(value);}}else if(arg=='html'){element.setHTML(value);}else if(arg=='appendTo'){element.appendTo(value);}else{element[arg]=value;}});}
return element;};Mohawk.DOM.text=function(text){return document.createTextNode(text);};Mohawk.DOM.event=function(event){event=event||window.event;extend(event,Mohawk.EventInterface);return event;};Mohawk.DOM.stopEvent=function(event){event=DOM.event(event);event.stopPropagation();};Mohawk.DOM.enchaseWindow();Mohawk.DOM.enchaseDocument();document.addLoader(function(){Mohawk.DOM.enchaseDocumentNodes();});window.ID=function(id){return document.getElementById(id);};Mohawk.Utils.IniParser=new Class({parse:function(source){source=source+'\n';var pos=0;var data={};var buffer='';var status=static.STAT_NL;var key='';while(pos<source.length){var cur=source.slice(pos,pos+1);switch(status){case static.STAT_NL:if(cur==';'){status=static.STAT_COM;}else if(cur.match(new RegExp('\\w'))){status=static.STAT_KEY;buffer+=cur;}else if(cur.match(new RegExp('\\s'))){}else{status=static.STAT_ERR;buffer='';}
break;case static.STAT_COM:case static.STAT_ERR:if(cur.match(new RegExp('\\r\\n|\\n|\\r'))){status=static.STAT_NL;}else{}
break;case static.STAT_KEY:if(cur.match(new RegExp('\\w'))){buffer+=cur;}else if(cur==' '||cur==' '){status=static.STAT_END_KEY;key=buffer;buffer='';}else if(cur=='='){status=static.STAT_VAL;key=buffer;buffer='';}else{status=static.STAT_ERR;key='';buffer='';}
break;case static.STAT_END_KEY:if(cur=='='){status=static.STAT_VAL;}else if(cur==' '||cur==' '){}else{status=static.STAT_ERR;key='';}
break;case static.STAT_VAL:if(cur==' '){if(buffer){buffer+=cur;}else{}}else if(cur.match(new RegExp('\\r\\n|\\n|\\r'))){status=static.STAT_NL;if(buffer){data[key]=buffer.rtrim();buffer='';}
key='';}else if(cur=='"'){status=static.STAT_STR;}else if(cur==';'){status=static.STAT_COM;if(buffer){data[key]=buffer;buffer='';}
key='';}else{buffer+=cur;}
break;case static.STAT_STR:if(cur=='"'){status=static.STAT_END_VAL;data[key]=buffer;}else if(cur=='\\'){status=static.STAT_ESC;}else{buffer+=cur;}
break;case static.STAT_ESC:status=static.STAT_STR;if(cur.match(new RegExp('["\\\\]'))){buffer+=cur;}else{buffer+='\\'+cur;}
break;case static.STAT_END_VAL:if(cur.match(new RegExp('\\r\\n|\\n|\\r'))){status=static.STAT_NL;data[key]=buffer;buffer='';key='';}else if(cur==';'){status=static.STAT_COM;data[key]=buffer;buffer='';key='';}else if(cur==' '||cur==' '){}else{status=static.STAT_ERR;buffer='';key='';}
break;default:self.error('Unknown status = '+status);}
if(typeof(Console)!=='undefined'){Console.log([cur,status,pos]);}
pos++;}
return data;},error:function(str){alert(str);}});Mohawk.Utils.IniParser.STAT_KEY='key';Mohawk.Utils.IniParser.STAT_VAL='value';Mohawk.Utils.IniParser.STAT_END_KEY='endkey';Mohawk.Utils.IniParser.STAT_END_VAL='endvalue';Mohawk.Utils.IniParser.STAT_STR='string';Mohawk.Utils.IniParser.STAT_ESC='escape';Mohawk.Utils.IniParser.STAT_COM='comment';Mohawk.Utils.IniParser.STAT_ERR='error';Mohawk.Utils.IniParser.STAT_NL='newline';var StringInterface={trim:function(){return this.rtrim().ltrim();},ltrim:function(){return this.replace(new RegExp('^\\s+'),'');},rtrim:function(){return this.replace(new RegExp('\\s+$'),'');},pad:function(length,chr,right){var str=this;var size=length-this.length;chr=chr||' ';for(var i=0;i<size;i++){str=right?str.concat(chr):chr.concat(str);}
return str;},ucfirst:function(){if(!this.length){return'';}
var first=this.slice(0,1);return first.toUpperCase()+this.slice(1,this.length);},htmlspecialchars:function(){var str=this.valueOf();str=str.replace(/&/g,'&amp;');str=str.replace(/</g,'&lt;');str=str.replace(/>/g,'&gt;');return str;},nl2br:function(){return this.replace(/\r\n|\n\r|\n|\r/g,'<br />');},wordwrap:function(width,str){var len=0;var wrapped='';if(str==undefined){str='\n';}
for(var i=0;i<this.length;i++){var char=this.substr(i,1);if(char.match(/\s/)){len=0;}else{len++;}
if(len>width){wrapped=wrapped.concat(str);len=1;}
wrapped=wrapped.concat(char);}
return wrapped;}};extend(String,StringInterface);Mohawk.Loader=new Singletone({css:[],css_default_url:URL.css+'mohawk/',addCss:function(url){if(!url.match(new RegExp('^(http://|/)','i'))){url=self.css_default_url+url;}
if(document.loaded){self.importCss(url);}else{if(Array.find(self.css,url)===false){self.css.push(url);}}},loadCss:function(){foreach(self.css,function(){self.importCss(this);});},importCss:function(src){var link=document.createElement('LINK');link.href=src;link.type='text/css';link.rel='stylesheet';document.getElementsByTagName('HEAD')[0].appendChild(link);},js:[],js_default_url:URL.home+'system/js/',addJs:function(url){url=url||'';if(!url.match(new RegExp('^(http://|/)','i'))){url=Mohawk.js_url+url;}
if(document.loaded){self.loadJs(url);}else{if(Array.find(self.js,url)===false){self.js.push(url);}}},loadJs:function(){foreach(self.js,self.importJs);},importJs:function(src){var script=DOM.element('script',{src:src,type:'text/javascript',appendTo:document.getElementsByTagName('HEAD')[0]});},extendLanguage:function(lng){foreach(Object.keys(lng),function(){var key=this.toString();var str=lng[key].toString();lng[key.ucfirst()]=str.ucfirst();lng[key.toUpperCase()]=str.toUpperCase();lng[key.toLowerCase()]=str.toLowerCase();});extend(window.LNG,lng);},includeLanguage:function(path){var include_path=URL.lang+ENV.language+'/'+path+'.ini';if(Array.find(Mohawk.included,include_path)===false){var XHR=Mohawk.XHR();XHR.open('GET',include_path+'?'+(new Date).valueOf(),false);XHR.send(null);try{var parser=new Mohawk.Utils.IniParser();var lng=parser.parse(XHR.responseText);self.extendLanguage(lng);}catch(e){if(Console){Console.describe(e);}}
Mohawk.included.push(include_path);delete(XHR);}},includeTemplate:function(path){var include_path=URL.html+path.replace(new RegExp('\\.','g'),'/')+'.tmpl';if(Array.find(Mohawk.included,include_path)===false){var XHR=Mohawk.XHR();XHR.open('GET',include_path+'?'+(new Date).valueOf(),false);XHR.send(null);var str=XHR.responseText;str=str.replace(new RegExp('"','g'),'\\"');str=str.replace(new RegExp('([\n\r]+)','g'),'" + "\\n');str='"'+str+'"';var name=path.substr(path.lastIndexOf('.')+1).toUpperCase();name=name.replace(new RegExp('\\W','g'),'_');eval('window.'+name+' = '+str);Mohawk.included.push(include_path);delete(XHR);}}});window.LNG={};document.addLoader(function(){Mohawk.Loader.loadCss();Mohawk.Loader.loadJs();});Mohawk.Observer=new Singletone({events:{},add:function(type,action){if(!(self.events[type]instanceof Array)){self.events[type]=[];}
self.events[type].push(action);},remove:function(type,action){if(self.events[type]instanceof Array){var source=action.toString();var i=0;while(i<self.events[type].length){if(self.events[type][i].toString()==source){self.events[type].splice(i,1);}else{i++;}}}},fire:function(type){if(!self.events[type]){return;}
var args=[];for(i=1;i<arguments.length;i++){args.push(arguments[i]);}
if(self.events[type]instanceof Array){foreach(self.events[type],function(){this.apply(null,args);});}}});var DOM=Mohawk.DOM;var Loader=Mohawk.Loader;var Template=Mohawk.Template;Template.assign('URL',URL);var Effects=Mohawk.Effects;var Observer=Mohawk.Observer;
Mohawk.Dragdrop=new Singletone({css_class:'draggable',max_index:1000,dragged:false,caller:null,target:{elements:[],x_boxes:{},x_delim:[],y_boxes:{},y_delim:[]},over:[],events:[],reset:function(){self.target={elements:[],x_boxes:{},x_delim:[],y_boxes:{},y_delim:[]};self.over=[];self.events=[];self.dragged=false;self.caller=null;},dragging:function(){return!!self.events.length;},binSearch:function(array,value){var l=0;var r=array.length-1;if(array[l]>=value){return l;}
if(array[r]<value){return r+1;}
do{var m=Math.round((r+l)/2);if(m==l||m==r||array[m]==value){break;}else if(array[m]<value){l=m;}else{r=m;}}while(true);return m;},createTargetObjectElement:function(target,element,i,last){self=Mohawk.Dragdrop;var n=target.elements.length;var box=Rect.fromNode(element[i]);var start_x=self.binSearch(target.x_delim,box.start.x);if(typeof target.x_boxes[box.start.x]=='undefined'){target.x_boxes[box.start.x]=typeof target.x_delim[start_x-1]!='undefined'&&typeof target.x_boxes[target.x_delim[start_x-1]]!='undefined'?target.x_boxes[target.x_delim[start_x-1]].concat([]):[];target.x_delim.splice(start_x,0,box.start.x);}
var end_x=self.binSearch(target.x_delim,box.end.x);if(typeof target.x_boxes[box.end.x]=='undefined'){target.x_boxes[box.end.x]=typeof target.x_boxes[target.x_delim[end_x-1]]!='undefined'?target.x_boxes[target.x_delim[end_x-1]].concat([]):[];target.x_delim.splice(end_x,0,box.end.x);}
for(var j=start_x;j<end_x;j++){if(typeof target.x_boxes[target.x_delim[j]]=='undefined'){target.x_boxes[target.x_delim[j]]=[];}
target.x_boxes[target.x_delim[j]].push(n);}
var start_y=self.binSearch(target.y_delim,box.start.y);if(typeof target.y_boxes[box.start.y]=='undefined'){target.y_boxes[box.start.y]=typeof target.y_delim[start_y-1]!='undefined'&&typeof target.y_boxes[target.y_delim[start_y-1]]!='undefined'?target.y_boxes[target.y_delim[start_y-1]].concat([]):[];target.y_delim.splice(start_y,0,box.start.y);}
var end_y=self.binSearch(target.y_delim,box.end.y);if(typeof target.y_boxes[box.end.y]=='undefined'){target.y_boxes[box.end.y]=typeof target.y_boxes[target.y_delim[end_y-1]]!='undefined'?target.y_boxes[target.y_delim[end_y-1]].concat([]):[];target.y_delim.splice(end_y,0,box.end.y);}
for(var j=start_y;j<end_y;j++){if(typeof target.y_boxes[target.y_delim[j]]=='undefined'){target.y_boxes[target.y_delim[j]]=[];}
target.y_boxes[target.y_delim[j]].push(n);}
var actions=['ondragover','ondragout','ondrop'];for(var k=0;k<actions.length;k++){var action=element[i][actions[k]]||element[i].getAttribute(actions[k]);try{element[i][actions[k]]=action instanceof Function?new Function(['event'],action.parse().body):false;}catch(e){}}
target.elements[n]=element[i];if(++i<element.length){setTimeout(function(){self.createTargetObjectElement(target,element,i,last);},0);}else if(last){}},createTargetObject:function(element){var target={elements:[],x_boxes:{},x_delim:[],y_boxes:{},y_delim:[]};for(var n=0;n<arguments.length;n++){self.createTargetObjectElement(target,arguments[n],0,n==arguments.length-1);}
return target;},setTarget:function(element){self.target=self.createTargetObject.call(self,arguments);},setTargetObject:function(object){self.target=object;},getDraggable:function(node){if(node.hasClass(self.css_class)){return node;}else{if(node.parentNode){return self.getDraggable(node.parentNode);}else{return null;}}},pick:function(event,elements){self=Mohawk.Dragdrop;event=DOM.event(event);var caller=event.currentTarget||event.srcElement;self.caller=caller;if(!elements||!elements.length){elements=[caller];}
document.addEvent('mousemove',self.drag);document.addEvent('mouseup',self.release);if(IE){document.body.focus();}
document.addEvent('selectstart',self.returnFalse);caller.addEvent('dragstart',self.returnFalse);document.addEvent('dragstart',self.returnFalse);document.body.onselectstart=self.returnFalse;self.events=[];var cur=event.cursor();foreach(elements,function(i){var action=this.onpick||this.getAttribute('onpick');if(action instanceof Function){var handler=new Function(['event'],action.parse().body);handler.call(this,event);}
var draggable=self.getDraggable(this);if(draggable){var evt={element:this,draggable:draggable,position:draggable.style.position||'static',offset:new Pixel(draggable.offsetLeft,draggable.offsetTop),start:new Pixel(cur.x,cur.y),ondrag:handler instanceof Function?handler:false};var actions=['ondrag','ondrop','onrelease'];for(var k=0;k<actions.length;k++){var action=this[actions[k]]||this.getAttribute(actions[k]);evt[actions[k]]=action instanceof Function?new Function(['event'],action.parse().body):false;}
self.events.push(evt);draggable.style.position='absolute';if(draggable.dragFront!==false){self.bringToFront(draggable);}}});event.stopPropagation();return false;},drag:function(event){self=Mohawk.Dragdrop;event=DOM.event(event);if(!self.dragged){document.removeEvent('mouseup',self.release);document.addEvent('mouseup',self.drop);}
self.dragged=true;var cur=event.cursor();for(var i=0;i<self.events.length;i++){var evt=self.events[i];var new_pix=new Pixel(evt.offset.x+cur.x-evt.start.x,evt.offset.y+cur.y-evt.start.y);var move=true;if(evt.ondrag){if(evt.ondrag.call(evt.element,event,new_pix)===false){move=false;}}
if(move){if(evt.draggable.dragX!==false){evt.draggable.style.left=new_pix.x+'px';}
if(evt.draggable.dragY!==false){evt.draggable.style.top=new_pix.y+'px';}}}
if(self.target.elements.length){var x_boxes=self.target.x_boxes[self.target.x_delim[self.binSearch(self.target.x_delim,cur.x)-1]];var y_boxes=self.target.y_boxes[self.target.y_delim[self.binSearch(self.target.y_delim,cur.y)-1]];if(x_boxes&&y_boxes){var boxes=Array.intersect(x_boxes,y_boxes,true);for(var z=0;z<boxes.length;z++){if(cur.inside(Rect.fromNode(self.target.elements[boxes[z]]))){if(Array.find(self.over,self.target.elements[boxes[z]])===false){self.over.push(self.target.elements[boxes[z]]);}
if(self.target.elements[boxes[z]].ondragover){self.target.elements[boxes[z]].ondragover.call(self.target.elements[boxes[z]],event);}}}}}
if(self.over.length){for(var i=0;i<self.over.length;i++){var over=self.over[i];var bound=Rect.fromNode(over);if(!cur.inside(bound)){if(over.ondragout){over.ondragout.call(over,event);}
Array.remove(self.over,over);}}}
return false;},drop:function(event){self=Mohawk.Dragdrop;event=Mohawk.DOM.event(event);document.removeEvent('mousemove',self.drag);document.removeEvent('mouseup',self.drop);self.caller.removeEvent('dragstart',self.returnFalse);document.removeEvent('selectstart',self.returnFalse);document.removeEvent('dragstart',self.returnFalse);document.body.onselectstart=null;var cur=event.cursor();if(self.over.length){for(var i=0;i<self.over.length;i++){var over=self.over[i];var bound=Rect.fromNode(over);if(cur.inside(bound)){if(over.ondrop){over.ondrop.call(over,event);}}}}
for(var i=0;i<self.events.length;i++){var evt=self.events[i];if(evt.ondrop){evt.element.ondrop.call(evt.element,event);}}
self.reset();},release:function(event){self=Mohawk.Dragdrop;event=Mohawk.DOM.event(event);document.removeEvent('mousemove',self.drag);document.removeEvent('mouseup',self.release);self.caller.removeEvent('dragstart',self.returnFalse);document.removeEvent('selectstart',self.returnFalse);document.removeEvent('dragstart',self.returnFalse);document.body.onselectstart=null;for(var i=0;i<self.events.length;i++){var evt=self.events[i];if(evt.element.onrelease){evt.element.onrelease.call(evt.element,event);}}
self.reset();},bringToFront:function(element){element.style.zIndex=self.max_index;self.max_index++;},getDragObjects:function(){var objects=[];for(var i=0;i<self.events.length;i++){objects.push(self.events[i].draggable);}
return objects;},returnFalse:function(){return false;}});window.Dragdrop=Mohawk.Dragdrop;Mohawk.UI.Console=new Class({element:null,content:null,hidden:true,__construct:function(){var element=DOM.element('div');element.addClass('console');self.element=element;var content=document.createElement('UL');element.appendChild(content);element.collapse();self.content=content;var btn_clear=document.createElement('A');btn_clear.href='#clear';btn_clear.innerHTML='clear';btn_clear.object=self;btn_clear.addClass('clear');btn_clear.onclick=function(){this.object.clear();return false;};self.element.appendChild(btn_clear);var btn_hide=document.createElement('A');btn_hide.href='#hide';btn_hide.innerHTML='hide';btn_hide.object=self;btn_hide.addClass('hide');btn_hide.onclick=function(){this.object.hide();return false;};self.element.appendChild(btn_hide);var form=document.createElement('FORM');form.action='#';form.history=[];form.current=0;form.onsubmit=function(){return false;};form.onclick=function(){form.elements[0].focus();};self.element.appendChild(form);var input=document.createElement('INPUT');input.history=[];input.current=0;input.onkeydown=function(event){event=DOM.event(event);switch(event.key()){case 38:if(this.current>0){this.current--;this.value=this.history[this.current];}
break;case 40:if(this.current<this.history.length-1){this.current++;this.value=this.history[this.current];}
break;case 13:try{var val=eval(this.value);self.log(val);}catch(e){self.log('Error occured: '+self.hash(e),'error');}
this.history.push(this.value);this.current=this.history.length;this.value='';return false;}};input.onfocus=function(){input.addClass('onfocus');};input.onblur=function(){input.removeClass('onfocus');};form.appendChild(input);self.input=input;},append:function(){document.body.appendChild(self.element);},log:function(text,type){var now=new Date;var line=document.createElement('LI');line.innerHTML=IE?'<pre>'+text+'</pre>':text;if(type){line.addClass(type);}
var date=document.createElement('SPAN');date.innerHTML=now.toLocaleString();line.appendChild(date);self.content.appendChild(line);self.content.scrollTop=self.content.scrollHeight;},log2:function(title,text){var line=self.content.lastChild?self.content.lastChild:document.createElement('LI');var p=document.createElement('P');var toggle=document.createElement('A');var container=document.createElement('DIV');p.innerHTML=title+': ';toggle.innerHTML='+';toggle.href='#toggle';toggle.onclick=function(){if(toggle.innerHTML=='+'){container.display();toggle.innerHTML='-';}else{container.collapse();toggle.innerHTML='+';}
return false;};container.collapse();container.innerHTML=text;line.appendChild(p);p.appendChild(toggle);line.appendChild(container);self.content.appendChild(line);self.content.scrollTop=self.content.scrollHeight;},error:function(text){self.log(text,'error');},clear:function(){self.content.removeChildren();},hide:function(){self.hidden=true;self.element.collapse();},show:function(){self.hidden=false;self.element.display();self.element.scrollTop=self.element.scrollHeight;self.input.focus();Mohawk.Dragdrop.bringToFront(self.element);},toggle:function(){if(self.hidden){self.show();}else{self.hide();}},hash:function(data){var hash='';switch(typeof data){case'object':if(data==null){hash+='NULL';}else{if(data.forEach){foreach(data,function(i){hash+='\n'+i+':'+this;});}else{for(var i in data){hash+='\n'+i+':'+data[i];};}}
break;case'function':hash+='\n'+i+'()';break;case'string':hash+='"'+data+'"';break;case'number':hash+=data;break;case'boolean':hash+=data?'TRUE':'FALSE';break;case'undefined':hash+='UNDEFINED';break;default:hash+=typeof data;}
return hash;},describe:function(data){self.log(self.hash(data));},regKey:function(){document.console=self;document.addEvent('keydown',function(event){event=DOM.event(event);if(event.ctrlKey){switch(event.key()){case 96:if(!OPERA){break;}
case 192:document.console.toggle();break;}}});},handleErrors:function(flag){try{if(flag=='undefined'){flag=true;}
if(flag){if(!window.Console){window.Console=self;}
window._onerror=window.onerror;window.onerror=function(message,url,line){window.Console.error(message+' (<a href="'+url+'">'+url+'</a> #'+line+')');return false;}}else{if(window._onerror instanceof Function){window.onerror=window._onerror;}}}catch(e){}}});document.addLoader(function(){window.Console=new Mohawk.UI.Console();window.Console.append();window.Console.regKey();window.Console.handleErrors(false);});Mohawk.UI.Progress=new Class({element:null,text:null,loading:false,__construct:function(){var element=document.createElement('DIV');element.id='progress';self.element=element;self.element.onmouseover=function(){if(!self.loading){self.element.collapse(Mohawk.Effects.vanish);}}
var text=document.createElement('P');element.appendChild(text);self.text=text;self.element.collapse();},appendTo:function(node){node.appendChild(self.element);},append:function(){self.appendTo(document.body);},load:function(text){self.element.display();Mohawk.Dragdrop.bringToFront(self.element);self.text.innerHTML=text;self.text.addClass('active');self.loading=true;},done:function(text,hide){self.element.display();Mohawk.Dragdrop.bringToFront(self.element);self.text.setHTML(text);self.text.removeClass('active');if(hide){self.element.collapse(Mohawk.Effects.vanish);}
self.loading=false;}});document.addLoader(function(){window.Progress=new Mohawk.UI.Progress;Progress.append();});window.Storage=new Class({name:'',data:null,__construct:function(name){self.name=name;try{var serialized=localStorage.getItem(name)||'[]';self.data=JSON.parse(serialized);}catch(e){self.data=[];}},insert:function(row){self.data.push(Object.clone(row));return self.data.length;},update:function(row,predicate){var rows_id=self.find(predicate);if(!rows_id){return null;}
return self.updateByIndex(row,rows_id);},updateByIndex:function(row,index){for(var i=0;i<index.length;i++){foreach(row,function(key,value){self.data[index[i]][key]=value?value.valueOf():null;});};return index;},remove:function(predicate){var rows_id=self.find(predicate);if(!rows_id){return null;}
return self.removeByIndex(rows_id);},removeByIndex:function(index){for(var i=0;i<index.length;i++){delete(self.data[index[i]]);};return index;},select:function(cols,predicate,order){if(predicate==undefined){predicate={};}
var rows_id=self.find(predicate);var rows=[];if(cols==undefined||cols=='*'){for(var i=0;i<rows_id.length;i++){rows.push(Object.clone(self.data[rows_id[i]]));};}else if(cols instanceof Array){for(var i=0;i<rows_id.length;i++){var row={};foreach(cols,function(){row[this]=self.data[rows_id[i]][this];});rows.push(Object.clone(row));};}else{for(var i=0;i<rows_id.length;i++){rows.push(self.data[rows_id[i]][cols]);};}
if(order!=undefined){rows.sort(function(a,b){a[order]>b[order];});}
return rows;},find:function(predicate){var id=[];for(var i=0;i<self.data.length;i++){if(self.data[i]==undefined){continue;}
if(self.match(self.data[i],predicate)){id.push(i);}}
return id;},isAny:function(predicate){for(var i=0;i<self.data.length;i++){if(self.data[i]==undefined){continue;}
if(self.match(self.data[i],predicate)){return true;}}
return false;},match:function(row,predicate){var result=false;if(predicate instanceof Array){foreach(predicate,function(key){result=self.match(row,this);return!result;});}else{result=true;foreach(predicate,function(key,value){if(row[key]==null){result=false;}else{var val=row[key].valueOf();if(value instanceof Array){result=Array.find(value,val)!==false;}else{result=value==val;}}
return result;});}
return result;},store:function(){var rows=[];for(var i=0;i<self.data.length;i++){if(self.data[i]!=undefined){rows.push(self.data[i]);}}
try{localStorage.setItem(self.name,JSON.stringify(rows));}catch(e){}}});window.PkStorage=Storage.extend({pk:'',__construct:function(name,pk){self.pk=pk;parent.__construct(name);},isAnyByPk:function(id){var cond={};cond[self.pk]=id;return self.isAny(cond);},removeByPk:function(id){var cond={};cond[self.pk]=id;self.remove(cond);},selectByPk:function(fields,id){var cond={};cond[self.pk]=id;var rows=self.select(fields,cond);if(!rows){return null;}
return rows[0];}});window.Revisions=new Storage('_revisions');Revisions.rev=0;window.StorageList={};window.RStorage=PkStorage.extend({__construct:function(name,pk){self.EVENT_PK_UPDATED='pk-updated-'+name;self.EVENT_ROW_REMOVED='row-removed-'+name;parent.__construct(name,pk);window.StorageList[name]=self;},foreignKey:function(field,table){Observer.add(table.EVENT_PK_UPDATED,function(tmp_id,new_id){var data={};data[field]=new_id;var cond={};cond[field]=tmp_id;self.updateByIndex(data,self.find(cond));});Observer.add(table.EVENT_ROW_REMOVED,function(id,rev){var cond={};cond[field]=id;self.remove(cond,rev);});},insert:function(row,rev){var id=parent.insert(row);var meta={type:self.name,id:row[self.pk],r:0,a:'+'};if(rev){meta.a=0;meta.r=rev;}
Revisions.insert(meta);return id;},update:function(row,predicate,rev){var rows_id=self.find(predicate);var meta_data={a:1};if(rev){meta_data.a=0;meta_data.r=rev;}
for(var i=0;i<rows_id.length;i++){var cond={type:self.name,id:self.data[rows_id[i]][self.pk]};var meta=Revisions.select('a',cond);if(meta[0]==0||rev){Revisions.update(meta_data,cond);}};return self.updateByIndex(row,rows_id);},updateByPk:function(data,id,rev){var cond={};cond[self.pk]=id;return self.update(data,cond,rev);},remove:function(predicate,rev){var rows_id=self.find(predicate);var id_set=[];for(var i=0;i<rows_id.length;i++){var id=self.data[rows_id[i]][self.pk];var cond={type:self.name,id:id};var meta=Revisions.select('a',cond);if(meta[0]=='+'){Revisions.remove(cond);}else{Revisions.update({a:'-'},cond);}
id_set.push(id);}
var result=self.removeByIndex(rows_id);if(rows_id.length){Observer.fire(self.EVENT_ROW_REMOVED,id_set,rev);}
return result;},removeByPk:function(id,rev){var cond={};cond[self.pk]=id;var result=self.remove(cond);if(rev){self.apply(id,rev);}
return result;},updatePk:function(tmp_id,new_id){Revisions.update({id:new_id},{type:self.name,id:tmp_id});var cond={};cond[self.pk]=tmp_id;var data={};data[self.pk]=new_id;self.parent.update(data,cond);Observer.fire(self.EVENT_PK_UPDATED,tmp_id,new_id);},apply:function(id,rev){var cond={type:self.name,id:id};var meta=Revisions.select('a',cond);try{if(meta[0]=='-'){Revisions.remove(cond);}else{Revisions.update({a:0,r:rev},cond);}}catch(e){Console.describe(e);}},store:function(){parent.store();Revisions.store();}});window.LocalSettings=new Singletone({Storage:null,__construct:function(){self.Storage=new PkStorage('local_settings','key');window.addEvent('unload',function(){LocalSettings.Storage.store();});},set:function(key,value){if(self.Storage.isAnyByPk(key)){self.Storage.update({value:value},{key:key});}else{self.Storage.insert({key:key,value:value});}},get:function(key){return self.Storage.selectByPk('value',key);}});Mohawk.FormsInterface={getData:function(){var data={};for(var i=0;i<this.elements.length;i++){var element=this.elements[i];if(element&&element.name){if(!element.disabled){switch(element.type){case'checkbox':case'radio':if(!element.checked){break;}
default:switch(element.tagName.toLowerCase()){case'select':if(element.multiple){if(element.name in data){if(!(data[element.name]instanceof Array)){data[element.name]=[data[element.name]];}}else{data[element.name]=[];}
for(var j=0;j<element.options.length;j++){if(element.options[j].selected){data[element.name].push(element.options[j].value);}}
break;}
default:if(element.name in data){if(!(data[element.name]instanceof Array)){data[element.name]=[data[element.name]];}
data[element.name].push(element.value);}else{data[element.name]=element.value;}}}}}}
return data;},setData:function(data,name){var form=this;var changed=[];if(typeof name=='undefined'){name='';}
function set_data(data,name,keys){if(data instanceof Object){if(data instanceof Array){for(var i=0;i<data.length;i++){set_data(data[i],name?name:i,name?(keys?keys.concat(i):[i]):[]);}}else{for(var i in data){if(typeof Object.prototype[i]!='undefined'){continue;}
set_data(data[i],name?name:i,name?(keys?keys.concat(i):[i]):[]);}}}else{var element_name=name+(keys.length?'['+keys.join('][')+']':'');if(typeof form[element_name]=='undefined'){element_name=name+(keys.length>1?'['+keys.slice(0,-1).join('][')+']':'')+'[]';if(typeof form[element_name]=='undefined'){return false;}}
var element=form[element_name];if(!element.length||element.tagName){element=[element];}
for(var i=0;i<element.length;i++){if(!element[i].tagName){continue;}
switch(element[i].tagName.toLowerCase()){case'select':if(element[i].multiple){for(var j=0;j<element[i].options.length;j++){if(element[i].options[j].value==data){element[i].options[j].selected=true;changed.push(element[i].options[j]);}else if(Array.find(changed,element[i].options[j])===false){element[i].options[j].selected=false;}}
break;}
case'input':if(element[i].type=='checkbox'||element[i].type=='radio'){if(element[i].value==data){element[i].checked=true;changed.push(element[i]);}else if(Array.find(changed,element[i])===false){element[i].checked=false;}
break;}
default:element[i].value=data;}
if(typeof(element[i].onchange)!='undefined'&&element[i].onchange instanceof Function){element[i].onchange();}}}
return true;}
set_data(data,name,[]);},createInput:function(type,name,value,options){switch(type){default:case'hidden':case'text':case'password':case'checkbox':if(IE&&!IE9){var input=document.createElement('<input name="'+name+'">');}else{var input=document.createElement('INPUT');input.name=name;}
input.type=type;input.value=value;break;case'textarea':if(IE&&!IE9){var input=document.createElement('<textarea name="'+name+'">');}else{var input=document.createElement('TEXTAREA');input.name=name;}
input.value=value;break;case'select':if(IE&&!IE9){var input=document.createElement('<select name="'+name+'">');}else{var input=document.createElement('SELECT');input.name=name;}
foreach(options,function(i,val){if(typeof(val)=='undefined'){return;}
var option=document.createElement('OPTION');option.value=val.value;option.innerHTML=val.text;if(value==option.value){option.selected=true;}
input.appendChild(option);});break;}
return input;}};window.FormsInterface=Mohawk.FormsInterface;Mohawk.XML=new Singletone({empty_elements:['br','img','link','meta','input','hr'],inline_elements:['a','abbr','acronym','b','basefont','bdo','big','br','cite','code','dfn','em','font','i','img','input','kbd','label','q','s','samp','select','small','span','strike','strong','sub','sup','textarea','tt','u','var','applet','button','del','iframe','ins','map','object','script'],toObject:function(node){switch(node.nodeType){case Mohawk.DOM.TEXT_NODE:case Mohawk.DOM.CDATA_SECTION_NODE:return node.nodeValue;case Mohawk.DOM.ELEMENT_NODE:var data=null;for(var i=0;i<node.attributes.length;i++){if(node.attributes[i].nodeName!='_key'){if(data===null){data={};}
data[node.attributes[i].nodeName]=node.attributes[i].nodeValue;}}
var allow_text_nodes=true;node.normalize();for(var i=0;i<node.childNodes.length;i++){var child=self.toObject(node.childNodes[i]);if(child instanceof Object){if(!(data instanceof Object)){data={};}
if(child.name in data){if(!(data[child.name]instanceof Array)){data[child.name]=[data[child.name]];}
data[child.name].push(child.content);}else if(node.childNodes[i].getAttribute('_key')!=null){data[child.name]=[child.content];}else{data[child.name]=child.content;}
allow_text_nodes=false;}else if(allow_text_nodes){data=child;}}
return{name:node.nodeName,content:data};case Mohawk.DOM.DOCUMENT_NODE:var data=self.toObject(node.documentElement);return data.content;default:Console.log('Cannot handle type: '+node.nodeType);}},parse:function(str){var xmldoc;if(window.DOMParser){parser=new DOMParser();xmldoc=parser.parseFromString(str,'text/xml');}else{xmldoc=new ActiveXObject('Microsoft.XMLDOM');xmldoc.async='false';xmldoc.loadXML(str);}
return self.toObject(xmldoc);},escape:function(str){str=str.replace('&','&amp;');var table={62:'gt',60:'lt',160:'nbsp',169:'copy',8212:'mdash',8482:'trade',8482:'trade',8222:'bdquo',171:'laquo',8220:'ldquo',8222:'lsaquo',8249:'lsquo',187:'raquo',8221:'rdquo',8250:'rsaquo',8217:'rsquo',8218:'sbquo'};foreach(table,function(code){str=str.replace(new RegExp(String.fromCharCode(code),'g'),'&'+this+';');});return str;},clean:function(str){str=str.replace(new RegExp('^[\\s]+','gm'),' ');str=str.replace(new RegExp('[\\s]+$','gm'),' ');return str;},toHtml:function(node,padding,pad_with,exclude_name,first){if(!padding){padding='\n';}
if(!pad_with){pad_with='\t';}
switch(node.nodeType){case Mohawk.DOM.TEXT_NODE:case Mohawk.DOM.CDATA_SECTION_NODE:var value=self.escape(node.nodeValue);value=self.clean(value);return value;case Mohawk.DOM.ELEMENT_NODE:var tag=node.nodeName.toLowerCase();var str='';if(!exclude_name){var str=(!first&&Array.find(self.inline_elements,tag)===false?padding:'')+'<'+tag;for(var i=0;i<node.attributes.length;i++){if(node.attributes[i].nodeValue==''||node.attributes[i].nodeValue==null){continue;}
if(node.attributes[i].nodeValue.toString().match(new RegExp('^(_moz|apple|contentEditable)','i'))){continue;}
if(node.attributes[i].nodeName.match(new RegExp('^(_moz|apple|contentEditable)','i'))){continue;}
var value=self.escape(node.attributes[i].nodeValue.toString());str+=' '+node.attributes[i].nodeName+'="'+value+'"';}
if(!node.childNodes.length&&Array.find(self.empty_elements,tag)!==false){str+=' />';}else{str+='>';}}
var padding_closing='';if(tag=='pre'){str+=node.innerHTML;}else{node.normalize();var padding_children=!exclude_name?padding+pad_with:padding;var first_child=true;for(var i=0;i<node.childNodes.length;i++){var child=node.childNodes[i];var value=self.toHtml(child,padding_children,pad_with,false,exclude_name&&first_child);str+=value;if(value){first_child=false;}
if(Array.find([Mohawk.DOM.TEXT_NODE,Mohawk.DOM.CDATA_SECTION_NODE],child.nodeType)===false&&child.nodeName&&Array.find(self.inline_elements,child.nodeName.toLowerCase())===false){padding_closing=padding;}}}
if(node.childNodes.length||Array.find(self.empty_elements,tag)===false){str+=!exclude_name?(padding_closing+'</'+tag+'>'):'';}
return str;case Mohawk.DOM.DOCUMENT_NODE:return self.toHtml(node.documentElement,padding,pad_with,exclude_name,not_first);default:return'XML: unsupported type of node '+node.nodeType;}}});window.XML=Mohawk.XML;Mohawk.Ajax=new Class({XHR:null,caller:null,url:'',method:'',overwrite_method:true,data:'',charset:'UTF-8',sync:true,xml:'',text:'',type:'',data:{},__construct:function(url,method){self.url=url;self.method=method||static.METHOD_GET;self.type=static.TYPE_XML;self.XHR=Mohawk.XHR();},responseHandler:function(){},errorHandler:function(){},send:function(data){if(typeof self.XHR=='object'){self.XHR.onreadystatechange=function(){self.procedure.apply(self);};self.method=self.method.toUpperCase()
switch(self.method){default:case static.METHOD_GET:var url_with_data=self.url+(self.url.match(new RegExp('\\?'))?'&':'?')+static.prepare(data);self.XHR.open(static.METHOD_GET,url_with_data,self.sync);var get=true;break;case static.METHOD_POST:case static.METHOD_PUT:case static.METHOD_DELETE:case static.METHOD_OPTIONS:case static.METHOD_HEAD:self.XHR.open(self.overwrite_method?static.METHOD_POST:self.method,self.url,self.sync);var get=false;break;}
self.XHR.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset='+self.charset);self.XHR.setRequestHeader('X-Request-Method',self.method);self.XHR.setRequestHeader('Accept',self.type);if(get){if(window.XMLHttpRequest){self.XHR.send(null);}else{self.XHR.send();}}else{var query=static.prepare(data);self.XHR.send(query);}
if(window.Console){var hash=window.Console.hash(data);hash=hash.replace(new RegExp('<','g'),'&lt;');hash=hash.replace(new RegExp('>','g'),'&gt;');var report='Ajax query : '+self.method+' <a href="'+self.url+'">'+self.url+'</a><br />'
+'Data: <pre>'+hash+'</pre>'
+'Query: '+query;window.Console.log(report);}}else{self.error('XMLHttpRequest is not initialized');}},procedure:function(){var error=false;switch(self.XHR.readyState){case static.STATE_UNINITIALIZED:break;case static.STATE_LOADED:if(self.XHR.status==static.HTTP_OK){if(self.XHR.responseXML){self.xml=self.XHR.responseXML;}else{if(self.type==static.TYPE_XML&&self.errorHandler instanceof Function){error=true;self.errorHandler.call(self);}}}else{if(self.errorHandler instanceof Function){error=true;self.errorHandler(self);}}
self.text=self.XHR.responseText;if(window.Console){var data=self.XHR.responseText;data=data.replace(new RegExp('<','g'),'&lt;');data=data.replace(new RegExp('>','g'),'&gt;');var report='Ajax query received from: <a href="'+self.url+'">'+self.url+'</a>';window.Console.log(report);window.Console.log2('Data',data);}
switch(self.type){case static.TYPE_JSON:eval('self.data = '+self.text);break;case static.TYPE_XML:self.data=Mohawk.XML.toObject(self.xml);break;}
if(!error){self.responseHandler(self);}
break;default:}},error:function(message){if(window.Console){window.Console.log(message,'error');}}});Mohawk.Ajax.HTTP_OK=200;Mohawk.Ajax.HTTP_NOT_FOUND=404;Mohawk.Ajax.STATE_UNINITIALIZED=0;Mohawk.Ajax.STATE_OPEN=1;Mohawk.Ajax.STATE_SENT=2;Mohawk.Ajax.STATE_RECEIVING=3;Mohawk.Ajax.STATE_LOADED=4;Mohawk.Ajax.METHOD_GET='GET';Mohawk.Ajax.METHOD_POST='POST';Mohawk.Ajax.METHOD_PUT='PUT';Mohawk.Ajax.METHOD_DELETE='DELETE';Mohawk.Ajax.METHOD_HEAD='HEAD';Mohawk.Ajax.METHOD_OPTIONS='OPTIONS';Mohawk.Ajax.TYPE_XML='text/xml';Mohawk.Ajax.TYPE_JSON='text/json';Mohawk.Ajax.TYPE_TEXT='text/text';Mohawk.Ajax.escape=function(str){if(typeof str=='string'){if(OPERA){str=str.replace(new RegExp('\r','g'),'');}
str=str.replace(new RegExp('%','g'),'%'+'25');str=str.replace(new RegExp('\n','g'),'%'+'0A');str=str.replace(new RegExp('\r','g'),'%'+'0D');str=str.replace(new RegExp('&','g'),'%'+'26');str=str.replace(new RegExp('#','g'),'%'+'23');str=str.replace(new RegExp('\\+','g'),'%'+'2B');}
return str;};Mohawk.Ajax.prepare=function(data,prefix){var query='';switch(typeof data){case'object':if(data instanceof Array){for(var i=0;i<data.length;i++){if(typeof Array.prototype[i]!='undefined'){continue;}
query+=(query.length?'&':'');switch(typeof data[i]){case'object':query+=Mohawk.Ajax.prepare(data[i],prefix?prefix+'['+i+']':i);break;case'string':case'number':case'boolean':query+=(prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'[]':'')+'=':i+'=')+Mohawk.Ajax.prepare(data[i],prefix?prefix+'['+i+']':i);break;}}}else{for(var i in data){if(typeof Object.prototype[i]!='undefined'){continue;}
query+=(query.length?'&':'');switch(typeof data[i]){case'object':if(data[i]==null){query+=prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'['+i+']':'')+'=':i+'=';}else{query+=Mohawk.Ajax.prepare(data[i],prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'['+i+']':''):i);}
break;case'string':case'number':case'boolean':query+=(prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'['+i+']':'')+'=':i+'=')+Mohawk.Ajax.prepare(data[i],prefix?prefix+'['+i+']':i);break;}}}
break;case'string':case'number':case'boolean':query=prefix?Mohawk.Ajax.escape(data):data;break;}
return query;};Mohawk.Ajax.parse_url=function(url){var chunks=url.split('&');var data={};foreach(chunks,function(){var tuple=this.split('=');var m;if(m=tuple[0].match(new RegExp('([a-z][a-z_0-9]*)((?:\\[[a-z_0-9]*\\])*)','i'))){var rec=data;var last=m[1].toString();if(m[2]){var keys=m[2].slice(1,-1).split('][');keys.unshift(m[1]);last=keys.pop();var prev_rec,prev_key;foreach(keys,function(){var key=this.toString();if(!(rec[key]instanceof Object)){rec[key]={};}
prev_rec=rec;prev_key=key;rec=rec[key];});}
if(last==''){if(!(rec instanceof Array)){prev_rec[prev_key]=[];}
prev_rec[prev_key].push(tuple[1]);}else{rec[last]=tuple[1];}}});return data;};window.Ajax=Mohawk.Ajax;window.TemplatesApi=new Class({add:function(data){var req=new Ajax(URL.home+'api/templates/',Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.item){self.addIcons(req.data.icon);Observer.fire('template-added',req.data.item);Progress.done(LNG.Saved,true);}else{self.showErrors(Templates.Form,req.data.error);Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},edit:function(id,data){var req=new Ajax(URL.home+'api/templates/'+id+'/',Ajax.METHOD_PUT);req.responseHandler=function(req){if(req.data.item){self.addIcons(req.data.icon);Observer.fire('template-edited',req.data.item);Progress.done(LNG.Saved,true);}else{self.showErrors(Templates.Form,req.data.error);Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},addIcons:function(icons){if(icons){if(icons.id){icons=[icons];}
foreach(icons,function(i,icon){Data.icons[icon.id]=icon.src;});}},showErrors:function(form,error){foreach(error,function(name){var input=form.element[name];if(!input){return true;}
var error=input.nextTag('B');if(!error){error=document.createElement('B');error.addClass('error');input.parentNode.insertAfter(error,input);}
error.innerHTML=this;});},remove:function(id){if(!confirm(LNG.Confirm_delete)){return;}
var req=new Ajax(URL.home+'api/templates/'+id+'/',Ajax.METHOD_DELETE);req.responseHandler=function(req){if(req.data.item){var item=req.data.item;Observer.fire('template-removed',item);Progress.done(LNG.Deleted,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send();Progress.load(LNG.Deleting);},sort:function(){var items=Templates.List.element.childNodes;var pos=0;var data=[];for(var i=0;i<items.length;i++){pos++;if(!items[i].data){continue;}
data.push({id:items[i].data.id,position:pos});}
var req=new Ajax(URL.home+'api/templates/',Ajax.METHOD_PUT);req.responseHandler=function(req){var item=req.data.item;if(item){if(item.id){item=[item];}
Observer.fire('templates-sorted',item);Progress.done(LNG.Saved,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);}});window.CategoriesApi=new Class({add:function(data){var req=new Ajax(URL.home+'api/categories/',Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.item){Observer.fire('category-added',req.data.item);Progress.done(LNG.Saved,true);}else{Progress.done('Error');}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},edit:function(id,data){var req=new Ajax(URL.home+'api/categories/'+id+'/',Ajax.METHOD_PUT);req.responseHandler=function(req){if(req.data.item){Observer.fire('category-edited',req.data.item);Progress.done(LNG.Saved,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},remove:function(id){if(!confirm('Delete? There is NO undo')){return;}
var req=new Ajax(URL.home+'category/categories/'+id+'/',Ajax.METHOD_DELETE);req.responseHandler=function(req){if(req.data.item){var item=req.data.item;Observer.fire('category-removed',item);Progress.done('Deleted',true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send();Progress.load('Deleting');},create:function(){Categories.Form.set();},sort:function(){var pos=0;var data=[];var nodes=Templates.Categories.element.childNodes;for(var i=0;i<nodes.length;i++){if(nodes[i].cloned){continue;}
pos++;data.push({id:nodes[i].data.id,position:pos});}
var req=new Ajax(URL.home+'api/categories/',Ajax.METHOD_PUT);req.responseHandler=function(req){if(req.data.ok){Progress.done(LNG.Saved,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);}});Mohawk.UI.List=new Class({id:'',element:null,onchange:function(){},__construct:function(id,structure){self.id=id;self.element=document.createElement('UL');self.element.id=id;self.element.object=self;self.setChildren(structure);},setChildren:function(structure){self.element.removeChildren();for(var i=0;i<structure.length;i++){self.addNode(structure[i]);}},createNode:function(data){var node=document.createElement('LI');node.id=self.getId(data.id);node.data=data;node.parent=self.element;node.innerHTML=data.title;node.getId=function(){return this.id;};node.isLast=function(){return node.hasClass('last');};node.setLast=function(){node.addClass('last');};node.notLast=function(){node.removeClass('last');};node.onmouseover=function(event){node.addClass('over');};node.onmouseout=function(event){node.removeClass('over');};return node;},getId:function(id){return self.id+'-'+id;},getNode:function(id){var node=null;var id=self.getId(id);if(self.element.parentNode){node=ID(id);}else{for(var i=0;i<self.element.childNodes.length;i++){if(self.element.childNodes[i].id==id){node=self.element.childNodes[i];break;}}}
return node;},addNode:function(data){var node=self.createNode(data);self.element.appendChild(node);if(node.previousSibling){node.previousSibling.notLast();}
node.setLast();return node;},editNode:function(node,data){var node_data=node.data;foreach(data,function(i){node_data[i]=data[i];});var new_node=self.createNode(node_data);node.setClassesTo(new_node);node.replace(new_node);return new_node;},removeNode:function(node){if(node.isLast()){if(node.previousSibling){node.previousSibling.setLast();}}
node.remove();},appendTo:function(node){node.appendChild(self.element);}});Mohawk.UI.SelectableList=Mohawk.UI.List.extend(Mohawk.UI.SelectableListInterface={selected:[],last_selected:null,last_click:null,multiple:true,__construct:function(id,structure){parent.__construct(id,structure);Mohawk.UI.selectables.push(self);self.EVENT_SELECTED=self.id+'-selected';self.element.onmousedown=function(){return false;};},createNode:function(data){var node=parent.createNode(data);node.select=function(){node.addClass('selected');if(!node.isSelected()){self.selected.push(node);}};node.unselect=function(){node.removeClass('selected');Array.remove(self.selected,node);};node.isSelected=function(){return Array.find(self.selected,node)!==false;};node.onclick=function(event){event=DOM.event(event);if(IE?event.button==0:event.button==BTN_LEFT){if(node.isSelected()&&!event.ctrlKey){self.select(event,node);}
if(node.ondblclick instanceof Function){var now=new Date;if(node.last_click instanceof Date&&!OPERA){if(now.getTime()-node.last_click.getTime()<1000){node.ondblclick();}}
node.last_click=now;}
event.stopPropagation();self.select(event,node);}};return node;},select:function(event,node,silently){event=DOM.event(event);if(event.ctrlKey&&self.multiple){if(Array.find(self.selected,node)!==false){node.unselect();}else{node.select();self.last_selected=node;}}else if((event.shiftKey&&self.last_selected&&self.multiple)||Mohawk.UI.selection){if(Mohawk.UI.selection&&!self.last_selected){self.last_selected=node;}
var last=0;var cur=0;for(var i=0;i<self.element.childNodes.length;i++){if(self.element.childNodes[i]==self.last_selected){last=i;}
if(self.element.childNodes[i]==node){cur=i;}
if(cur&&last){break;}}
while(self.selected.length){self.selected[0].unselect();}
if(cur>last){for(var i=last;i<cur;i++){self.element.childNodes[i].select();}}else{for(var i=cur;i<=last;i++){self.element.childNodes[i].select();}}
if(!node.isSelected()){node.select();}}else{self.unselectAll();node.select();self.last_selected=node;}
if(!silently){Observer.fire(self.EVENT_SELECTED);}},unselectAll:function(){while(self.selected.length){self.selected[0].unselect();}
self.last_selected=null;},isSelected:function(node){return Array.find(self.selected,node)!==false;},setSelected:function(id){self.select({},self.getNode(id),true);},getSelected:function(){return self.selected.length?self.selected[0].data.id:false;}});window.IconList=Mohawk.UI.SelectableList.extend({multiple:false,__construct:function(id,data){parent.__construct(id,data);self.element.addClass('icon-list');self.selected=[];},createNode:function(data){var node=parent.createNode(data);node.setHTML('');var icon=DOM.element('IMG');icon.src=data.src;node.appendChild(icon);return node;},getSelected:function(){var data=null;if(self.selected.length){data=self.selected[0].data.id;}
return data;},setSelected:function(id){self.unselectAll();var node=self.getNode(id);if(node){node.select();}}});Mohawk.Loader.extendLanguage({"Add_Goal":"Add A New Goal","Add_goal":"Add a new goal","ADD_GOAL":"ADD A NEW GOAL","add_goal":"add a new goal","Pick_Template":"Pick From A Template","Pick_template":"Pick from a template","PICK_TEMPLATE":"PICK FROM A TEMPLATE","pick_template":"pick from a template","Advanced_Mode":"Advanced Mode","Advanced_mode":"Advanced mode","ADVANCED_MODE":"ADVANCED MODE","advanced_mode":"advanced mode","Additional_Parameters":"Additional Parameters","Additional_parameters":"Additional parameters","ADDITIONAL_PARAMETERS":"ADDITIONAL PARAMETERS","additional_parameters":"additional parameters","Loading_Templates":"Loading Templates","Loading_templates":"Loading templates","LOADING_TEMPLATES":"LOADING TEMPLATES","loading_templates":"loading templates","Search":"Search","SEARCH":"SEARCH","search":"search","Add_This_Template":"Add To Your Goals","Add_this_template":"Add to your goals","ADD_THIS_TEMPLATE":"ADD TO YOUR GOALS","add_this_template":"add to your goals","Pick_Icon":"Pick An Icon","Pick_icon":"Pick an icon","PICK_ICON":"PICK AN ICON","pick_icon":"pick an icon","Hide_Ok":"Hide","Hide_ok":"Hide","HIDE_OK":"HIDE","hide_ok":"hide","Item_Search":"Or Search For An Icon Below","Item_search":"Or search for an icon below","ITEM_SEARCH":"OR SEARCH FOR AN ICON BELOW","item_search":"or search for an icon below","Click_To_Change_Value":"Click To Change The Value","Click_to_change_value":"Click to change the value","CLICK_TO_CHANGE_VALUE":"CLICK TO CHANGE THE VALUE","click_to_change_value":"click to change the value","Searching":"Searching","SEARCHING":"SEARCHING","searching":"searching","Search_More":"Search More","Search_more":"Search more","SEARCH_MORE":"SEARCH MORE","search_more":"search more","Powered_By_Iconfinder":"Powered By Iconfinder.com","Powered_by_iconfinder":"Powered by Iconfinder.com","POWERED_BY_ICONFINDER":"POWERED BY ICONFINDER.COM","powered_by_iconfinder":"powered by Iconfinder.com","Nothing_Found":"Nothing Is Found","Nothing_found":"Nothing is found","NOTHING_FOUND":"NOTHING IS FOUND","nothing_found":"nothing is found","Icon_Search_Hint":"Type A Keyword To Find An Icon &uarr; Or Pick From Below &darr;","Icon_search_hint":"Type a keyword to find an icon &uarr; or pick from below &darr;","ICON_SEARCH_HINT":"TYPE A KEYWORD TO FIND AN ICON &UARR; OR PICK FROM BELOW &DARR;","icon_search_hint":"Type a keyword to find an icon &uarr; or pick from below &darr;","Editing_Goal":"Goal","Editing_goal":"Goal","EDITING_GOAL":"GOAL","editing_goal":"goal","Setting_Plan":"Planning","Setting_plan":"Planning","SETTING_PLAN":"PLANNING","setting_plan":"planning","Statistics":"Statistics","STATISTICS":"STATISTICS","statistics":"statistics","Premium_Feature":"Premium Feature","Premium_feature":"Premium feature","PREMIUM_FEATURE":"PREMIUM FEATURE","premium_feature":"premium feature","Show_All_Goals":"Show All Goals","Show_all_goals":"Show all goals","SHOW_ALL_GOALS":"SHOW ALL GOALS","show_all_goals":"show all goals","Loading_Tab":"Loading Tab","Loading_tab":"Loading tab","LOADING_TAB":"LOADING TAB","loading_tab":"loading tab","Save":"Save","SAVE":"SAVE","save":"save","Saving":"Saving","SAVING":"SAVING","saving":"saving","Saved":"Saved","SAVED":"SAVED","saved":"saved","Confirm_Delete":"Delete? There Is No Undo","Confirm_delete":"Delete? There is NO undo","CONFIRM_DELETE":"DELETE? THERE IS NO UNDO","confirm_delete":"Delete? There is NO undo","Deleted":"Deleted","DELETED":"DELETED","deleted":"deleted","Deleting":"Deleting","DELETING":"DELETING","deleting":"deleting","Delete_This_Tab":"Delete This Tab","Delete_this_tab":"Delete this tab","DELETE_THIS_TAB":"DELETE THIS TAB","delete_this_tab":"delete this tab","Tab_Empty":"This Tab Is Empty","Tab_empty":"This tab is empty","TAB_EMPTY":"THIS TAB IS EMPTY","tab_empty":"this tab is empty","You_Can":"You Can","You_can":"You can","YOU_CAN":"YOU CAN","you_can":"you can","Loading":"Loading","LOADING":"LOADING","loading":"loading","Input_New_Tab_Name":"Enter New Tab Name","Input_new_tab_name":"Enter new tab name","INPUT_NEW_TAB_NAME":"ENTER NEW TAB NAME","input_new_tab_name":"enter new tab name","Title":"Title","TITLE":"TITLE","title":"title","Type":"Type","TYPE":"TYPE","type":"type","Numeric":"Numeric","NUMERIC":"NUMERIC","numeric":"numeric","Counter":"Counter","COUNTER":"COUNTER","counter":"counter","Boolean":"Boolean","BOOLEAN":"BOOLEAN","boolean":"boolean","Time":"Time","TIME":"TIME","time":"time","Timer":"Stopwatch","TIMER":"STOPWATCH","timer":"stopwatch","Description":"Description","DESCRIPTION":"DESCRIPTION","description":"description","Unit":"Unit of measurement","UNIT":"UNIT OF MEASUREMENT","unit":"unit of measurement","Aggregate_Function":"Aggregate Function","Aggregate_function":"Aggregate function","AGGREGATE_FUNCTION":"AGGREGATE FUNCTION","aggregate_function":"aggregate function","None_Function":"None","None_function":"None","NONE_FUNCTION":"NONE","none_function":"none","Summation":"Summation","SUMMATION":"SUMMATION","summation":"summation","Average":"Average","AVERAGE":"AVERAGE","average":"average","Maximim":"Maximum","MAXIMIM":"MAXIMUM","maximim":"maximum","Minimum":"Minimum","MINIMUM":"MINIMUM","minimum":"minimum","Item_Icon":"Item Icon","Item_icon":"Item icon","ITEM_ICON":"ITEM ICON","item_icon":"item icon","Yes_Icon":"&laquo;yes&raquo; Icon","Yes_icon":"&laquo;Yes&raquo; icon","YES_ICON":"&LAQUO;YES&RAQUO; ICON","yes_icon":"&laquo;Yes&raquo; icon","No_Icon":"&laquo;no&raquo; Icon","No_icon":"&laquo;No&raquo; icon","NO_ICON":"&LAQUO;NO&RAQUO; ICON","no_icon":"&laquo;No&raquo; icon","Zero_Icon":"&laquo;zero&raquo; Icon","Zero_icon":"&laquo;Zero&raquo; icon","ZERO_ICON":"&LAQUO;ZERO&RAQUO; ICON","zero_icon":"&laquo;Zero&raquo; icon","Set":"Set","SET":"SET","set":"set","Week":"Week","WEEK":"WEEK","week":"week","Month":"Month","MONTH":"MONTH","month":"month","Past":"Past","PAST":"PAST","past":"past","Plan":"Plan","PLAN":"PLAN","plan":"plan","Input_Plan_Week":"Input Planned Value For This Week","Input_plan_week":"Input planned value for this week","INPUT_PLAN_WEEK":"INPUT PLANNED VALUE FOR THIS WEEK","input_plan_week":"Input planned value for this week","Input_Plan_Month":"Input Planned Value For This Month","Input_plan_month":"Input planned value for this month","INPUT_PLAN_MONTH":"INPUT PLANNED VALUE FOR THIS MONTH","input_plan_month":"Input planned value for this month","Date":"Date","DATE":"DATE","date":"date","Value":"Value","VALUE":"VALUE","value":"value","Planned":"Planned","PLANNED":"PLANNED","planned":"planned","Set_Date":"Set Date","Set_date":"Set date","SET_DATE":"SET DATE","set_date":"set date","Input_Value":"Input Value","Input_value":"Input value","INPUT_VALUE":"INPUT VALUE","input_value":"input value","Etc":"Etc.","ETC":"ETC.","etc":"etc.","Or":"Or","OR":"OR","or":"or","_Yes":"Yes","_yes":"yes","_YES":"YES","_No":"No","_no":"no","_NO":"NO","Eg":"Eg","EG":"EG","eg":"eg","Min":"Min","MIN":"MIN","min":"min","Unit_Example":"For Example: Km, $, M<Sup>2<\/sup>","Unit_example":"For example: km, $, m<sup>2<\/sup>","UNIT_EXAMPLE":"FOR EXAMPLE: KM, $, M<SUP>2<\/SUP>","unit_example":"for example: km, $, m<sup>2<\/sup>","Prepend_Hint":"Should Be In Front (As For <U>$<\/u>100 Vs. 100<U>Miles<\/u>)","Prepend_hint":"Should be in front (as for <u>$<\/u>100 vs. 100<u>miles<\/u>)","PREPEND_HINT":"SHOULD BE IN FRONT (AS FOR <U>$<\/U>100 VS. 100<U>MILES<\/U>)","prepend_hint":"should be in front (as for <u>$<\/u>100 vs. 100<u>miles<\/u>)","You_May_Also":"You May Also","You_may_also":"You may also","YOU_MAY_ALSO":"YOU MAY ALSO","you_may_also":"you may also","Archive_Goal":"Archive","Archive_goal":"Archive","ARCHIVE_GOAL":"ARCHIVE","archive_goal":"archive","This_Goal":"This Goal","This_goal":"This goal","THIS_GOAL":"THIS GOAL","this_goal":"this goal","Pick_Template_Info":"Here Is A List Of Templates For The Most Popular Goals. To Add A Template To Your Goals, Click On Its Title And Press 'add To Your Goals' Button. You Can Change Icons And Perform Other Customization Of The Goal After You Have Added It.","Pick_template_info":"Here is a list of templates for the most popular goals. To add a template to your goals, click on its title and press 'Add to your goals' button. You can change icons and perform other customization of the goal after you have added it.","PICK_TEMPLATE_INFO":"HERE IS A LIST OF TEMPLATES FOR THE MOST POPULAR GOALS. TO ADD A TEMPLATE TO YOUR GOALS, CLICK ON ITS TITLE AND PRESS 'ADD TO YOUR GOALS' BUTTON. YOU CAN CHANGE ICONS AND PERFORM OTHER CUSTOMIZATION OF THE GOAL AFTER YOU HAVE ADDED IT.","pick_template_info":"Here is a list of templates for the most popular goals. To add a template to your goals, click on its title and press 'Add to your goals' button. You can change icons and perform other customization of the goal after you have added it.","Goal_Type_Info":"The Type Of A Goal Is Determined By The Kind Of Information You Would Like To Store.","Goal_type_info":"The type of a goal is determined by the kind of information you would like to store.","GOAL_TYPE_INFO":"THE TYPE OF A GOAL IS DETERMINED BY THE KIND OF INFORMATION YOU WOULD LIKE TO STORE.","goal_type_info":"The type of a goal is determined by the kind of information you would like to store.","Numeric_Type_Hint":"For Information Such As Amount Of <Strong>Money<\/strong> Or Number Of <Strong>Miles<\/strong>, Choose <Strong>Numeric<\/strong> Type.","Numeric_type_hint":"For information such as amount of <strong>money<\/strong> or number of <strong>miles<\/strong>, choose <strong>numeric<\/strong> type.","NUMERIC_TYPE_HINT":"FOR INFORMATION SUCH AS AMOUNT OF <STRONG>MONEY<\/STRONG> OR NUMBER OF <STRONG>MILES<\/STRONG>, CHOOSE <STRONG>NUMERIC<\/STRONG> TYPE.","numeric_type_hint":"For information such as amount of <strong>money<\/strong> or number of <strong>miles<\/strong>, choose <strong>numeric<\/strong> type.","Counter_Type_Hint":"If You Want To Count Items, Such As <Strong>Number Of Push-Ups<\/strong> Or <Strong>Cups Of Coffee<\/strong>, Choose <Strong>Counter<\/strong>.","Counter_type_hint":"If you want to count items, such as <strong>number of push-ups<\/strong> or <strong>cups of coffee<\/strong>, choose <strong>counter<\/strong>.","COUNTER_TYPE_HINT":"IF YOU WANT TO COUNT ITEMS, SUCH AS <STRONG>NUMBER OF PUSH-UPS<\/STRONG> OR <STRONG>CUPS OF COFFEE<\/STRONG>, CHOOSE <STRONG>COUNTER<\/STRONG>.","counter_type_hint":"If you want to count items, such as <strong>number of push-ups<\/strong> or <strong>cups of coffee<\/strong>, choose <strong>counter<\/strong>.","Boolean_Type_Hint":"For '<Strong>Yes Or No<\/strong>' Questions, Such As 'did I Work Well Today?' Or 'have I Read A Book?', Choose <Strong>Boolean<\/strong>.","Boolean_type_hint":"For '<strong>yes or no<\/strong>' questions, such as 'Did I work well today?' or 'Have I read a book?', choose <strong>boolean<\/strong>.","BOOLEAN_TYPE_HINT":"FOR '<STRONG>YES OR NO<\/STRONG>' QUESTIONS, SUCH AS 'DID I WORK WELL TODAY?' OR 'HAVE I READ A BOOK?', CHOOSE <STRONG>BOOLEAN<\/STRONG>.","boolean_type_hint":"For '<strong>yes or no<\/strong>' questions, such as 'Did I work well today?' or 'Have I read a book?', choose <strong>boolean<\/strong>.","Time_Type_Hint":"To Log A Time Of An Event, Such As When You Wake Up, Select <Strong>Time<\/strong> Type.","Time_type_hint":"To log a time of an event, such as when you wake up, select <strong>time<\/strong> type.","TIME_TYPE_HINT":"TO LOG A TIME OF AN EVENT, SUCH AS WHEN YOU WAKE UP, SELECT <STRONG>TIME<\/STRONG> TYPE.","time_type_hint":"To log a time of an event, such as when you wake up, select <strong>time<\/strong> type.","Timer_Type_Hint":"<Strong>Stopwatch<\/strong> Allows You To Record Periods Of Time, E.g. 'how Long Have I Been Working Today?'. You Can Launch A Stopwatch Or Enter Time Manually.","Timer_type_hint":"<strong>Stopwatch<\/strong> allows you to record periods of time, e.g. 'How long have I been working today?'. You can launch a stopwatch or enter time manually.","TIMER_TYPE_HINT":"<STRONG>STOPWATCH<\/STRONG> ALLOWS YOU TO RECORD PERIODS OF TIME, E.G. 'HOW LONG HAVE I BEEN WORKING TODAY?'. YOU CAN LAUNCH A STOPWATCH OR ENTER TIME MANUALLY.","timer_type_hint":"<strong>Stopwatch<\/strong> allows you to record periods of time, e.g. 'How long have I been working today?'. You can launch a stopwatch or enter time manually.","Item_Icon_Hint":"This Icon Depicts An Item That You Keep Count. To Add An Item, Click On The Cell And One Icon Will Be Added. To Remove An Item, Click On The Icon.","Item_icon_hint":"This icon depicts an item that you keep count. To add an item, click on the cell and one icon will be added. To remove an item, click on the icon.","ITEM_ICON_HINT":"THIS ICON DEPICTS AN ITEM THAT YOU KEEP COUNT. TO ADD AN ITEM, CLICK ON THE CELL AND ONE ICON WILL BE ADDED. TO REMOVE AN ITEM, CLICK ON THE ICON.","item_icon_hint":"This icon depicts an item that you keep count. To add an item, click on the cell and one icon will be added. To remove an item, click on the icon.","Yes_Icon_Hint":"This Icon Depicts A Positive Answer. Depending On The Goal Title It May Have A Positive Or A Negative Meaning. In Case Of 'work Productivity' It Has A Positive Meaning, While In Case Of 'car Malfunctioning' It Has A Negative Meaning.","Yes_icon_hint":"This icon depicts a positive answer. Depending on the goal title it may have a positive or a negative meaning. In case of 'Work productivity' it has a positive meaning, while in case of 'Car malfunctioning' it has a negative meaning.","YES_ICON_HINT":"THIS ICON DEPICTS A POSITIVE ANSWER. DEPENDING ON THE GOAL TITLE IT MAY HAVE A POSITIVE OR A NEGATIVE MEANING. IN CASE OF 'WORK PRODUCTIVITY' IT HAS A POSITIVE MEANING, WHILE IN CASE OF 'CAR MALFUNCTIONING' IT HAS A NEGATIVE MEANING.","yes_icon_hint":"This icon depicts a positive answer. Depending on the goal title it may have a positive or a negative meaning. In case of 'Work productivity' it has a positive meaning, while in case of 'Car malfunctioning' it has a negative meaning.","No_Icon_Hint":"This Icon Depicts A Negative Answer.","No_icon_hint":"This icon depicts a negative answer.","NO_ICON_HINT":"THIS ICON DEPICTS A NEGATIVE ANSWER.","no_icon_hint":"This icon depicts a negative answer.","Unit_Hint":"What Your Data Is Measured With. For Example: Km, $, M<Sup>2<\/sup>.","Unit_hint":"What your data is measured with. For example: km, $, m<sup>2<\/sup>.","UNIT_HINT":"WHAT YOUR DATA IS MEASURED WITH. FOR EXAMPLE: KM, $, M<SUP>2<\/SUP>.","unit_hint":"What your data is measured with. For example: km, $, m<sup>2<\/sup>.","Aggregate_Hint":"We Use The Aggregate Function To Sum Up The Results Over A Period Of Time. This Option Affects The Value In The Right Part Of The Table And The Values Depicted In Graphs.","Aggregate_hint":"We use the aggregate function to sum up the results over a period of time. This option affects the value in the right part of the table and the values depicted in graphs.","AGGREGATE_HINT":"WE USE THE AGGREGATE FUNCTION TO SUM UP THE RESULTS OVER A PERIOD OF TIME. THIS OPTION AFFECTS THE VALUE IN THE RIGHT PART OF THE TABLE AND THE VALUES DEPICTED IN GRAPHS.","aggregate_hint":"We use the aggregate function to sum up the results over a period of time. This option affects the value in the right part of the table and the values depicted in graphs.","Show_The_Last_Value":"Show The Last Value","Show_the_last_value":"Show the last value","SHOW_THE_LAST_VALUE":"SHOW THE LAST VALUE","show_the_last_value":"show the last value","Planning_Info":"Here You Can Add A Plan For Your Goal. For Example, You Can Put How Many Miles You Plan To Run By The End Of The Month Or Set A Limit Of Your Expenses.","Planning_info":"Here you can add a plan for your goal. For example, you can put how many miles you plan to run by the end of the month or set a limit of your expenses.","PLANNING_INFO":"HERE YOU CAN ADD A PLAN FOR YOUR GOAL. FOR EXAMPLE, YOU CAN PUT HOW MANY MILES YOU PLAN TO RUN BY THE END OF THE MONTH OR SET A LIMIT OF YOUR EXPENSES.","planning_info":"Here you can add a plan for your goal. For example, you can put how many miles you plan to run by the end of the month or set a limit of your expenses.","Planning_Hint":"To Add A New Value, Click On 'add A Value'. To Edit Added Value Click On A Row. All The Information Will Be Saved Automatically When You Add Or Modify It.","Planning_hint":"To add a new value, click on 'add a value'. To edit added value click on a row. All the information will be saved automatically when you add or modify it.","PLANNING_HINT":"TO ADD A NEW VALUE, CLICK ON 'ADD A VALUE'. TO EDIT ADDED VALUE CLICK ON A ROW. ALL THE INFORMATION WILL BE SAVED AUTOMATICALLY WHEN YOU ADD OR MODIFY IT.","planning_hint":"To add a new value, click on 'add a value'. To edit added value click on a row. All the information will be saved automatically when you add or modify it.","Done_Planning":"I Am Done Planning","Done_planning":"I am done planning","DONE_PLANNING":"I AM DONE PLANNING","done_planning":"I am done planning","Share_Chart":"You Can Share Your Chart With Friends","Share_chart":"You can share your chart with friends","SHARE_CHART":"YOU CAN SHARE YOUR CHART WITH FRIENDS","share_chart":"You can share your chart with friends","Obtain_Code":"Obtain The Code","Obtain_code":"Obtain the code","OBTAIN_CODE":"OBTAIN THE CODE","obtain_code":"obtain the code","Back_To_Week_View":"Back To The Week View","Back_to_week_view":"Back to the week view","BACK_TO_WEEK_VIEW":"BACK TO THE WEEK VIEW","back_to_week_view":"back to the week view","Link_To_Chart_Page":"Link To Your Chart Page","Link_to_chart_page":"Link to your chart page","LINK_TO_CHART_PAGE":"LINK TO YOUR CHART PAGE","link_to_chart_page":"Link to your chart page","Embed_Chart_Code":"Embed This Code In Your Blog","Embed_chart_code":"Embed this code in your blog","EMBED_CHART_CODE":"EMBED THIS CODE IN YOUR BLOG","embed_chart_code":"Embed this code in your blog","Post_Chart":"Share In Your Favorite Network","Post_chart":"Share in your favorite network","POST_CHART":"SHARE IN YOUR FAVORITE NETWORK","post_chart":"Share in your favorite network","Period":"Period","PERIOD":"PERIOD","period":"period","Group_By":"Group By","Group_by":"Group by","GROUP_BY":"GROUP BY","group_by":"group by","Chart_Line":"Line","Chart_line":"Line","CHART_LINE":"LINE","chart_line":"line","Chart_Column":"Column","Chart_column":"Column","CHART_COLUMN":"COLUMN","chart_column":"column","Chart_Pie":"Pie","Chart_pie":"Pie","CHART_PIE":"PIE","chart_pie":"pie","Week_Days":"Week Days","Week_days":"Week days","WEEK_DAYS":"WEEK DAYS","week_days":"week days","Day":"Day","DAY":"DAY","day":"day","Quarter":"Quarter","QUARTER":"QUARTER","quarter":"quarter","Year":"Year","YEAR":"YEAR","year":"year","All_Time":"All Time","All_time":"All time","ALL_TIME":"ALL TIME","all_time":"all time","Accumulate_Values":"Accumulate Values","Accumulate_values":"Accumulate values","ACCUMULATE_VALUES":"ACCUMULATE VALUES","accumulate_values":"accumulate values","Interpolate_Line":"Interpolate Line","Interpolate_line":"Interpolate line","INTERPOLATE_LINE":"INTERPOLATE LINE","interpolate_line":"interpolate line","Fill_Empty_Values":"Fill Empty Values","Fill_empty_values":"Fill empty values","FILL_EMPTY_VALUES":"FILL EMPTY VALUES","fill_empty_values":"fill empty values","Save_Chart":"Save Chart","Save_chart":"Save chart","SAVE_CHART":"SAVE CHART","save_chart":"save chart","Set_Title":"Set Title","Set_title":"Set title","SET_TITLE":"SET TITLE","set_title":"set title","Choose_Chart_Type":"Choose Chart Type","Choose_chart_type":"Choose chart type","CHOOSE_CHART_TYPE":"CHOOSE CHART TYPE","choose_chart_type":"choose chart type","Choose_Goal_And_Type":"Choose Goal And Type","Choose_goal_and_type":"Choose goal and type","CHOOSE_GOAL_AND_TYPE":"CHOOSE GOAL AND TYPE","choose_goal_and_type":"choose goal and type","Choose_Period_And_Group":"Choose Period And Group","Choose_period_and_group":"Choose period and group","CHOOSE_PERIOD_AND_GROUP":"CHOOSE PERIOD AND GROUP","choose_period_and_group":"choose period and group","Additional_Options":"Additional Options","Additional_options":"Additional options","ADDITIONAL_OPTIONS":"ADDITIONAL OPTIONS","additional_options":"additional options","No_Archived_Goals":"No Archived Goals. To Archive A Goal Click On The Goal's Name And Choose &quot;archive&quot; In The Appeared Form.","No_archived_goals":"No archived goals. To archive a goal click on the goal's name and choose &quot;archive&quot; in the appeared form.","NO_ARCHIVED_GOALS":"NO ARCHIVED GOALS. TO ARCHIVE A GOAL CLICK ON THE GOAL'S NAME AND CHOOSE &QUOT;ARCHIVE&QUOT; IN THE APPEARED FORM.","no_archived_goals":"No archived goals. To archive a goal click on the goal's name and choose &quot;archive&quot; in the appeared form.","Error_Empty_Title":"Input Title","Error_empty_title":"Input title","ERROR_EMPTY_TITLE":"INPUT TITLE","error_empty_title":"input title"})
window.IconFinderApi=new Class({List:null,initSearch:function(input){clearTimeout(self.search_timeout);self.search_timeout=setTimeout(function(){self.search(input.value);},1000);},search:function(q,p){p=p||0;var req=new Ajax(URL.home+'api/iconfinder/');req.responseHandler=function(req){try{var icons=req.data.iconmatches.icon;if(icons.id){icons=[icons];}
var data=[];foreach(icons,function(i,icon){data.push({id:'if-'+icon.id,src:unescape(icon.image)});});if(!p){self.List.setChildren(data);}else{foreach(data,function(i,icon){self.List.addNode(icon);});}
self.List.element.removeClass('hidden');var link=DOM.element('A');link.href='#more';link.addClass('script');link.onclick=function(){self.search(q,p+1);return false;};link.setHTML(LNG.Search_more);self.Message.setHTML('');self.Message.appendChild(link);self.Message.appendChild(DOM.text(' ('+LNG.powered_by_iconfinder+')'));}catch(e){self.Message.setHTML(LNG.Nothing_found);}};req.errorHandler=function(req){Progress.done('Error');};req.send({q:q,p:p});if(!p){self.List.element.addClass('hidden');}
self.Message.removeClass('hidden');self.Message.setHTML(LNG.Searching+'...');}});window.IconPick=new Class({__construct:function(icons){var element=DOM.element('DIV');element.addClass('icon-pick');self.element=element;self.icons=icons;var input=FormsInterface.createInput('text','q',LNG.search+'...');input.onchange=function(){if(!this.value.length){self.setDefault();}};input.title=LNG.search+'...';input.addClass('empty');input.onfocus=function(){if(this.value==this.title){this.value='';}
this.removeClass('empty');};input.onblur=function(){if(this.value==''){this.value=this.title;this.addClass('empty');}};input.onkeydown=function(event){event=DOM.event(event);if(event.key()==13){return false;}};input.onkeyup=function(){self.IconFinder.initSearch(this);};input.value=input.title;self.input=input;element.appendChild(input);var hint=DOM.element('P');hint.addClass('hint');hint.setHTML(LNG.Icon_search_hint);element.appendChild(hint);self.IconList=new IconList('icon-list',icons);Observer.add(self.IconList.EVENT_SELECTED,function(){if(!self.IconList.selected.length){return;}
var data=self.IconList.selected[0].data;self.Picker.setData(data.id.match('^if-')?data.src:data.id);self.hide();});element.appendChild(self.IconList.element);self.message=DOM.element('P');self.message.addClass('message','hidden');element.appendChild(self.message);self.IconFinder=new IconFinderApi();self.IconFinder.List=self.IconList;self.IconFinder.Message=self.message;},setDefault:function(){self.message.addClass('hidden');self.IconList.setChildren(self.icons);},set:function(picker){if(self.Picker){self.Picker.link.setHTML(LNG.Pick_icon);}
self.Picker=picker;if(self.Picker){self.Picker.link.setHTML(LNG.Hide_ok);}
var node=self.IconList.getNode(picker.data);if(node){self.IconList.select({},node);}else{self.IconList.unselectAll();self.setDefault();self.input.value='';setTimeout(function(){self.input.focus();});}},hide:function(){if(self.Picker){self.Picker.link.setHTML(LNG.Pick_icon);}
self.Picker=null;self.element.remove();}});window.IconPicker=new Class({Pick:null,data:null,__construct:function(Pick){self.Pick=Pick;self.element=DOM.element('DIV');self.element.addClass('icon-picker');self.element.onclick=function(){self.Pick.set(self);self.element.parentNode.insertAfter(self.Pick.element,self.element);};self.img=DOM.element('IMG');self.element.appendChild(self.img);var link=DOM.element('A');link.href='#icon-pick';link.addClass('script');link.setHTML(LNG.Pick_icon);link.onclick=function(){if(self.Pick.Picker===self){setTimeout(function(){self.Pick.hide();});}else{self.Pick.set(self);}
return false;};self.element.appendChild(link);self.link=link;},setData:function(data){self.data=data;if(data&&data!='0'){self.img.src=Data.icons[data]!==undefined?Data.icons[data]:data;}else{self.img.src=URL.img+'icons/loading.png';}}});Mohawk.UI.OrderedList=Mohawk.UI.List.extend({addNode:function(data){var node=self.createNode(data);self.placeNode(node);return node;},editNode:function(node,data){var node_data=node.data;foreach(data,function(i){node_data[i]=data[i];});var new_node=self.createNode(node_data);node.setClassesTo(new_node);self.removeNode(node);self.placeNode(new_node);return new_node;},placeNode:function(node){if(self.compareNodes instanceof Function){var before=null;for(var i=0;i<self.element.childNodes.length;i++){var child=self.element.childNodes[i];if(child==node){continue;}
if(self.compareNodes(node,child)){before=child;break;}}
self.element.insertBefore(node,before);}else{self.element.appendChild(node,child);}
if(node.previousSibling&&node.previousSibling.isLast()){node.previousSibling.notLast();node.setLast();}else if(self.element.childNodes.length==1){node.setLast();}}});window.TemplatesPick=Mohawk.UI.OrderedList.extend({active:null,createNode:function(data){var node=parent.createNode(data);node.setHTML('');var title=DOM.element('H2');node.appendChild(title);var icon=DOM.element('IMG');if(data.type=='boolean'){icon.src=Data.icons[data.icon_true];}else if(data.type=='counter'){icon.src=Data.icons[data.icon_item];}else if(data.type=='numeric'){icon.src=URL.img+'icons/number.png';}else if(data.type=='time'){icon.src=URL.img+'icons/time.png';}else if(data.type=='timer'){icon.src=URL.img+'icons/stopwatch.png';}else{icon.src=URL.img+'icons/loading.png';}
title.insertFirst(icon);var span=DOM.element('SPAN');span.setHTML(data.title);title.appendChild(span);var text=DOM.element('DIV');text.addClass('text','hidden');var html=data.preview;html=nl2br(html);text.setHTML('<p>'+html+'</p>');node.appendChild(text);span.onclick=function(){if(text.hasClass('hidden')){if(self.active){Effects.fold(self.active,function(){self.active.addClass('hidden');text.removeClass('hidden');Effects.unfold(text);self.active=text;});}else{text.removeClass('hidden');Effects.unfold(text);self.active=text;}}else{Effects.fold(text,function(){text.addClass('hidden');self.active=null;});}};var button=DOM.element('BUTTON',{type:'button'});if(data.type!='timer'||ENV.user.valid){button.setHTML(LNG.Add_this_template);button.onclick=function(){var goal=Object.clone(data);goal.id='';goal.tab=ENV.tab;goal.template=data.id;goal.position=(Goals.Table.table.tBodies[0].childNodes.length?parseInt(Goals.Table.table.tBodies[0].lastChild.data.position):0)+1;Goals.add(goal);return false;};}else{button.setHTML('<img src="'+URL.img+'site/premium.png" alt="*" /> '+LNG.Add_this_template);button.onclick=show_premium;}
text.appendChild(button);return node;}});window.TemplatesForm=new Class({element:null,__construct:function(){self.element=self.createForm();document.body.appendChild(self.element);self.element.addClass('hidden');var icons=[];foreach(Data.icons,function(i,val){icons.push({id:i,src:val});});self.IconPick=new IconPick(icons);self.IconItem=new IconPicker(self.IconPick);ID('goals-icon-item').replace(self.IconItem.element);self.IconTrue=new IconPicker(self.IconPick);ID('goals-icon-true').replace(self.IconTrue.element);self.IconFalse=new IconPicker(self.IconPick);ID('goals-icon-false').replace(self.IconFalse.element);},createForm:function(){var form=document.createElement('FORM');form.object=self;window.TEMPLATES_FORM="<fieldset>"+"\n    <img id=\"goals-form-close\" src=\"{%URL.img}site/close.png\" onclick=\"Templates.Form.hide(); return false;\" />"+"\n    <input type=\"hidden\" name=\"id\" />"+"\n    <input type=\"hidden\" name=\"template\" value=\"yes\" />"+"\n    <ul class=\"fields\">"+"\n        <li>"+"\n            <label class=\"block\">Approved?</label>"+"\n            <input type=\"radio\" id=\"approved-no\" name=\"approved\" value=\"no\" />"+"\n            <label for=\"approved-no\">no</label>"+"\n            &nbsp;"+"\n            &nbsp;"+"\n            <input type=\"radio\" id=\"approved-yes\" name=\"approved\" value=\"yes\" />"+"\n            <label for=\"approved-yes\">yes</label>"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Title</label>"+"\n            <input name=\"title\" class=\"text\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Name (for URL)</label>"+"\n            <input name=\"name\" class=\"text\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Type</label>"+"\n            <ul class=\"fields\">"+"\n                <li>"+"\n                    <input type=\"radio\" id=\"type-numeric\" name=\"type\" value=\"numeric\" onclick=\"Templates.Form.setType(this.value)\" />"+"\n                    <label for=\"type-numeric\">numeric: <i class=\"ex\">3.14, 100, 299792, etc.</i></label>"+"\n                </li>"+"\n                <li>"+"\n                    <input type=\"radio\" id=\"type-counter\" name=\"type\" value=\"counter\" onclick=\"Templates.Form.setType(this.value)\" />"+"\n                    <label for=\"type-counter\">counter: <i class=\"ex\">1, 2, 3 ...</i></label>"+"\n                </li>"+"\n                <li>"+"\n                    <input type=\"radio\" id=\"type-boolean\" name=\"type\" value=\"boolean\" onclick=\"Templates.Form.setType(this.value)\" />"+"\n                    <label for=\"type-boolean\">boolean: <i class=\"ex\">yes or no</i></label>"+"\n                </li>"+"\n                <li>"+"\n                    <input type=\"radio\" id=\"type-time\" name=\"type\" value=\"time\" onclick=\"Templates.Form.setType(this.value)\" />"+"\n                    <label for=\"type-time\">time: <i class=\"ex\">7:30</i></label>"+"\n                </li>"+"\n                <li>"+"\n                    <input type=\"radio\" id=\"type-timer\" name=\"type\" value=\"timer\" onclick=\"Templates.Form.setType(this.value)\" />"+"\n                    <label for=\"type-timer\">timer: <i class=\"ex\">&#9656;7:30</i></label>"+"\n                </li>"+"\n            </ul>"+"\n        </li>"+"\n        <li class=\"type counter\">"+"\n            <label class=\"block\">Item icon</label>"+"\n            <div id=\"goals-icon-item\"></div>"+"\n        </li>"+"\n        <li class=\"type boolean\">"+"\n            <label class=\"block\">\"Yes\" icon</label>"+"\n            <div id=\"goals-icon-true\"></div>"+"\n        </li>"+"\n        <li class=\"type boolean\">"+"\n            <label class=\"block\">\"No\" icon</label>"+"\n            <div id=\"goals-icon-false\"></div>"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Preview (short text for template list)</label>"+"\n            <textarea name=\"preview\"></textarea>"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Description (for template page)</label>"+"\n            <textarea name=\"description\"></textarea>"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Instructions (how to use it)</label>"+"\n            <textarea name=\"instructions\"></textarea>"+"\n        </li>"+"\n        <li class=\"type numeric counter\">"+"\n            <label class=\"block\">Unit of measurement</label>"+"\n            <input type=\"text\" name=\"unit\" class=\"text small\" />"+"\n            <i class=\"ex\">(for example: km, $, m<sup>2</sup>)</i>"+"\n            <br />"+"\n            <input type=\"checkbox\" id=\"prepend\" name=\"prepend\" value=\"yes\" />"+"\n            <label for=\"prepend\">should be in front (as for $100)</label>"+"\n        </li>"+"\n        <li class=\"type numeric counter\">"+"\n            <label class=\"block\">Aggregate function</label>"+"\n            <ul class=\"fields\">"+"\n                <li>"+"\n                    <input type=\"radio\" id=\"function-none\" name=\"aggregate\" value=\"none\" />"+"\n                    <label for=\"function-none\">none: <i class=\"ex\">show the last value</i></label>"+"\n                </li>"+"\n                <li>"+"\n                    <input type=\"radio\" id=\"function-sum\" name=\"aggregate\" value=\"sum\" />"+"\n                    <label for=\"function-sum\">summation: <i class=\"ex\">1 + 2 + 3 = 6</i></label>"+"\n                </li>"+"\n                <li>"+"\n                    <input type=\"radio\" id=\"function-avg\" name=\"aggregate\" value=\"avg\" />"+"\n                    <label for=\"function-avg\">average: <i class=\"ex\">(1 + 2 + 3) / 3 = 2</i></label>"+"\n                </li>"+"\n                <li>"+"\n                    <input type=\"radio\" id=\"function-max\" name=\"aggregate\" value=\"max\" />"+"\n                    <label for=\"function-max\">maximim: <i class=\"ex\">max(1, 2, 3) = 3</i></label>"+"\n                </li>"+"\n                <li>"+"\n                    <input type=\"radio\" id=\"function-min\" name=\"aggregate\" value=\"min\" />"+"\n                    <label for=\"function-min\">minimum: <i class=\"ex\">min(1, 2, 3) = 1</i></label>"+"\n                </li>"+"\n            </ul>"+"\n        </li>        "+"\n    </ul>"+"\n    <div class=\"buttons\">"+"\n        <button type=\"submit\">Save</button>"+"\n        or"+"\n        <a href=\"#cancel\" class=\"script\" onclick=\"Templates.Form.hide(); return false;\">cancel</a>"+"\n        &nbsp;&nbsp;&nbsp;"+"\n        You may also <a href=\"#delete\" class=\"script\" onclick=\"Templates.remove(Templates.Form.element.id.value); return false;\">delete</a> this template"+"\n    </div>"+"\n</fieldset>";form.setHTML(Template.transform(TEMPLATES_FORM));form.id='goals-form';form.onmousedown=DOM.stopEvent;form.onsubmit=function(){self.save.apply(self,[form]);return false;};return form;},save:function(form){foreach(form.getElementsByClassName('error'),function(){this.remove();});var data=form.getData();data.icon_item=self.IconItem.data;data.icon_true=self.IconTrue.data;data.icon_false=self.IconFalse.data;data.prepend=data.prepend||'no';data.category=ENV.category;Observer.fire('form-submitted',data);},set:function(data){self.element.removeClass('hidden');Shadow.show();Dragdrop.bringToFront(self.element);self.element.setData({'id':''});self.element.reset();if(data){self.element.replaceClass('adding','editing');self.element.setData(data);self.setType(data.type);self.IconItem.setData(data.icon_item);self.IconTrue.setData(data.icon_true);self.IconFalse.setData(data.icon_false);}else{self.element.replaceClass('editing','adding');self.element.setData({type:'numeric'});self.setType('numeric');self.IconItem.setData(0);self.IconTrue.setData(0);self.IconFalse.setData(0);}},hide:function(){Shadow.hide();self.element.addClass('hidden');},setType:function(type){var fields=self.element.getElementsByTagName('LI');for(var i=0;i<fields.length;i++){if(!fields[i].hasClass('type')){continue;}
if(type&&fields[i].hasClass(type)){fields[i].removeClass('hidden');}else{fields[i].addClass('hidden');}}}});window.CategoriesForm=new Class({element:null,__construct:function(){self.element=self.createForm();document.body.appendChild(self.element);self.element.addClass('hidden');},createForm:function(){var form=DOM.element('FORM');form.object=self;window.CATEGORIES_FORM="<fieldset>"+"\n    <img id=\"goals-form-close\" src=\"{%URL.img}site/close.png\" onclick=\"Categories.Form.hide(); return false;\" />"+"\n    <input type=\"hidden\" name=\"id\" />"+"\n    <ul class=\"fields\">"+"\n        <li>"+"\n            <label class=\"block\">Title (en)</label>"+"\n            <input name=\"title_en\" class=\"text\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Title (ru)</label>"+"\n            <input name=\"title_ru\" class=\"text\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Title (fr)</label>"+"\n            <input name=\"title_fr\" class=\"text\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Name (for URL)</label>"+"\n            <input name=\"name\" class=\"text\" />"+"\n        </li>"+"\n    </ul>"+"\n    <div class=\"buttons\">"+"\n        <button type=\"submit\">Save</button>"+"\n        or"+"\n        <a href=\"#cancel\" class=\"script\" onclick=\"Categories.Form.hide(); return false;\">cancel</a>"+"\n        &nbsp;&nbsp;&nbsp;"+"\n        You may also <a href=\"#delete\" class=\"script\" onclick=\"Categories.remove(Categories.Form.element.id.value); return false;\">delete</a> this category"+"\n    </div>"+"\n</fieldset>";form.id='categories-form';form.setHTML(Template.transform(CATEGORIES_FORM));form.onmousedown=DOM.stopEvent;form.onsubmit=function(){self.save.apply(self,[form]);return false;};return form;},save:function(form){foreach(form.getElementsByClassName('error'),function(){this.remove();});var data=form.getData();Observer.fire('categories-submitted',data);},set:function(data){self.element.removeClass('hidden');Shadow.show();Dragdrop.bringToFront(self.element);self.element.setData({'id':''});self.element.reset();if(data){self.element.setData(data);}},hide:function(){Shadow.hide();self.element.addClass('hidden');}});Mohawk.UI.SortableList=Mohawk.UI.OrderedList.extend({node_margin:new Pixel(0,0),marker_size:{width:16,height:16},marker_class:'marker',orientation:'vertical',target:null,__construct:function(id,data){parent.__construct(id,data);self.EVENT_SORTED=self.id+'-sorted';self.EVENT_MOVED=self.id+'-moved';self.element.ondragover=function(event){event=DOM.event(event);var marker=this.object.findMarker(event);if(marker===false){this.object.removeMarker();}else{if(marker.after===true){this.object.setMarkerAfter(marker.node);}else{this.object.setMarkerBefore(marker.node);}}};self.element.ondragout=function(event){this.object.removeMarker();};self.element.ondrop=function(event){var self=this.object;var node=Dragdrop.events[0].element.proto;var moved=node.parentNode!=self.element;var marker=self.findMarker(event);if(marker){if(marker.after===true){self.element.insertBefore(node,marker.node.nextSibling);}else{self.element.insertBefore(node,marker.node);}
if(moved){Observer.fire(self.EVENT_MOVED,node,self.element);}else{Observer.fire(self.EVENT_SORTED,self.element.childNodes);}}
self.removeMarker();return marker;};},createNode:function(data){var node=parent.createNode(data);node.onmousedown=function(event){event=DOM.event(event);if(event.button!=BTN_LEFT){return;}
var clone=self.createClone(node);Dragdrop.setTarget(self.element);self.element.appendChild(clone);Dragdrop.pick(event,[clone]);return false;};return node;},createClone:function(node){var clone=node.cloneNode(true);clone.addClass(Dragdrop.css_class);clone.ondrop=function(){this.remove();};clone.onrelease=function(event){this.remove();};if(!self.movable){if(self.orientation=='vertical'){clone.dragX=false;}else{clone.dragY=false;}}
clone.style.position='absolute';clone.style.left=node.offsetLeft-self.node_margin.x+'px';clone.style.top=node.offsetTop-self.node_margin.y+'px';clone.style.width=node.offsetWidth+'px';clone.style.height=node.offsetHeight+'px';clone.setOpacity(0.75);clone.cloned=true;clone.proto=node;return clone;},findMarker:function(event){event=Mohawk.DOM.event(event);var marker=true;var last=false;var prev=false;var cur=event.cursor();for(var i=0;i<self.element.childNodes.length;i++){var child=self.element.childNodes[i];if(!child.cloned){last=child;var coord=child.coordinates();if(self.orientation=='vertical'){if(cur.y>coord.y-child.offsetHeight/2){prev=child;}else{return prev?{node:prev,after:false}:false;}}else{if(cur.x>coord.x-child.offsetWidth/2){prev=child;}else{return prev?{node:prev,after:false}:false;}}}}
if(self.orientation=='vertical'){return{node:last,after:cur.y>last.coordinates().y};}else{return{node:last,after:cur.x>last.coordinates().x};}},createMarker:function(x,y){if(!self.marker){var marker=document.createElement('DIV');marker.addClass(self.marker_class);marker.style.position='absolute';document.body.appendChild(marker);Dragdrop.bringToFront(marker);self.marker=marker;}
self.marker.style.left=x+'px';self.marker.style.top=y+'px';},setMarkerBefore:function(node){var x=node.coordinates().x-self.node_margin.x-self.marker_size.width/2;var y=node.coordinates().y-self.marker_size.height/2;self.createMarker(x,y);},setMarkerAfter:function(node){if(self.orientation=='vertical'){var x=node.coordinates().x+self.node_margin.x-self.marker_size.width/2;var y=node.coordinates().y+node.offsetHeight-self.marker_size.height/2;}else{var x=node.coordinates().x+self.node_margin.x+node.offsetWidth-self.marker_size.width/2;var y=node.coordinates().y-self.marker_size.height/2;}
self.createMarker(x,y);},removeMarker:function(){if(self.marker){self.marker.remove();self.marker=null;}}});window.TemplatesList=Mohawk.UI.SortableList.extend({orientation:'vertical',movable:true,marker_class:'templates-marker',createNode:function(data){var node=parent.createNode(data);node.setHTML('');node.onmousedown=function(event){event=DOM.event(event);if(event.button!=BTN_LEFT){return;}
self.clone=self.createClone(node);var categories=[self.element];for(var i=0;i<Templates.Categories.element.childNodes.length;i++){categories.push(Templates.Categories.element.childNodes[i]);};Dragdrop.setTarget.apply(Dragdrop,categories);self.element.appendChild(self.clone);Dragdrop.pick(event,[self.clone]);return false;};var title=DOM.element('A');title.href='#'+data.id;title.addClass('script');title.setHTML(data.title);node.appendChild(title);title.onmousedown=DOM.stopEvent;title.onclick=function(){Templates.Form.set(data);return false;};return node;}});window.TemplatesCategories=Mohawk.UI.SortableList.extend({orientation:'horizontal',marker_class:'tabs-marker',marker_size:{width:16,height:16},editing:null,createNode:function(data){var node=parent.createNode(data);node.ondragover=function(){this.addClass('dragover');};node.ondragout=function(){this.removeClass('dragover');};node.ondrop=function(){Templates.edit(Templates.List.clone.proto.data.id,{category:this.data.id});this.removeClass('dragover');};node.purgeChildren();var btn_move=DOM.element('IMG');btn_move.src=URL.img+'site/move.png';btn_move.addClass('btn','move','default');btn_move.onmousedown=node.onmousedown;btn_move.appendTo(node);var title=DOM.element('A');title.href=URL['this']+'#category-'+node.data.id;title.setHTML(data['title_'+ENV.language]||'-- no title --');title.appendTo(node);var btn_edit=DOM.element('IMG');btn_edit.src=URL.img+'site/edit.gif';btn_edit.addClass('btn','edit','default');btn_edit.appendTo(node);btn_edit.onclick=function(){Categories.Form.set(data);};node.onmousedown=DOM.stopEvent;node.onclick=DOM.stopEvent;return node;},hide:function(){if(self.editing){self.editing.removeClass('mode-editing');self.editing=null;}},compareNodes:function(node1,node2){return node1.data.position<=node2.data.position;},select:function(node){if(self.current){self.current.removeClass('current');}
if(node){node.addClass('current');}
self.current=node;},unselect:function(){self.select(null);}});window.Shadow=new Singletone({element:null,__construct:function(){var shadow=document.createElement('DIV');shadow.addClass('hidden');shadow.id='shadow';self.element=shadow;},init:function(){document.body.appendChild(self.element);},hide:function(){self.element.addClass('hidden');},show:function(){self.element.removeClass('hidden');self.element.style.height=(document.body.scrollHeight||document.documentElement.scrollHeight)+'px';window.scrollTo(0,0);Dragdrop.bringToFront(self.element);}});window.AnchorObserver=new Singletone({timeout:10,current:'',events:{},__construct:function(){self.events={};self.timeout=500;},add:function(pattern,action){self.events[pattern]=action;},start:function(){self.current=window.location.hash.substring(1)
self.fire();self.test();},test:function(){var hash=window.location.hash.substring(1);if(hash!=self.current){self.current=hash;self.fire();}
setTimeout(function(){self.test.apply(self);},self.timeout);},fire:function(){foreach(self.events,function(pattern,event){var m=RegExp(pattern).exec(self.current);if(m){m.shift();event.apply(null,m);return false;}});}});document.addLoader(function(){if(document.body.id!='templates-admin'){return;}
window.Templates=new TemplatesApi;Shadow.init();Templates.Form=new TemplatesForm;Templates.List=new TemplatesList('templates-list',Data.templates);ID('templates-list').replace(Templates.List.element);Templates.Categories=new TemplatesCategories('templates-categories',Data.categories);document._toHideOnClick.push(Templates.Categories);ID('templates-categories').replace(Templates.Categories.element);if(Templates.Categories.getNode(ENV.tab)){Templates.Categories.select(Templates.Categories.getNode(ENV.category));}
window.Categories=new CategoriesApi;Categories.Form=new CategoriesForm;Observer.add('category-added',function(item){Data.categories.push(item);Categories.Form.hide();Templates.Categories.addNode(item);});Observer.add('category-edited',function(item){var id=-1;foreach(Data.categories,function(i,category){if(category.id==item.id){id=i;return false;}});if(id>0){Data.categories[id]=item;}else{Data.categories.push(item);}
Categories.Form.hide();Templates.Categories.editNode(Templates.Categories.getNode(item.id),item);});Observer.add('category-removed',function(id){Templates.Categories.removeNode(Templates.Categories.getNode(id));});Observer.add(Templates.Categories.EVENT_SORTED,function(){Categories.sort();});AnchorObserver.add('(?:(?:category-(\\d+))|(all-templates))?',function(id,all_templates){var category=null;if(all_templates!==undefined){ENV.category=0;}else if(id!==undefined){ENV.category=id;category=Templates.Categories.getNode(id);if(!category){return;}}else{tab=Templates.Categories.element.firstChild;if(tab){ENV.tab=tab.data.id;}else{ENV.tab=0;}}
Progress.load(LNG.Loading_tab);if(category){Templates.Categories.select(category);ID('all-templates').removeClass('selected');}else{Templates.Categories.unselect();ID('all-templates').addClass('selected');}
Templates.List.element.removeChildren();foreach(Data.templates,function(i,template){if(!ENV.category||template.category==ENV.category){Templates.List.addNode(template);}});Progress.done(LNG.Done,true);});AnchorObserver.start();Observer.add('template-added',function(item){Data.templates.push(item);Templates.List.addNode(item);Templates.Form.hide();});Observer.add('template-edited',function(item){var ind=-1;foreach(Data.templates,function(i,template){if(template.id==item.id){ind=i;return false;}});if(ind>=0){Data.templates[ind]=item;}else{Data.templates.push(item);}
var moved=ENV.category&&item.category!==undefined&&item.category!=ENV.category;if(moved){Templates.List.removeNode(Templates.List.getNode(item.id));}else{Templates.List.editNode(Templates.List.getNode(item.id),item);}
Templates.Form.hide();});Observer.add('template-sorted',function(item){foreach(Data.templates,function(i,template){foreach(item,function(j,data){if(goal.id==data.id){Data.templates[i].position=data.position;return false;}});});});Observer.add('template-removed',function(item){Templates.List.removeNode(Templates.List.getNode(item));Templates.Form.hide();});Observer.add('form-submitted',function(data){if(!data.id){data.position=Templates.List.element.childNodes.length;Templates.add(data);}else{Templates.edit(data.id,data);}});Observer.add('categories-submitted',function(data){if(!data.id){data.position=Templates.Categories.element.childNodes.length;Categories.add(data);}else{Categories.edit(data.id,data);}});Observer.add(Templates.List.EVENT_SORTED,function(){Templates.sort();});});
window.IconsApi=new Class({__construct:function(){self.Uploader=new SWFUpload({upload_url:URL.home+'api/upload/',flash_url:URL.js+'3dparty/SWFUpload/Flash/swfupload.swf',file_size_limit:'20 MB',button_text:'<span class="upload">Upload files</span>',button_text_style:'.upload {font-family: Arial; font-size: 12px; color: #3e4b99; text-decoration: underline;}',button_width:70,button_height:20,button_placeholder_id:'icons-uploader',button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,file_queued_handler:function(file){Icons.List.addNode({id:file.id,user:ENV.UID,src:'loading.png'});},file_queue_error_handler:function(file,errorCode,message){var node=Icons.List.getNode(file.id);node.setStatus('error');},file_dialog_complete_handler:function(numFilesSelected,numFilesQueued){this.startUpload();},upload_start_handler:function(file){var node=Icons.List.getNode(file.id);node.setStatus('uploading...');return true;},upload_progress_handler:function(file,bytesLoaded,bytesTotal){var percent=Math.ceil((bytesLoaded/bytesTotal)*100);var node=Icons.List.getNode(file.id);node.setStatus(percent+'%');},upload_error_handler:function(file,errorCode,message){var node=Icons.List.getNode(file.id);node.setStatus('error');},upload_success_handler:function(file,serverData){var node=Icons.List.getNode(file.id);var data=XML.parse(serverData);if(!data||!data.file){node.setStatus('error');return;}
node.setStatus('uploaded');var req=new Ajax(URL.home+'api/icons/',Ajax.METHOD_POST);req.responseHandler=function(req){var item=req.data.item;if(!item){node.setStatus('error');Console.log(req.data.error);}else{Icons.List.editNode(node,item);}};req.send({tmp_name:data.file.tmp_name});}});},edit:function(){},sort:function(){var data=[];var req=new Ajax(URL.home+'api/icons/',Ajax.METHOD_PUT);for(var i=0;i<Icons.List.element.childNodes.length;i++){var icon=Icons.List.element.childNodes[i];if(icon.clone===true){continue;}
data.push(icon.data.id);};req.send({id:data});},remove:function(){if(!self.List.selected.length){return;}
if(!confirm('Delete icon(s)? There is NO undo!')){return;}
var req=new Ajax(URL.home+'api/icons/',Ajax.METHOD_DELETE);req.responseHandler=function(req){var item=req.data.item;if(!item){node.setStatus('error');Console.log(req.data.error);}else{if(!(item instanceof Array)){item=[item];}
foreach(item,function(i,id){Icons.List.removeNode(Icons.List.getNode(id));});}};var data=[];foreach(self.List.selected,function(i,icon){data.push(icon.data.id);});req.send({id:data});}});var SWFUpload;if(SWFUpload==undefined){SWFUpload=function(settings){this.initSWFUpload(settings);};}
SWFUpload.prototype.initSWFUpload=function(settings){try{this.customSettings={};this.settings=settings;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo();}catch(ex){delete SWFUpload.instances[this.movieName];throw ex;}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 2009-03-25";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.completeURL=function(url){if(typeof(url)!=="string"||url.match(/^https?:\/\//i)||url.match(/^\//)){return url;}
var currentURL=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var indexSlash=window.location.pathname.lastIndexOf("/");if(indexSlash<=0){path="/";}else{path=window.location.pathname.substr(0,indexSlash)+"/";}
return path+url;};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(settingName,defaultValue){this.settings[settingName]=(this.settings[settingName]==undefined)?defaultValue:this.settings[settingName];};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",false);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(!!this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+new Date().getTime();}
if(!this.settings.preserve_relative_urls){this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url);this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url);}
delete this.ensureDefault;};SWFUpload.prototype.loadFlash=function(){var targetElement,tempParent;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";}
targetElement=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(targetElement==undefined){throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;}
tempParent=document.createElement("div");tempParent.innerHTML=this.getFlashHTML();targetElement.parentNode.replaceChild(tempParent.firstChild,targetElement);if(window[this.movieName]==undefined){window[this.movieName]=this.getMovieElement();}};SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />','</object>'].join("");};SWFUpload.prototype.getFlashVars=function(){var paramString=this.buildParamString();var httpSuccessString=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(httpSuccessString),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(paramString),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("");};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName);}
if(this.movieElement===null){throw"Could not find Flash element";}
return this.movieElement;};SWFUpload.prototype.buildParamString=function(){var postParams=this.settings.post_params;var paramStringPairs=[];if(typeof(postParams)==="object"){for(var name in postParams){if(postParams.hasOwnProperty(name)){paramStringPairs.push(encodeURIComponent(name.toString())+"="+encodeURIComponent(postParams[name].toString()));}}}
return paramStringPairs.join("&amp;");};SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,false);var movieElement=null;movieElement=this.getMovieElement();if(movieElement&&typeof(movieElement.CallFunction)==="unknown"){for(var i in movieElement){try{if(typeof(movieElement[i])==="function"){movieElement[i]=null;}}catch(ex1){}}
try{movieElement.parentNode.removeChild(movieElement);}catch(ex){}}
window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieElement=null;this.settings=null;this.customSettings=null;this.eventQueue=null;this.movieName=null;return true;}catch(ex2){return false;}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","\t","http_success:             ",this.settings.http_success.join(", "),"\n","\t","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_placeholder:       ",(this.settings.button_placeholder?"Set":"Not Set"),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""));};SWFUpload.prototype.addSetting=function(name,value,default_value){if(value==undefined){return(this.settings[name]=default_value);}else{return(this.settings[name]=value);}};SWFUpload.prototype.getSetting=function(name){if(this.settings[name]!=undefined){return this.settings[name];}
return"";};SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement();var returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+'</invoke>');returnValue=eval(returnString);}catch(ex){throw"Call to "+functionName+" failed";}
if(returnValue!=undefined&&typeof returnValue.post==="object"){returnValue=this.unescapeFilePostParams(returnValue);}
return returnValue;};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile");};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles");};SWFUpload.prototype.startUpload=function(fileID){this.callFlash("StartUpload",[fileID]);};SWFUpload.prototype.cancelUpload=function(fileID,triggerErrorEvent){if(triggerErrorEvent!==false){triggerErrorEvent=true;}
this.callFlash("CancelUpload",[fileID,triggerErrorEvent]);};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload");};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats");};SWFUpload.prototype.setStats=function(statsObject){this.callFlash("SetStats",[statsObject]);};SWFUpload.prototype.getFile=function(fileID){if(typeof(fileID)==="number"){return this.callFlash("GetFileByIndex",[fileID]);}else{return this.callFlash("GetFile",[fileID]);}};SWFUpload.prototype.addFileParam=function(fileID,name,value){return this.callFlash("AddFileParam",[fileID,name,value]);};SWFUpload.prototype.removeFileParam=function(fileID,name){this.callFlash("RemoveFileParam",[fileID,name]);};SWFUpload.prototype.setUploadURL=function(url){this.settings.upload_url=url.toString();this.callFlash("SetUploadURL",[url]);};SWFUpload.prototype.setPostParams=function(paramsObject){this.settings.post_params=paramsObject;this.callFlash("SetPostParams",[paramsObject]);};SWFUpload.prototype.addPostParam=function(name,value){this.settings.post_params[name]=value;this.callFlash("SetPostParams",[this.settings.post_params]);};SWFUpload.prototype.removePostParam=function(name){delete this.settings.post_params[name];this.callFlash("SetPostParams",[this.settings.post_params]);};SWFUpload.prototype.setFileTypes=function(types,description){this.settings.file_types=types;this.settings.file_types_description=description;this.callFlash("SetFileTypes",[types,description]);};SWFUpload.prototype.setFileSizeLimit=function(fileSizeLimit){this.settings.file_size_limit=fileSizeLimit;this.callFlash("SetFileSizeLimit",[fileSizeLimit]);};SWFUpload.prototype.setFileUploadLimit=function(fileUploadLimit){this.settings.file_upload_limit=fileUploadLimit;this.callFlash("SetFileUploadLimit",[fileUploadLimit]);};SWFUpload.prototype.setFileQueueLimit=function(fileQueueLimit){this.settings.file_queue_limit=fileQueueLimit;this.callFlash("SetFileQueueLimit",[fileQueueLimit]);};SWFUpload.prototype.setFilePostName=function(filePostName){this.settings.file_post_name=filePostName;this.callFlash("SetFilePostName",[filePostName]);};SWFUpload.prototype.setUseQueryString=function(useQueryString){this.settings.use_query_string=useQueryString;this.callFlash("SetUseQueryString",[useQueryString]);};SWFUpload.prototype.setRequeueOnError=function(requeueOnError){this.settings.requeue_on_error=requeueOnError;this.callFlash("SetRequeueOnError",[requeueOnError]);};SWFUpload.prototype.setHTTPSuccess=function(http_status_codes){if(typeof http_status_codes==="string"){http_status_codes=http_status_codes.replace(" ","").split(",");}
this.settings.http_success=http_status_codes;this.callFlash("SetHTTPSuccess",[http_status_codes]);};SWFUpload.prototype.setAssumeSuccessTimeout=function(timeout_seconds){this.settings.assume_success_timeout=timeout_seconds;this.callFlash("SetAssumeSuccessTimeout",[timeout_seconds]);};SWFUpload.prototype.setDebugEnabled=function(debugEnabled){this.settings.debug_enabled=debugEnabled;this.callFlash("SetDebugEnabled",[debugEnabled]);};SWFUpload.prototype.setButtonImageURL=function(buttonImageURL){if(buttonImageURL==undefined){buttonImageURL="";}
this.settings.button_image_url=buttonImageURL;this.callFlash("SetButtonImageURL",[buttonImageURL]);};SWFUpload.prototype.setButtonDimensions=function(width,height){this.settings.button_width=width;this.settings.button_height=height;var movie=this.getMovieElement();if(movie!=undefined){movie.style.width=width+"px";movie.style.height=height+"px";}
this.callFlash("SetButtonDimensions",[width,height]);};SWFUpload.prototype.setButtonText=function(html){this.settings.button_text=html;this.callFlash("SetButtonText",[html]);};SWFUpload.prototype.setButtonTextPadding=function(left,top){this.settings.button_text_top_padding=top;this.settings.button_text_left_padding=left;this.callFlash("SetButtonTextPadding",[left,top]);};SWFUpload.prototype.setButtonTextStyle=function(css){this.settings.button_text_style=css;this.callFlash("SetButtonTextStyle",[css]);};SWFUpload.prototype.setButtonDisabled=function(isDisabled){this.settings.button_disabled=isDisabled;this.callFlash("SetButtonDisabled",[isDisabled]);};SWFUpload.prototype.setButtonAction=function(buttonAction){this.settings.button_action=buttonAction;this.callFlash("SetButtonAction",[buttonAction]);};SWFUpload.prototype.setButtonCursor=function(cursor){this.settings.button_cursor=cursor;this.callFlash("SetButtonCursor",[cursor]);};SWFUpload.prototype.queueEvent=function(handlerName,argumentArray){if(argumentArray==undefined){argumentArray=[];}else if(!(argumentArray instanceof Array)){argumentArray=[argumentArray];}
var self=this;if(typeof this.settings[handlerName]==="function"){this.eventQueue.push(function(){this.settings[handlerName].apply(this,argumentArray);});setTimeout(function(){self.executeNextEvent();},0);}else if(this.settings[handlerName]!==null){throw"Event handler "+handlerName+" is unknown or is not a function";}};SWFUpload.prototype.executeNextEvent=function(){var f=this.eventQueue?this.eventQueue.shift():null;if(typeof(f)==="function"){f.apply(this);}};SWFUpload.prototype.unescapeFilePostParams=function(file){var reg=/[$]([0-9a-f]{4})/i;var unescapedPost={};var uk;if(file!=undefined){for(var k in file.post){if(file.post.hasOwnProperty(k)){uk=k;var match;while((match=reg.exec(uk))!==null){uk=uk.replace(match[0],String.fromCharCode(parseInt("0x"+match[1],16)));}
unescapedPost[uk]=file.post[k];}}
file.post=unescapedPost;}
return file;};SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface");}catch(ex){return false;}};SWFUpload.prototype.flashReady=function(){var movieElement=this.getMovieElement();if(!movieElement){this.debug("Flash called back ready but the flash movie can't be found.");return;}
this.cleanUp(movieElement);this.queueEvent("swfupload_loaded_handler");};SWFUpload.prototype.cleanUp=function(movieElement){try{if(this.movieElement&&typeof(movieElement.CallFunction)==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var key in movieElement){try{if(typeof(movieElement[key])==="function"){movieElement[key]=null;}}catch(ex){}}}}catch(ex1){}
window["__flash__removeCallback"]=function(instance,name){try{if(instance){instance[name]=null;}}catch(flashEx){}};};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler");};SWFUpload.prototype.fileQueued=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("file_queued_handler",file);};SWFUpload.prototype.fileQueueError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("file_queue_error_handler",[file,errorCode,message]);};SWFUpload.prototype.fileDialogComplete=function(numFilesSelected,numFilesQueued,numFilesInQueue){this.queueEvent("file_dialog_complete_handler",[numFilesSelected,numFilesQueued,numFilesInQueue]);};SWFUpload.prototype.uploadStart=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("return_upload_start_handler",file);};SWFUpload.prototype.returnUploadStart=function(file){var returnValue;if(typeof this.settings.upload_start_handler==="function"){file=this.unescapeFilePostParams(file);returnValue=this.settings.upload_start_handler.call(this,file);}else if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function";}
if(returnValue===undefined){returnValue=true;}
returnValue=!!returnValue;this.callFlash("ReturnUploadStart",[returnValue]);};SWFUpload.prototype.uploadProgress=function(file,bytesComplete,bytesTotal){file=this.unescapeFilePostParams(file);this.queueEvent("upload_progress_handler",[file,bytesComplete,bytesTotal]);};SWFUpload.prototype.uploadError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("upload_error_handler",[file,errorCode,message]);};SWFUpload.prototype.uploadSuccess=function(file,serverData,responseReceived){file=this.unescapeFilePostParams(file);this.queueEvent("upload_success_handler",[file,serverData,responseReceived]);};SWFUpload.prototype.uploadComplete=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("upload_complete_handler",file);};SWFUpload.prototype.debug=function(message){this.queueEvent("debug_handler",message);};SWFUpload.prototype.debugMessage=function(message){if(this.settings.debug){var exceptionMessage,exceptionValues=[];if(typeof message==="object"&&typeof message.name==="string"&&typeof message.message==="string"){for(var key in message){if(message.hasOwnProperty(key)){exceptionValues.push(key+": "+message[key]);}}
exceptionMessage=exceptionValues.join("\n")||"";exceptionValues=exceptionMessage.split("\n");exceptionMessage="EXCEPTION: "+exceptionValues.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(exceptionMessage);}else{SWFUpload.Console.writeLine(message);}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(message){var console,documentForm;try{console=document.getElementById("SWFUpload_Console");if(!console){documentForm=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(documentForm);console=document.createElement("textarea");console.id="SWFUpload_Console";console.style.fontFamily="monospace";console.setAttribute("wrap","off");console.wrap="off";console.style.overflow="auto";console.style.width="700px";console.style.height="350px";console.style.margin="5px";documentForm.appendChild(console);}
console.value+=message+"\n";console.scrollTop=console.scrollHeight-console.clientHeight;}catch(ex){alert("Exception: "+ex.name+" Message: "+ex.message);}};window.SWFUpload=SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.queue={};SWFUpload.prototype.initSettings=(function(oldInitSettings){return function(){if(typeof(oldInitSettings)==="function"){oldInitSettings.call(this);}
this.queueSettings={};this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0;this.queueSettings.user_upload_complete_handler=this.settings.upload_complete_handler;this.queueSettings.user_upload_start_handler=this.settings.upload_start_handler;this.settings.upload_complete_handler=SWFUpload.queue.uploadCompleteHandler;this.settings.upload_start_handler=SWFUpload.queue.uploadStartHandler;this.settings.queue_complete_handler=this.settings.queue_complete_handler||null;};})(SWFUpload.prototype.initSettings);SWFUpload.prototype.startUpload=function(fileID){this.queueSettings.queue_cancelled_flag=false;this.callFlash("StartUpload",[fileID]);};SWFUpload.prototype.cancelQueue=function(){this.queueSettings.queue_cancelled_flag=true;this.stopUpload();var stats=this.getStats();while(stats.files_queued>0){this.cancelUpload();stats=this.getStats();}};SWFUpload.queue.uploadStartHandler=function(file){var returnValue;if(typeof(this.queueSettings.user_upload_start_handler)==="function"){returnValue=this.queueSettings.user_upload_start_handler.call(this,file);}
returnValue=(returnValue===false)?false:true;this.queueSettings.queue_cancelled_flag=!returnValue;return returnValue;};SWFUpload.queue.uploadCompleteHandler=function(file){var user_upload_complete_handler=this.queueSettings.user_upload_complete_handler;var continueUpload;if(file.filestatus===SWFUpload.FILE_STATUS.COMPLETE){this.queueSettings.queue_upload_count++;}
if(typeof(user_upload_complete_handler)==="function"){continueUpload=(user_upload_complete_handler.call(this,file)===false)?false:true;}else if(file.filestatus===SWFUpload.FILE_STATUS.QUEUED){continueUpload=false;}else{continueUpload=true;}
if(continueUpload){var stats=this.getStats();if(stats.files_queued>0&&this.queueSettings.queue_cancelled_flag===false){this.startUpload();}else if(this.queueSettings.queue_cancelled_flag===false){this.queueEvent("queue_complete_handler",[this.queueSettings.queue_upload_count]);this.queueSettings.queue_upload_count=0;}else{this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0;}}};}
Mohawk.UI.DraggableList=Mohawk.UI.SelectableList.extend({node_margin:new Pixel(5,5),marker_size:{width:6,height:42},marker:null,orientation:'vertical',target:[],target_object:{},__construct:function(name,data){parent.__construct(name,data);self.EVENT_SORTED=self.name+'-sorted';self.element.ondragover=function(event){var marker=this.object.findMarker(event);if(marker===false){this.object.removeMarker();}else{if(marker.after===true){this.object.setMarkerAfter(marker.node);}else{this.object.setMarkerBefore(marker.node);}}};self.element.ondragout=function(event){this.object.removeMarker();};self.element.ondrop=function(event){var self=this.object;var marker=self.findMarker(event);if(marker){if(marker.after===true){for(var i=self.target.length-1;i>=0;i--){self.element.insertBefore(self.target[i],marker.node.nextSibling);}}else{for(var i=0;i<self.target.length;i++){self.element.insertBefore(self.target[i],marker.node);}}
self.refreshTargetObject();Observer.fire(self.EVENT_SORTED);}
self.removeMarker();return marker;};document.addEvent('click',function(){self.unselectAll();});},appendTo:function(node){parent.appendTo(node);self.refreshTargetObject();},refreshTargetObject:function(){if(self.element.parentNode){if(self.element.childNodes.length){self.target_object=Dragdrop.createTargetObject([self.element],self.element.childNodes);}else{self.target_object=Dragdrop.createTargetObject([self.element]);}}},setTarget:function(nodes){self.target=[];for(var i=0;i<nodes.length;i++){self.target.push(nodes[i]);}},setChildren:function(structure){parent.setChildren(structure);self.refreshTargetObject();},addNode:function(data){parent.addNode(data);self.refreshTargetObject();},editNode:function(node,data){node=parent.editNode(node,data);self.refreshTargetObject();return node;},removeNode:function(node){parent.removeNode(node);self.refreshTargetObject();},createNode:function(data){var node=parent.createNode(data);node.onmousedown=function(event){event=Mohawk.DOM.event(event);if(event.button==BTN_LEFT){if(!node.isSelected()||event.ctrlKey){self.select(event,node);}
if(self.selected.length){self.setTarget(self.selected);}else{self.setTarget([node]);}
Dragdrop.setTargetObject(self.target_object);var clones=[];foreach(self.target,function(){var clone=self.createClone(this);clone.ondrop=function(){this.remove();this.proto.parent.object.target=[];};if(this==node){clone.onrelease=function(event){this.remove();if(this.proto.onclick instanceof Function){this.proto.onclick.call(this,event);}
this.proto.parent.object.target=[];};}else{clone.onrelease=function(event){this.remove();this.proto.parent.object.target=[];};}
self.element.appendChild(clone);clones.push(clone);});Dragdrop.pick(event,clones);}};node.onclick=function(event){event=Mohawk.DOM.event(event);if(event.button==BTN_LEFT){if(node.isSelected()&&!event.ctrlKey){self.select(event,node);}
if(node.ondblclick instanceof Function&&!OPERA){var now=new Date;if(node.last_click instanceof Date){if(now.getTime()-node.last_click.getTime()<1000){node.ondblclick();}}
node.last_click=now;}
event.stopPropagation();}};node.ondragover=function(event){this.addClass('dragover');};node.ondragout=function(event){this.removeClass('dragover');};node.ondrop=function(event){this.removeClass('dragover');};return node;},createClone:function(node){var clone=node.cloneNode(true);clone.addClass(Dragdrop.css_class);clone.style.position='absolute';clone.style.left=node.offsetLeft-self.node_margin.x+'px';clone.style.top=node.offsetTop-self.node_margin.y+'px';clone.setOpacity(0.5);clone.clone=true;clone.proto=node;return clone;},findMarker:function(event){DOM.event(event);var marker=true;var last=false;var prev=false;var width=self.element.firstChild.offsetWidth+self.node_margin.x*2;var height=self.element.firstChild.offsetWidth+self.node_margin.y*2;var in_a_row=Math.floor(self.element.offsetWidth/width);var cur=new Pixel(event.cursor().x-self.element.coordinates().x,event.cursor().y-self.element.coordinates().y);var x_num=Math.floor(cur.x/width);if(cur.x>in_a_row*width){x_num=in_a_row-1;}
var y_num=Math.floor(cur.y/height);var cell_cur=new Pixel(cur.x-x_num*width,cur.y-y_num*height);if(cell_cur.y>self.node_margin.y&&cell_cur.y<self.node_margin.y+self.element.firstChild.offsetHeight){if(cell_cur.x>self.node_margin.x+self.element.firstChild.offsetWidth){var after=true;}else if(cell_cur.x<self.node_margin.x){var after=false;}else{return false;}
var num=x_num+in_a_row*y_num;return{node:self.element.childNodes[num],after:after};}else{return false;}},createMarker:function(x,y){if(!self.marker){var marker=document.createElement('DIV');marker.addClass('marker');marker.style.position='absolute';marker.style.left=x+'px';marker.style.top=y+'px';document.body.appendChild(marker);self.marker=marker;Dragdrop.bringToFront(marker);}},setMarkerBefore:function(node){var x=node.coordinates().x-self.node_margin.x-self.marker_size.width/2;var y=node.coordinates().y+(node.offsetHeight-self.marker_size.height)/2;self.createMarker(x,y);},setMarkerAfter:function(node){var x=node.coordinates().x+node.offsetWidth+self.node_margin.x-self.marker_size.width/2;var y=node.coordinates().y+(node.offsetHeight-self.marker_size.height)/2;self.createMarker(x,y);},removeMarker:function(){if(self.marker){self.marker.remove();self.marker=null;}}});window.IconsAdminList=Mohawk.UI.DraggableList.extend({node_margin:new Pixel(5,5),marker_size:{width:6,height:100},createNode:function(data){var node=parent.createNode(data);node.addClass('rounded');var img=DOM.element('IMG');img.src=data.src;img.addClass('icon');node.setHTML('');node.appendChild(img);var progress=DOM.element('DIV');progress.addClass('progress');node.appendChild(progress);node.setStatus=function(status){progress.setHTML(status);};return node;}});document.addLoader(function(){if(document.body.id!='page-icons'){return;}
window.Icons=new IconsApi;Icons.List=new IconsAdminList('icons-list',Object.values(Data.icons));ID('icons-list').replace(Icons.List.element);Icons.List.refreshTargetObject();Observer.add(Icons.List.EVENT_SORTED,Icons.sort);});
window.CommunitiesApi=new Class({add:function(data){var req=new Ajax(URL.home+'api/communities/',Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.item){Observer.fire('community-added',req.data.item);Progress.done(LNG.Saved,true);}else{self.showErrors(Communities.Form,req.data.error);Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},edit:function(id,data){var req=new Ajax(URL.home+'api/communities/'+id+'/',Ajax.METHOD_PUT);req.responseHandler=function(req){if(req.data.item){Observer.fire('community-edited',req.data.item);Progress.done(LNG.Saved,true);}else{self.showErrors(Communities.Form,req.data.error);Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},addIcons:function(icons){if(icons){if(icons.id){icons=[icons];}
foreach(icons,function(i,icon){Data.icons[icon.id]=icon.src;});}},showErrors:function(form,error){foreach(error,function(name){var input=form.element[name];if(!input){return true;}
var error=input.nextTag('B');if(!error){error=document.createElement('B');error.addClass('error');input.parentNode.insertAfter(error,input);}
error.innerHTML=this;});},remove:function(id){if(!confirm(LNG.Confirm_delete)){return;}
var req=new Ajax(URL.home+'api/communities/'+id+'/',Ajax.METHOD_DELETE);req.responseHandler=function(req){if(req.data.item){var item=req.data.item;Observer.fire('community-removed',item);Progress.done(LNG.Deleted,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send();Progress.load(LNG.Deleting);}});window.Uploader=new Class({id:'',frame:null,input:null,__construct:function(element){self.frame=DOM.element('iframe',{id:element.id,src:URL.home+'system/upload/',className:'file-upload-frame',allowTransparency:true,scrolling:'no',frameBorder:0});self.frame.addEvent('load',self.onload);self.frame.object=self;element.replace(self.frame);},onload:function(){var frame=window.event?window.event.srcElement:this;var win=frame.contentWindow;if(win.data){frame.object.onUpload(win.data);}},onUpload:function(){}});window.CommunitiesForm=new Class({element:null,__construct:function(){self.element=self.createForm();document.body.appendChild(self.element);self.element.addClass('hidden');},createForm:function(){var form=document.createElement('FORM');form.object=self;window.COMMUNITIES_FORM="<fieldset>"+"\n    <img id=\"goals-form-close\" src=\"{%URL.img}site/close.png\" onclick=\"Communities.Form.hide(); return false;\" />"+"\n    <input type=\"hidden\" name=\"id\" />"+"\n    <ul class=\"fields\">"+"\n        <li>"+"\n            <label class=\"block\">Title</label>"+"\n            <input name=\"title\" class=\"text\" onchange=\"if (!this.form.name.value) {var name = this.value.toLowerCase(); name = name.replace(/[^a-z0-9-_]+/ig, '_'); this.form.name.value = name;}\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Picture</label>"+"\n            <div id=\"community-picture-uploader\" class=\"picture-uploader\"></div>"+"\n            <input type=\"text\" name=\"picture_name\" readonly=\"readonly\" />"+"\n            <input type=\"text\" class=\"small\" name=\"picture_size\" readonly=\"readonly\" />"+"\n            <input type=\"hidden\" name=\"picture_tmpname\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Thumbnail</label>"+"\n            <div id=\"community-thumbnail-uploader\" class=\"picture-uploader\"></div>"+"\n            <input type=\"text\" name=\"thumbnail_name\" readonly=\"readonly\" />"+"\n            <input type=\"text\" class=\"small\" name=\"thumbnail_size\" readonly=\"readonly\" />"+"\n            <input type=\"hidden\" name=\"thumbnail_tmpname\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Name</label>"+"\n            <input name=\"name\" class=\"text\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Overview</label>"+"\n            <input name=\"overview\" class=\"text\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Text</label>"+"\n            <textarea name=\"description\"></textarea>"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Post permission</label>"+"\n            <select name=\"post_permission\">"+"\n                <option value=\"all\">all</option>"+"\n                <option value=\"admins\">admins</option>"+"\n            </select>"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Language</label>"+"\n            <select name=\"language\">"+"\n                <option value=\"*\">any</option>"+"\n                {%for language in Data.languages => code}"+"\n                <option value=\"{%code}\">{%language.title}</option>"+"\n                {%end}"+"\n            </select>"+"\n        </li>"+"\n    </ul>"+"\n    <div class=\"buttons\">"+"\n        <button type=\"submit\">Save</button>"+"\n        or"+"\n        <a href=\"#cancel\" class=\"script\" onclick=\"Communities.Form.hide(); return false;\">cancel</a>"+"\n        &nbsp;&nbsp;&nbsp;"+"\n        You may also <a href=\"#delete\" class=\"script\" onclick=\"Communities.remove(Communities.Form.element.id.value); return false;\">delete</a> this community"+"\n    </div>"+"\n</fieldset>";form.setHTML(Template.transform(COMMUNITIES_FORM));form.id='goals-form';form.onmousedown=DOM.stopEvent;form.onsubmit=function(){self.save.apply(self,[form]);return false;};form.PictureUploader=new Uploader(form.getElementById('community-picture-uploader'));form.PictureUploader.onUpload=function(data){if(!data||!data.file){Progress.done('Error');return;}
form.setData({picture_tmpname:data.file.tmp_name,picture_name:data.file.name,picture_size:data.file.size});};form.ThumbnailUploader=new Uploader(form.getElementById('community-thumbnail-uploader'));form.ThumbnailUploader.onUpload=function(data){if(!data||!data.file){Progress.done('Error');return;}
form.setData({thumbnail_tmpname:data.file.tmp_name,thumbnail_name:data.file.name,thumbnail_size:data.file.size});};return form;},save:function(form){foreach(form.getElementsByClassName('error'),function(){this.remove();});var data=form.getData();Observer.fire('form-submitted',data);},set:function(data){self.element.removeClass('hidden');Shadow.show();Dragdrop.bringToFront(self.element);self.element.setData({'id':''});self.element.reset();if(data){self.element.replaceClass('adding','editing');self.element.setData(data);}else{self.element.replaceClass('editing','adding');}},hide:function(){Shadow.hide();self.element.addClass('hidden');}});window.CommunitiesList=Mohawk.UI.List.extend({createNode:function(data){var node=parent.createNode(data);node.setHTML('');var title=DOM.element('a',{href:'#'+data.id,className:'script',html:data.title,appendTo:node});title.onclick=function(){Communities.Form.set(data);};return node;}});document.addLoader(function(){if(document.body.id!='communities-admin'){return;}
window.Communities=new CommunitiesApi;Shadow.init();Communities.Form=new CommunitiesForm;Communities.List=new CommunitiesList('communities-list',Data.communities);ID('communities-list').replace(Communities.List.element);Observer.add('community-added',function(item){Data.communities.push(item);Communities.List.addNode(item);Communities.Form.hide();});Observer.add('community-edited',function(item){var ind=-1;foreach(Data.communities,function(i,community){if(community.id==item.id){ind=i;return false;}});if(ind>=0){Data.communities[ind]=item;}else{Data.communities.push(item);}
Communities.List.editNode(Communities.List.getNode(item.id),item);Communities.Form.hide();});Observer.add('community-removed',function(item){Communities.List.removeNode(Communities.List.getNode(item));Communities.Form.hide();});Observer.add('form-submitted',function(data){if(!data.id){data.position=Communities.List.element.childNodes.length;Communities.add(data);}else{Communities.edit(data.id,data);}});});