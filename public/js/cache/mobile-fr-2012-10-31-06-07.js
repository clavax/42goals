
var Mohawk={version:'0.1',UI:{selection:false,selectables:[]},Utils:{},DOM:{},url:URL.js,XHR:function(){var XHR=null;if(window.XMLHttpRequest){XHR=new XMLHttpRequest();}else if(window.ActiveXObject){XHR=new ActiveXObject('Microsoft.XMLHTTP');}else{alert('XMLHttpRequest is disabled in your browser');return false;}
return XHR;}};var IE=typeof(window.ActiveXObject)!='undefined';var FF=navigator.userAgent.match('Gecko')!=null;var OPERA=typeof(window.opera)!='undefined';var WEBKIT=navigator.userAgent.match('WebKit')!=null;if(WEBKIT){FF=false;}
var BTN_LEFT=IE?1:0;var BTN_MIDDLE=IE?4:1;var BTN_RIGHT=2;function extend(target,source,directly){if(target.prototype&&!directly){extend(target.prototype,source);}else{for(var i in source){target[i]=source[i];}}};Function.prototype.parse=function(){var source=this.toSource instanceof Function?this.toSource():this.toString();var regex=new RegExp('\\(?\\s*function\\s*([a-z$_][a-z$_0-9]*)?\\s*\\(\\s*([^\\)]*)\\s*\\)\\s*\\{([^\x01]*)\\}\\s*\\)?\\s*','img');var m=null;if(m=regex.exec(source)){return{name:m[1],params:m[2].split(new RegExp('\\s*,\\s*')),body:m[3]};}else{return null;}};function foreach(iterable,action){if(!action||!action.call){return;}
if(iterable instanceof Array||(typeof(iterable.length)=='number'&&(IE||typeof(iterable.item)=='function'))){for(var i=0;i<iterable.length;i++){var value=action.call(iterable[i],i,iterable[i]);if(value===false){break;}}}else if(iterable instanceof Object){for(var i in iterable){if(typeof(Object.prototype[i])=='undefined'){var value=action.call(iterable[i],i,iterable[i]);if(value===false){break;}}}}}
var ObjectInterface={combine:function(keys,values){var obj={};for(var i=0;i<keys.length;i++){obj[keys[i]]=values[i];}
return obj;},find:function(object,value){for(var i in object){if(value==object[i]){return i;}}
return false;},keys:function(object){var keys=[];for(var i in object){if(typeof(Object.prototype[i])=='undefined'){keys.push(i);}}
return keys;},values:function(object){var values=[];foreach(object,function(){values.push(this);});return values;},clone:function(object){var clone={};foreach(object,function(key){clone[key]=object[key];});return clone;}};var ArrayInterface={remove:function(array,value){var index=Array.find(array,value);if(index!==false){array.splice(index,1);}},find:function(array,value){for(var i=0;i<array.length;i++){if(value==array[i]){return i;}}
return false;},intersect:function(array1,array2,sorted){if(!sorted){array1.sort();array2.sort();}
var i=0,j=0;var unique=[];while(i<array1.length&&j<array2.length){if(array1[i]<array2[j]){i++;}else if(array1[i]>array2[j]){j++;}else{unique.push(array1[i]);i++;j++;}}
return unique;}};extend(Object,ObjectInterface,true);extend(Array,ArrayInterface,true);Math._round=Math.round;var MathInterface={sign:function(x){return x==0?0:(x>0?1:-1);},rand:function(min,max){if(!max){min=0;max=min;}
return Math.round(Math.random()*(max-min))+min;},round:function(num,precision){if(!precision||precision<0){return Math._round(num);}else{var base=Math.pow(10,precision);return Math._round(num*base)/base;}}};extend(Math,MathInterface);var NumberInterface={toHex:function(){if(this==0){return'0';}
var hex='';var digits=['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'];var d=this;var pow=Math.floor(Math.log(d)/Math.log(16));var base=Math.pow(16,pow);for(var i=pow;i>=0;i--){var q=Math.floor(d/base);d-=q*base;hex+=digits[q];base/=16;}
return hex;}};extend(Number,NumberInterface);RegExp.quote=function(str){var regexp=new RegExp('([\\<\\>\\/\\?\\.\\$\\^\\[\\]\\*\\+\\\\])','g');return str.replace(regexp,'\\$1');};var Class=function(object){return this.extend(object);};var Singletone=function(object){var class_interface=new Class(object);var instance=new class_interface();return instance;};Class.prototype={self:null,parent:null,extend:function(descendant){var child=Class.method(descendant.__construct||(this.prototype&&this.prototype.__construct?this.prototype.__construct:function(){}),'Class.setSelf(this); var self = this.self; var parent = this.parent; this.static = arguments.callee; var static = this.static; ');var methods=Object.keys(descendant);child.prototype.parent={};for(var i in this.prototype){if(this.prototype[i]instanceof Function){child.prototype.parent[i]=Class.method(this.prototype[i]);}else{child.prototype.parent[i]=this.prototype[i];}
if(i!='parent'){if(this.prototype[i]instanceof Function){child.prototype[i]=Class.method(this.prototype[i],Array.find(methods,i)===false?'if (parent && parent.parent) {parent = parent.parent};'+Class.label:'');}else{child.prototype[i]=this.prototype[i];}}}
if(typeof(child.base)=='undefined'){child.base={};}
for(var i in this){if(typeof(child[i])=='undefined'){child[i]=this[i];}}
for(var i in descendant){if(descendant[i]instanceof Function){child.prototype[i]=Class.method(descendant[i],'var __function__ = "'+i+'"; var self = this.self; var parent = this.parent; var static = this.static; '+Class.label+'if (self) {try {parent.self = self} catch (e) {}}');}else{child.prototype[i]=descendant[i];}}
child.extend=this.extend;return child;}};Class.extend=Class.prototype.extend;Class.label='Class.here();';Class.here=function(){};Class.method=function(action,add){var source=action.parse();var f=function(){};if(source){if(source.body.indexOf(Class.label)>0){source.body=source.body.replace(Class.label,add||'');}else{source.body=(add||'')+source.body;}
var str='f = function ('+source.params.join(',')+') {'+source.body+'};';eval(str);}else{f=false;}
return f;};Class.setSelf=function(object){var base=object;do{object.self=base;object=object.parent;}while(object&&object.parent);};document.loaders=[];document.callLoaders=function(){if(document.loaded){while(document.loaders.length){var loader=document.loaders.shift();if(loader instanceof Function){loader.call(document);}}}};if(FF){document.addEventListener('DOMContentLoaded',function(){document.loaded=true;document.callLoaders.call(document);},false);}else if(WEBKIT){function callLoaders(){if(Array.find(['loaded','complete'],document.readyState)!==false){document.loaded=true;document.callLoaders.call(document);}else{setTimeout(callLoaders,0);}}
setTimeout(callLoaders,0);}else{document.onreadystatechange=function(){if(Array.find(['loaded','complete'],document.readyState)!==false){document.loaded=true;document.callLoaders();}};}
document.addLoader=function(action){if(document.loaded){action.call(document);}else{if(Array.find(document.loaders,action)===false){document.loaders.push(action);}}};Mohawk.included=[];function include(path){var first=path.substr(0,path.indexOf('.'));var url=Mohawk.url;if(typeof(URL[first])!='undefined'){url=URL[first];path=path.substr(path.indexOf('.')+1);}
var include_path=url+path.replace(new RegExp('\\.','g'),'/')+'.js';if(Array.find(Mohawk.included,include_path)===false){var XHR=Mohawk.XHR();XHR.open('GET',include_path+'?'+(new Date).valueOf(),false);XHR.setRequestHeader('Pragma','no-cache');XHR.setRequestHeader('Expires','-1');XHR.send(null);eval(XHR.responseText);Mohawk.included.push(include_path);delete(XHR);}}
window.Pixel=new Class({x:0,y:0,__construct:function(x,y){if(typeof x!='undefined'){if(typeof y!='undefined'){self.x=x||0;self.y=y||0;}else{self.x=x.x;self.y=x.y;}}},inside:function(rect){return self.x>=rect.start.x&&self.x<=rect.end.x&&self.y>=rect.start.y&&self.y<=rect.end.y;},toString:function(){return[self.x,self.y].toString();}});window.Rect=new Class({start:null,end:null,__construct:function(start,end){if(start&&end){self.start=start;self.end=end;}else{self.start=new Pixel;self.end=new Pixel;}},toString:function(){return[self.start.toString(),self.end.toString()].toString();}});Rect.fromNode=function(node){var start=node.coordinates();return new Rect(start,new Pixel(start.x+node.offsetWidth,start.y+node.offsetHeight));}
Mohawk.Template=new Singletone({vars:{},keywords:['end','else'],assign:function(name,value){if(Array.find(self.keywords,name)!==false){alert(name+' is a keyword');}
self.vars[name]=value;},transform:function(text){var init='';foreach(self.vars,function(name){init+='var '+name+' = self.vars["'+name+'"];';});var variable='[a-z_][a-z_0-9]*(?:\\[[^\\]]*\\]|\\.[a-z_][a-z_0-9]*)*';var modifier='[a-z_][a-z_0-9]*(?:\\.[a-z_][a-z_0-9]*)*';var condition='[^\\}]+';text=text.replace(new RegExp('\"','g'),'\\\"');text=text.replace(new RegExp('\\n','g'),'\\n');text=text.replace(new RegExp('\\{%for\\s+('+variable+') in ('+variable+')\\}','gmi'),'"; for (var __k__ in $2) {'+'if (typeof Object.prototype[__k__] != \'undefined\' || typeof Array.prototype[__k__] != \'undefined\') continue; var $1 = $2[__k__]; __s__ += "');text=text.replace(new RegExp('\\{%for\\s+('+variable+') in ('+variable+')\\s+=>\\s+('+variable+')\\}','gmi'),'"; for (var $3 in $2) {'+'if (typeof Object.prototype[$3] != \'undefined\' || typeof Array.prototype[$3] != \'undefined\') continue; var $1 = $2[$3]; __s__ += "');text=text.replace(new RegExp('\\{%if\\s+('+condition+')\\}','gmi'),'"; if ($1) {__s__ += "');text=text.replace(new RegExp('\\{%elseif\\s+('+condition+')\\}','gmi'),'"; } else if ($1) {__s__ += "');text=text.replace(new RegExp('\\{%else\\}','gmi'),'"; } else { __s__ += "');text=text.replace(new RegExp('\\{%end\\}','gmi'),'"; } __s__ += "');text=text.replace(new RegExp('\\{%('+variable+')\\|('+modifier+')\\}','gmi'),'" + $2($1) + "');text=text.replace(new RegExp('\\{%('+variable+')\\}','gmi'),'" + $1 + "');eval(init+'__s__ = "'+text+'"');return __s__;}});Mohawk.NodeEffectInterface={show:function(effect){if(this.style.visibility=='hidden'){this.style.visibility='visible';if(effect instanceof Function){effect.call(this,this,this.show);}}},hide:function(effect){if(this.style.visibility!='hidden'){if(effect instanceof Function){effect.call(this,this,this.hide);}else{this.style.visibility='hidden';}}},display:function(effect,display){this.style.display=display?display:(this._display?this._display:'block');if(effect instanceof Function){effect.call(this,this,this.display);}},collapse:function(effect){if(this.style.display!='none'){if(effect instanceof Function){effect.call(this,this,this.collapse);}else{this._display=this.style.display;this.style.display='none';}}},toggleDisplay:function(effect){if(e.offsetWidth==0){this.display(effect);}else{this.collapse(effect);}},remove:function(effect){if(this.parentNode){if(effect instanceof Function){effect(this,this.remove);}else{this.parentNode.removeChild(this);}}},setOpacity:function(opacity){if(IE){if(this.tagName&&this.tagName.toUpperCase()=='IMG'&&this.src.match(/\.png$/)){this.style.filter='AlphaImageLoader(src="'+this.src+'", sizingMethod="scale") Alpha(Opacity="'+(opacity*100)+'")';}else{this.style.filter='Alpha(Opacity="'+(opacity*100)+'")';}}else{this.style.opacity=opacity;}},getOpacity:function(opacity){if(IE){}else{return this.style.opacity;}}};Mohawk.Effects=new Singletone({opacity_delay:10,opacity_step:0.025,blink_delay:100,blink_number:3,_stop:false,moving:null,opacity:function(object,start,end,finalize,current){self=Mohawk.Effects;if(typeof current=='undefined'){current=start;object._opacity=object.getOpacity();if(IE){object._filter=object.style.filter;}}
current+=self.opacity_step*Math.sign(end-start);object.setOpacity(current);if(Math.sign(end-start)!=0&&(Math.sign(end-start)==Math.sign(end-current)||!Math.sign(end-current))){setTimeout(function(){self.opacity(object,start,end,finalize,current);},self.opacity_delay);}else{object.setOpacity(end);if(finalize instanceof Function){finalize.call(object);}
object.setOpacity(object._opacity);if(IE){object.style.filter=object._filter;}}},appear:function(object,finalize){Mohawk.Effects.opacity(object,0,1,finalize);},vanish:function(object,finalize){Mohawk.Effects.opacity(object,1,0,finalize);},fold:function(object,finalize){var height=object.offsetHeight;var step=Math.floor(height/48);var _fold=function(){if(height<step||step<=0){object.style.height='0px';if(finalize instanceof Function){finalize.call();}
object.style.overflow='auto';object.style.height='auto';}else{height-=step;object.style.height=height+'px';setTimeout(_fold,1);}};object.style.overflow='hidden';_fold();},unfold:function(object,finalize){var height=0;var end=object.offsetHeight;var step=Math.floor(end/48);var _unfold=function(){if(end-height<step||step<=0){if(finalize instanceof Function){finalize.call();}
object.style.overflow='auto';object.style.height='auto';}else{height+=step;object.style.height=height+'px';setTimeout(_unfold,1);}};object.style.overflow='hidden';object.style.height='0px';_unfold();},strike:function(node,finalize){var html=node.innerHTML;var text=node.textContent||node.innerText;var del=DOM.element('DEL');var span=DOM.element('SPAN');var len=Math.ceil(text.length/5);var _strike=function(){if(text.length<=len){if(finalize instanceof Function){finalize.call();}
node.setHTML(html);}else{var str=text.substr(0,len);text=text.substr(len);del.innerHTML+=str;span.innerHTML=text;setTimeout(_strike,100);}};node.removeChildren();node.appendChild(del);node.appendChild(span);_strike();},blink:function(object,finalize,start,counter){self=Mohawk.Effects;if(typeof counter=='undefined'){counter=0;start=Array.find(['hidden','off'],object.style.visibility)!==false;}
counter++;if(counter<self.blink_number*2){object.style.visibility=(counter+start)%2?'hidden':'visible';setTimeout(function(){self.blink(object,finalize,start,counter)},self.blink_delay);}else{object.style.visibility=start?'visible':'hidden';if(finalize instanceof Function){finalize.call(object);}}},move:function(e,x,y,step_x,step_y,acc_x,acc_y,finalize,offset){var self=Mohawk.Effects;var cur_x=e.offsetLeft;var cur_y=e.offsetTop;if(!offset){var temp=document.createElement('DIV');temp.style.left='0px';temp.style.top='0px';temp.style.position='absolute';e.parentNode.appendChild(temp);offset=new Pixel(temp.offsetLeft,temp.offsetTop);temp.remove();}
if(!x&&x!==0){x=cur_x;}
if(!y&&y!==0){y=cur_y;}
if(!step_x){step_x=1;}
if(!step_y){step_y=1;}
if(!acc_x){acc_x=1;}
if(!acc_y){acc_y=1;}
self._move(e,x,y,step_x,step_y,acc_x,acc_y,finalize,offset);},_move:function(e,x,y,step_x,step_y,acc_x,acc_y,finalize,offset){var self=Mohawk.Effects;var cur_x=e.offsetLeft;var cur_y=e.offsetTop;var moved_x=false;if(Math.abs(cur_x-x)>=step_x){e.style.left=(cur_x+Math.sign(x-cur_x)*step_x)+'px';moved_x=true;}else{e.style.left=x-offset.x+'px';}
var moved_y=false;if(Math.abs(cur_y-y)>=step_y){e.style.top=(cur_y+Math.sign(y-cur_y)*step_y)+'px';moved_y=true;}else{e.style.top=y-offset.y+'px';}
if(moved_x||moved_y){self.moving=setTimeout(function(){self._move(e,x,y,step_x*acc_x,step_y*acc_y,acc_x,acc_y,finalize,offset);},1);}else{if(finalize instanceof Function){finalize.call(e);}}},stop:function(){clearTimeout(self.moving);},scrollTo:function(obj){var to=obj.coordinates().y;var from=document.scrollTop();var step=Math.abs(to-from)/10;var prev=0;var scroll=function(){var now=document.scrollTop();if(now==prev){return;}
if(Math.abs(to-now)<=step){window.scrollTo(0,to);}else{window.scrollBy(0,Math.sign(to-now)*step);setTimeout(scroll,1);}
prev=now;};scroll();}});Mohawk.EventInterface={preventDefault:function(){if(this.button==BTN_RIGHT){if(OPERA){no_ctmenu=window.no_ctmenu;if(!no_ctmenu){no_ctmenu=document.createElement('input');no_ctmenu.type='button';document.body.appendChild(no_ctmenu);}
no_ctmenu.style.position='fixed';no_ctmenu.style.top=this.clientY-2+'px';no_ctmenu.style.left=this.clientX-2+'px';no_ctmenu.style.width='5px';no_ctmenu.style.height='5px';no_ctmenu.style.opacity=0;no_ctmenu.style.zIndex=10000;}}
if(typeof this.returnValue!='undefined'){this.returnValue=false;}else{if(window._preventDefault instanceof Function){window._preventDefault.call(this);}}
return false;},stopPropagation:function(){if(typeof this.cancelBubble!='undefined'){this.cancelBubble=true;}else{if(window._stopPropagation instanceof Function){window._stopPropagation.call(this);}}
return false;},cursor:function(){var x=0,y=0;if(this.pageX||this.pageY){x=this.pageX;y=this.pageY;}else if(this.clientX||this.clientY){x=this.clientX+document.scrollLeft();y=this.clientY+document.scrollTop();}else if(this.screenX||this.screenY){x=this.screenX;y=this.screenY;}
return new Pixel(x,y);},wheel:function(){var delta=0;if(this.wheelDelta){delta=event.wheelDelta/120;}else if(this.detail){delta=-this.detail/3;}
return delta;},key:function(){return this.keyCode||this.which||null;},element:function(){return this.srcElement||this.currentTarget;}};if(window.Event){window._preventDefault=window.Event.prototype.preventDefault;window._stopPropagation=window.Event.prototype.stopPropagation;if(FF){delete(Mohawk.EventInterface.preventDefault);}
extend(window.Event,Mohawk.EventInterface);}
Mohawk.NodeClassInterface={getClasses:function(){return this.className?this.className.split(/\s+/):[];},hasClass:function(className){var classes=this.getClasses();for(var i=0;i<arguments.length;i++){if(Array.find(classes,arguments[i])!==false){return true;}}
return false;},addClass:function(className){if(!this.className.length){this.className=className;}else if(!this.hasClass(className)){this.className+=' '+className;}
for(var i=1;i<arguments.length;i++){if(!this.hasClass(arguments[i])){this.className+=' '+arguments[i];}}},removeClass:function(className){var classes=this.getClasses();for(var i=0;i<arguments.length;i++){Array.remove(classes,arguments[i]);}
this.className=classes.join(' ');},replaceClass:function(find,replace){var classes=this.getClasses();if((key=Array.find(classes,find))!==false){classes[key]=replace;this.className=classes.join(' ');}else{this.addClass(replace);}},flipClass:function(className){for(var i=0;i<arguments.length;i++){if(this.hasClass(arguments[i])){this.removeClass(arguments[i]);}else{this.addClass(arguments[i]);}}},copyClassesTo:function(element){var classes=this.getClasses();classes.forEach(function(){element.addClass(this);});},setClassesTo:function(element){element.className=this.className;}};Mohawk.NodeEventInterface={addEvent:function(event,action,useCapture){if(!useCapture){useCapture=false;}
if(this.addEventListener){this.addEventListener(event,action,useCapture);}else if(this.attachEvent){this.attachEvent('on'+event,action);}
return action;},removeEvent:function(event,action,useCapture){if(!useCapture){useCapture=false;}
if(this.removeEventListener){this.removeEventListener(event,action,useCapture);}else if(this.detachEvent){this.detachEvent('on'+event,action);}}};Mohawk.NodeStructureInterface={coordinates:function(){var x=0,y=0;var element=this;while(element){x+=element.offsetLeft;y+=element.offsetTop;element=element.offsetParent;}
return new Pixel(x,y);},isDescendantOf:function(node){var parent=this.parentNode;while(parent){if(parent==node){return true;}
parent=parent.parentNode;}
return false;},isAncestorOf:function(node){var parent=node.parentNode;while(parent){if(parent==this){return true;}
parent=parent.parentNode;}
return false;},removeChildren:function(){while(this.firstChild){this.removeChild(this.firstChild);}},firstTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.firstChild;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.nextSibling;}
return current;},nextTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.nextSibling;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.nextSibling;}
return current;},ancestorTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.parentNode;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.parentNode;}
return current;},previousTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.previousSibling;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.previousSibling;}
return current;},replace:function(node){this.parentNode.replaceChild(node,this);},insertFirst:function(node){this.insertBefore(node,this.firstChild);},insertAfter:function(node,before){this.insertBefore(node,before.nextSibling);},getElementsByClassName:function(class_name){var elements=this.getElementsByTagName('*');var found=[];for(var i=0;i<elements.length;i++){if(elements[i].hasClass&&elements[i].hasClass(class_name)){found.push(elements[i]);}}
return found;},getElementsByLang:function(lang){var elements=this.getElementsByTagName('*');var found=[];for(var i=0;i<elements.length;i++){if(elements[i].lang==lang){found.push(elements[i]);}}
return found;},setHTML:function(html){this.purgeChildren();this.innerHTML=html;Mohawk.DOM.enchaseDocumentNodes(this);},prependHTML:function(html){this.innerHTML=html+this.innerHTML;Mohawk.DOM.enchaseDocumentNodes(this);},appendHTML:function(html){this.innerHTML+=html;Mohawk.DOM.enchaseDocumentNodes(this);},purge:function(){this.parentNode.purgeChild(this);},purgeChild:function(node){var a=node.attributes,i,l,n;if(a){l=a.length;for(i=0;i<l;i+=1){n=a[i].name;if(node[n]instanceof Function){node[n]=null;}}}
if(node.purgeChildren instanceof Function){node.purgeChildren();}
this.removeChild(node);node=null;},purgeChildren:function(){while(this.firstChild){this.purgeChild(this.firstChild);}},setChild:function(node){this.purgeChildren();this.appendChild(node);},appendTo:function(node){node.appendChild(this);}};Mohawk.ElementOnlyInterface={getElementById:function(id){var elements=this.getElementsByTagName('*');var found=false;for(var i=0;i<elements.length;i++){if(elements[i].id==id){found=elements[i];break;}}
return found;}};Mohawk.NodePositionInterface={alignTo:function(node,side,absolute){switch(side){case'left':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+'px';break;case'right':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+node.offsetWidth-this.offsetWidth+'px';break;case'center':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+(node.offsetWidth-this.offsetWidth)/2+'px';break;case'top':this.style.top=(absolute?node.coordinates().y:node.offsetTop)+'px';break;case'bottom':this.style.bottom=(absolute?node.coordinates().y:node.offsetTop)+node.offsetHeight+'px';break;case'middle':this.style.top=(absolute?node.coordinates().y:node.offsetTop)+(node.offsetHeight-this.offsetHeight)/2+'px';break;}},adjoinTo:function(node,side,absolute){switch(side){case'left':this.style.right=(absolute?node.coordinates().x:node.offsetLeft)+'px';break;case'right':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+node.offsetWidth+'px';break;case'top':this.style.bottom=(absolute?node.coordinates().y:node.offsetTop)+'px';break;case'bottom':this.style.top=(absolute?node.coordinates().y:node.offsetTop)+node.offsetHeight+'px';break;}}};Mohawk.DOM=new Singletone({ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,DOCUMENT_NODE:9,enchaseNode:function(node){if(!node){return;}
if(IE&&typeof(HTMLGenericElement)!='undefined'&&node instanceof HTMLGenericElement){return;}
if(Array.find([self.ELEMENT_NODE,self.DOCUMENT_NODE],node.nodeType)===false){return;}
if(node._enchased instanceof Function&&node._enchased()===true){return;}
if(!node.nodeName||node.nodeName.match(/^(?:svg|OBJECT)/)){return;}
node._cloneNode=node.cloneNode;node.cloneNode=function(flag){var clone=this._cloneNode(flag);self.enchaseNode(clone);return clone;};switch(node.nodeName.toUpperCase()){case'TABLE':node._insertRow=node.insertRow;node.insertRow=function(index){var row=IE?this._insertRow(index):HTMLTableElement.prototype.insertRow.call(this,index);self.enchaseNode(row);return row;};node._createTHead=node.createTHead;node.createTHead=function(){var thead=IE?this._createTHead():HTMLTableElement.prototype.createTHead.call(this);self.enchaseNode(thead);return thead;};node._createTFoot=node.createTFoot;node.createTFoot=function(){var tfoot=IE?this._createTFoot():HTMLTableElement.prototype.createTFoot.call(this);self.enchaseNode(tfoot);return tfoot;};break;case'TR':node._insertCell=node.insertCell;node.insertCell=function(index){var cell=IE?this._insertCell(index):HTMLTableRowElement.prototype.insertCell.call(this,index);self.enchaseNode(cell);return cell;};break;case'FORM':if(typeof Mohawk.FormsInterface!='undefined'){extend(node,Mohawk.FormsInterface);}
break;}
extend(node,Mohawk.NodeClassInterface);extend(node,Mohawk.NodeEventInterface);extend(node,Mohawk.NodeStructureInterface);extend(node,Mohawk.NodePositionInterface);if(node.nodeType==self.ELEMENT_NODE){extend(node,Mohawk.ElementOnlyInterface);}
if(Mohawk.NodeEffectInterface instanceof Object){extend(node,Mohawk.NodeEffectInterface);}
node._enchased=function(){return true;};},enchaseDocument:function(){if(document._document_enchased){return;}
document._document_enchased=true;var createElement=document.createElement;document.createElement=function(tag_name){if(typeof Document=='undefined'){var element=createElement(tag_name);}else{var element=(Document.prototype.createElement||createElement).call(document,tag_name);}
self.enchaseNode(element);return element;};var getElementById=document.getElementById;document.getElementById=function(id){if(typeof Document=='undefined'){var element=getElementById(id);}else{var element=(Document.prototype.getElementById||getElementById).call(document,id);}
self.enchaseNode(element);return element;};document.scrollLeft=function(){return self.pageXOffset||(document.documentElement&&document.documentElement.scrollLeft)||(document.body&&document.body.scrollLeft);};document.scrollTop=function(){return self.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||(document.body&&document.body.scrollTop);};document.size=function(){var w=0,h=0;var win=window.window;if(win.self.innerHeight){w=win.self.innerWidth;h=win.self.innerHeight;}else if(win.document.documentElement&&win.document.documentElement.clientWidth){w=win.document.documentElement.clientWidth;h=win.document.documentElement.clientHeight;}else if(win.document.body){w=win.document.body.clientWidth;h=win.document.body.clientHeight;}
return{width:w,height:h};};extend(document,Mohawk.NodeEventInterface);extend(document,Mohawk.NodeStructureInterface);extend(document,Mohawk.NodePositionInterface);document._toHideOnClick=[];document.addEvent('click',function(){foreach(document._toHideOnClick,function(){this.hide();});});if(typeof document.defaultView=='undefined'){document.defaultView={};}
if(typeof document.defaultView.getComputedStyle=='undefined'){document.defaultView.getComputedStyle=function(element,pseudoElement){return element.currentStyle;};}},enchaseWindow:function(){if(window._window_enchased){return;}
window._window_enchased=true;extend(window,Mohawk.NodeEventInterface);},enchaseDocumentNodes:function(node){if(node){self.enchaseNode(node);}
self.enchaseNode(document.body);var all=(node||document.body).getElementsByTagName('*');if(all.forEach instanceof Function){foreach(all,function(){self.enchaseNode(this);});}else{for(var i=0;i<all.length;i++){self.enchaseNode(all[i]);}}}});Mohawk.DOM.element=function(tag_name,args){var element;if(tag_name.toUpperCase()=='INPUT'){if(IE&&!IE9){var str='<input';if(args){if(args.name!=undefined){str+=' name="'+args.name+'"';}
if(args.type!=undefined){str+=' type="'+args.type+'"';}}
str+='>';element=document.createElement(str);}else{element=document.createElement('INPUT');if(args){if(args.name!=undefined){element.name=args.name;}
if(args.type!=undefined){element.type=args.type;}}}}else if(tag_name.toUpperCase()=='BUTTON'){if(IE&&!IE9){var str='<button';if(args){if(args.name!=undefined){str+=' name="'+args.name+'"';}
if(args.type!=undefined){str+=' type="'+args.type+'"';}}
str+='>';element=document.createElement(str);}else{element=document.createElement('BUTTON');if(args){if(args.name!=undefined){element.name=args.name;}
if(args.type!=undefined){element.type=args.type;}}}}else{element=document.createElement(tag_name);}
if(args&&args instanceof Object){delete(args['name']);delete(args['type']);foreach(args,function(arg,value){if(arg=='className'){if(value instanceof Array){element.addClass.apply(element,value);}else{element.addClass(value);}}else if(arg=='html'){element.setHTML(value);}else if(arg=='appendTo'){element.appendTo(value);}else{element[arg]=value;}});}
return element;};Mohawk.DOM.text=function(text){return document.createTextNode(text);};Mohawk.DOM.event=function(event){event=event||window.event;extend(event,Mohawk.EventInterface);return event;};Mohawk.DOM.stopEvent=function(event){event=DOM.event(event);event.stopPropagation();};Mohawk.DOM.enchaseWindow();Mohawk.DOM.enchaseDocument();document.addLoader(function(){Mohawk.DOM.enchaseDocumentNodes();});window.ID=function(id){return document.getElementById(id);};Mohawk.Utils.IniParser=new Class({parse:function(source){source=source+'\n';var pos=0;var data={};var buffer='';var status=static.STAT_NL;var key='';while(pos<source.length){var cur=source.slice(pos,pos+1);switch(status){case static.STAT_NL:if(cur==';'){status=static.STAT_COM;}else if(cur.match(new RegExp('\\w'))){status=static.STAT_KEY;buffer+=cur;}else if(cur.match(new RegExp('\\s'))){}else{status=static.STAT_ERR;buffer='';}
break;case static.STAT_COM:case static.STAT_ERR:if(cur.match(new RegExp('\\r\\n|\\n|\\r'))){status=static.STAT_NL;}else{}
break;case static.STAT_KEY:if(cur.match(new RegExp('\\w'))){buffer+=cur;}else if(cur==' '||cur==' '){status=static.STAT_END_KEY;key=buffer;buffer='';}else if(cur=='='){status=static.STAT_VAL;key=buffer;buffer='';}else{status=static.STAT_ERR;key='';buffer='';}
break;case static.STAT_END_KEY:if(cur=='='){status=static.STAT_VAL;}else if(cur==' '||cur==' '){}else{status=static.STAT_ERR;key='';}
break;case static.STAT_VAL:if(cur==' '){if(buffer){buffer+=cur;}else{}}else if(cur.match(new RegExp('\\r\\n|\\n|\\r'))){status=static.STAT_NL;if(buffer){data[key]=buffer.rtrim();buffer='';}
key='';}else if(cur=='"'){status=static.STAT_STR;}else if(cur==';'){status=static.STAT_COM;if(buffer){data[key]=buffer;buffer='';}
key='';}else{buffer+=cur;}
break;case static.STAT_STR:if(cur=='"'){status=static.STAT_END_VAL;data[key]=buffer;}else if(cur=='\\'){status=static.STAT_ESC;}else{buffer+=cur;}
break;case static.STAT_ESC:status=static.STAT_STR;if(cur.match(new RegExp('["\\\\]'))){buffer+=cur;}else{buffer+='\\'+cur;}
break;case static.STAT_END_VAL:if(cur.match(new RegExp('\\r\\n|\\n|\\r'))){status=static.STAT_NL;data[key]=buffer;buffer='';key='';}else if(cur==';'){status=static.STAT_COM;data[key]=buffer;buffer='';key='';}else if(cur==' '||cur==' '){}else{status=static.STAT_ERR;buffer='';key='';}
break;default:self.error('Unknown status = '+status);}
if(typeof(Console)!=='undefined'){Console.log([cur,status,pos]);}
pos++;}
return data;},error:function(str){alert(str);}});Mohawk.Utils.IniParser.STAT_KEY='key';Mohawk.Utils.IniParser.STAT_VAL='value';Mohawk.Utils.IniParser.STAT_END_KEY='endkey';Mohawk.Utils.IniParser.STAT_END_VAL='endvalue';Mohawk.Utils.IniParser.STAT_STR='string';Mohawk.Utils.IniParser.STAT_ESC='escape';Mohawk.Utils.IniParser.STAT_COM='comment';Mohawk.Utils.IniParser.STAT_ERR='error';Mohawk.Utils.IniParser.STAT_NL='newline';var StringInterface={trim:function(){return this.rtrim().ltrim();},ltrim:function(){return this.replace(new RegExp('^\\s+'),'');},rtrim:function(){return this.replace(new RegExp('\\s+$'),'');},pad:function(length,chr,right){var str=this;var size=length-this.length;chr=chr||' ';for(var i=0;i<size;i++){str=right?str.concat(chr):chr.concat(str);}
return str;},ucfirst:function(){if(!this.length){return'';}
var first=this.slice(0,1);return first.toUpperCase()+this.slice(1,this.length);},htmlspecialchars:function(){var str=this.valueOf();str=str.replace(/&/g,'&amp;');str=str.replace(/</g,'&lt;');str=str.replace(/>/g,'&gt;');return str;},nl2br:function(){return this.replace(/\r\n|\n\r|\n|\r/g,'<br />');},wordwrap:function(width,str){var len=0;var wrapped='';if(str==undefined){str='\n';}
for(var i=0;i<this.length;i++){var char=this.substr(i,1);if(char.match(/\s/)){len=0;}else{len++;}
if(len>width){wrapped=wrapped.concat(str);len=1;}
wrapped=wrapped.concat(char);}
return wrapped;}};extend(String,StringInterface);Mohawk.Loader=new Singletone({css:[],css_default_url:URL.css+'mohawk/',addCss:function(url){if(!url.match(new RegExp('^(http://|/)','i'))){url=self.css_default_url+url;}
if(document.loaded){self.importCss(url);}else{if(Array.find(self.css,url)===false){self.css.push(url);}}},loadCss:function(){foreach(self.css,function(){self.importCss(this);});},importCss:function(src){var link=document.createElement('LINK');link.href=src;link.type='text/css';link.rel='stylesheet';document.getElementsByTagName('HEAD')[0].appendChild(link);},js:[],js_default_url:URL.home+'system/js/',addJs:function(url){url=url||'';if(!url.match(new RegExp('^(http://|/)','i'))){url=Mohawk.js_url+url;}
if(document.loaded){self.loadJs(url);}else{if(Array.find(self.js,url)===false){self.js.push(url);}}},loadJs:function(){foreach(self.js,self.importJs);},importJs:function(src){var script=DOM.element('script',{src:src,type:'text/javascript',appendTo:document.getElementsByTagName('HEAD')[0]});},extendLanguage:function(lng){foreach(Object.keys(lng),function(){var key=this.toString();var str=lng[key].toString();lng[key.ucfirst()]=str.ucfirst();lng[key.toUpperCase()]=str.toUpperCase();lng[key.toLowerCase()]=str.toLowerCase();});extend(window.LNG,lng);},includeLanguage:function(path){var include_path=URL.lang+ENV.language+'/'+path+'.ini';if(Array.find(Mohawk.included,include_path)===false){var XHR=Mohawk.XHR();XHR.open('GET',include_path+'?'+(new Date).valueOf(),false);XHR.send(null);try{var parser=new Mohawk.Utils.IniParser();var lng=parser.parse(XHR.responseText);self.extendLanguage(lng);}catch(e){if(Console){Console.describe(e);}}
Mohawk.included.push(include_path);delete(XHR);}},includeTemplate:function(path){var include_path=URL.html+path.replace(new RegExp('\\.','g'),'/')+'.tmpl';if(Array.find(Mohawk.included,include_path)===false){var XHR=Mohawk.XHR();XHR.open('GET',include_path+'?'+(new Date).valueOf(),false);XHR.send(null);var str=XHR.responseText;str=str.replace(new RegExp('"','g'),'\\"');str=str.replace(new RegExp('([\n\r]+)','g'),'" + "\\n');str='"'+str+'"';var name=path.substr(path.lastIndexOf('.')+1).toUpperCase();name=name.replace(new RegExp('\\W','g'),'_');eval('window.'+name+' = '+str);Mohawk.included.push(include_path);delete(XHR);}}});window.LNG={};document.addLoader(function(){Mohawk.Loader.loadCss();Mohawk.Loader.loadJs();});Mohawk.Observer=new Singletone({events:{},add:function(type,action){if(!(self.events[type]instanceof Array)){self.events[type]=[];}
self.events[type].push(action);},remove:function(type,action){if(self.events[type]instanceof Array){var source=action.toString();var i=0;while(i<self.events[type].length){if(self.events[type][i].toString()==source){self.events[type].splice(i,1);}else{i++;}}}},fire:function(type){if(!self.events[type]){return;}
var args=[];for(i=1;i<arguments.length;i++){args.push(arguments[i]);}
if(self.events[type]instanceof Array){foreach(self.events[type],function(){this.apply(null,args);});}}});var DOM=Mohawk.DOM;var Loader=Mohawk.Loader;var Template=Mohawk.Template;Template.assign('URL',URL);var Effects=Mohawk.Effects;var Observer=Mohawk.Observer;
Mohawk.FormsInterface={getData:function(){var data={};for(var i=0;i<this.elements.length;i++){var element=this.elements[i];if(element&&element.name){if(!element.disabled){switch(element.type){case'checkbox':case'radio':if(!element.checked){break;}
default:switch(element.tagName.toLowerCase()){case'select':if(element.multiple){if(element.name in data){if(!(data[element.name]instanceof Array)){data[element.name]=[data[element.name]];}}else{data[element.name]=[];}
for(var j=0;j<element.options.length;j++){if(element.options[j].selected){data[element.name].push(element.options[j].value);}}
break;}
default:if(element.name in data){if(!(data[element.name]instanceof Array)){data[element.name]=[data[element.name]];}
data[element.name].push(element.value);}else{data[element.name]=element.value;}}}}}}
return data;},setData:function(data,name){var form=this;var changed=[];if(typeof name=='undefined'){name='';}
function set_data(data,name,keys){if(data instanceof Object){if(data instanceof Array){for(var i=0;i<data.length;i++){set_data(data[i],name?name:i,name?(keys?keys.concat(i):[i]):[]);}}else{for(var i in data){if(typeof Object.prototype[i]!='undefined'){continue;}
set_data(data[i],name?name:i,name?(keys?keys.concat(i):[i]):[]);}}}else{var element_name=name+(keys.length?'['+keys.join('][')+']':'');if(typeof form[element_name]=='undefined'){element_name=name+(keys.length>1?'['+keys.slice(0,-1).join('][')+']':'')+'[]';if(typeof form[element_name]=='undefined'){return false;}}
var element=form[element_name];if(!element.length||element.tagName){element=[element];}
for(var i=0;i<element.length;i++){if(!element[i].tagName){continue;}
switch(element[i].tagName.toLowerCase()){case'select':if(element[i].multiple){for(var j=0;j<element[i].options.length;j++){if(element[i].options[j].value==data){element[i].options[j].selected=true;changed.push(element[i].options[j]);}else if(Array.find(changed,element[i].options[j])===false){element[i].options[j].selected=false;}}
break;}
case'input':if(element[i].type=='checkbox'||element[i].type=='radio'){if(element[i].value==data){element[i].checked=true;changed.push(element[i]);}else if(Array.find(changed,element[i])===false){element[i].checked=false;}
break;}
default:element[i].value=data;}
if(typeof(element[i].onchange)!='undefined'&&element[i].onchange instanceof Function){element[i].onchange();}}}
return true;}
set_data(data,name,[]);},createInput:function(type,name,value,options){switch(type){default:case'hidden':case'text':case'password':case'checkbox':if(IE&&!IE9){var input=document.createElement('<input name="'+name+'">');}else{var input=document.createElement('INPUT');input.name=name;}
input.type=type;input.value=value;break;case'textarea':if(IE&&!IE9){var input=document.createElement('<textarea name="'+name+'">');}else{var input=document.createElement('TEXTAREA');input.name=name;}
input.value=value;break;case'select':if(IE&&!IE9){var input=document.createElement('<select name="'+name+'">');}else{var input=document.createElement('SELECT');input.name=name;}
foreach(options,function(i,val){if(typeof(val)=='undefined'){return;}
var option=document.createElement('OPTION');option.value=val.value;option.innerHTML=val.text;if(value==option.value){option.selected=true;}
input.appendChild(option);});break;}
return input;}};window.FormsInterface=Mohawk.FormsInterface;Mohawk.XML=new Singletone({empty_elements:['br','img','link','meta','input','hr'],inline_elements:['a','abbr','acronym','b','basefont','bdo','big','br','cite','code','dfn','em','font','i','img','input','kbd','label','q','s','samp','select','small','span','strike','strong','sub','sup','textarea','tt','u','var','applet','button','del','iframe','ins','map','object','script'],toObject:function(node){switch(node.nodeType){case Mohawk.DOM.TEXT_NODE:case Mohawk.DOM.CDATA_SECTION_NODE:return node.nodeValue;case Mohawk.DOM.ELEMENT_NODE:var data=null;for(var i=0;i<node.attributes.length;i++){if(node.attributes[i].nodeName!='_key'){if(data===null){data={};}
data[node.attributes[i].nodeName]=node.attributes[i].nodeValue;}}
var allow_text_nodes=true;node.normalize();for(var i=0;i<node.childNodes.length;i++){var child=self.toObject(node.childNodes[i]);if(child instanceof Object){if(!(data instanceof Object)){data={};}
if(child.name in data){if(!(data[child.name]instanceof Array)){data[child.name]=[data[child.name]];}
data[child.name].push(child.content);}else if(node.childNodes[i].getAttribute('_key')!=null){data[child.name]=[child.content];}else{data[child.name]=child.content;}
allow_text_nodes=false;}else if(allow_text_nodes){data=child;}}
return{name:node.nodeName,content:data};case Mohawk.DOM.DOCUMENT_NODE:var data=self.toObject(node.documentElement);return data.content;default:Console.log('Cannot handle type: '+node.nodeType);}},parse:function(str){var xmldoc;if(window.DOMParser){parser=new DOMParser();xmldoc=parser.parseFromString(str,'text/xml');}else{xmldoc=new ActiveXObject('Microsoft.XMLDOM');xmldoc.async='false';xmldoc.loadXML(str);}
return self.toObject(xmldoc);},escape:function(str){str=str.replace('&','&amp;');var table={62:'gt',60:'lt',160:'nbsp',169:'copy',8212:'mdash',8482:'trade',8482:'trade',8222:'bdquo',171:'laquo',8220:'ldquo',8222:'lsaquo',8249:'lsquo',187:'raquo',8221:'rdquo',8250:'rsaquo',8217:'rsquo',8218:'sbquo'};foreach(table,function(code){str=str.replace(new RegExp(String.fromCharCode(code),'g'),'&'+this+';');});return str;},clean:function(str){str=str.replace(new RegExp('^[\\s]+','gm'),' ');str=str.replace(new RegExp('[\\s]+$','gm'),' ');return str;},toHtml:function(node,padding,pad_with,exclude_name,first){if(!padding){padding='\n';}
if(!pad_with){pad_with='\t';}
switch(node.nodeType){case Mohawk.DOM.TEXT_NODE:case Mohawk.DOM.CDATA_SECTION_NODE:var value=self.escape(node.nodeValue);value=self.clean(value);return value;case Mohawk.DOM.ELEMENT_NODE:var tag=node.nodeName.toLowerCase();var str='';if(!exclude_name){var str=(!first&&Array.find(self.inline_elements,tag)===false?padding:'')+'<'+tag;for(var i=0;i<node.attributes.length;i++){if(node.attributes[i].nodeValue==''||node.attributes[i].nodeValue==null){continue;}
if(node.attributes[i].nodeValue.toString().match(new RegExp('^(_moz|apple|contentEditable)','i'))){continue;}
if(node.attributes[i].nodeName.match(new RegExp('^(_moz|apple|contentEditable)','i'))){continue;}
var value=self.escape(node.attributes[i].nodeValue.toString());str+=' '+node.attributes[i].nodeName+'="'+value+'"';}
if(!node.childNodes.length&&Array.find(self.empty_elements,tag)!==false){str+=' />';}else{str+='>';}}
var padding_closing='';if(tag=='pre'){str+=node.innerHTML;}else{node.normalize();var padding_children=!exclude_name?padding+pad_with:padding;var first_child=true;for(var i=0;i<node.childNodes.length;i++){var child=node.childNodes[i];var value=self.toHtml(child,padding_children,pad_with,false,exclude_name&&first_child);str+=value;if(value){first_child=false;}
if(Array.find([Mohawk.DOM.TEXT_NODE,Mohawk.DOM.CDATA_SECTION_NODE],child.nodeType)===false&&child.nodeName&&Array.find(self.inline_elements,child.nodeName.toLowerCase())===false){padding_closing=padding;}}}
if(node.childNodes.length||Array.find(self.empty_elements,tag)===false){str+=!exclude_name?(padding_closing+'</'+tag+'>'):'';}
return str;case Mohawk.DOM.DOCUMENT_NODE:return self.toHtml(node.documentElement,padding,pad_with,exclude_name,not_first);default:return'XML: unsupported type of node '+node.nodeType;}}});window.XML=Mohawk.XML;Mohawk.Ajax=new Class({XHR:null,caller:null,url:'',method:'',overwrite_method:true,data:'',charset:'UTF-8',sync:true,xml:'',text:'',type:'',data:{},__construct:function(url,method){self.url=url;self.method=method||static.METHOD_GET;self.type=static.TYPE_XML;self.XHR=Mohawk.XHR();},responseHandler:function(){},errorHandler:function(){},send:function(data){if(typeof self.XHR=='object'){self.XHR.onreadystatechange=function(){self.procedure.apply(self);};self.method=self.method.toUpperCase()
switch(self.method){default:case static.METHOD_GET:var url_with_data=self.url+(self.url.match(new RegExp('\\?'))?'&':'?')+static.prepare(data);self.XHR.open(static.METHOD_GET,url_with_data,self.sync);var get=true;break;case static.METHOD_POST:case static.METHOD_PUT:case static.METHOD_DELETE:case static.METHOD_OPTIONS:case static.METHOD_HEAD:self.XHR.open(self.overwrite_method?static.METHOD_POST:self.method,self.url,self.sync);var get=false;break;}
self.XHR.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset='+self.charset);self.XHR.setRequestHeader('X-Request-Method',self.method);self.XHR.setRequestHeader('Accept',self.type);if(get){if(window.XMLHttpRequest){self.XHR.send(null);}else{self.XHR.send();}}else{var query=static.prepare(data);self.XHR.send(query);}
if(window.Console){var hash=window.Console.hash(data);hash=hash.replace(new RegExp('<','g'),'&lt;');hash=hash.replace(new RegExp('>','g'),'&gt;');var report='Ajax query : '+self.method+' <a href="'+self.url+'">'+self.url+'</a><br />'
+'Data: <pre>'+hash+'</pre>'
+'Query: '+query;window.Console.log(report);}}else{self.error('XMLHttpRequest is not initialized');}},procedure:function(){var error=false;switch(self.XHR.readyState){case static.STATE_UNINITIALIZED:break;case static.STATE_LOADED:if(self.XHR.status==static.HTTP_OK){if(self.XHR.responseXML){self.xml=self.XHR.responseXML;}else{if(self.type==static.TYPE_XML&&self.errorHandler instanceof Function){error=true;self.errorHandler.call(self);}}}else{if(self.errorHandler instanceof Function){error=true;self.errorHandler(self);}}
self.text=self.XHR.responseText;if(window.Console){var data=self.XHR.responseText;data=data.replace(new RegExp('<','g'),'&lt;');data=data.replace(new RegExp('>','g'),'&gt;');var report='Ajax query received from: <a href="'+self.url+'">'+self.url+'</a>';window.Console.log(report);window.Console.log2('Data',data);}
switch(self.type){case static.TYPE_JSON:eval('self.data = '+self.text);break;case static.TYPE_XML:self.data=Mohawk.XML.toObject(self.xml);break;}
if(!error){self.responseHandler(self);}
break;default:}},error:function(message){if(window.Console){window.Console.log(message,'error');}}});Mohawk.Ajax.HTTP_OK=200;Mohawk.Ajax.HTTP_NOT_FOUND=404;Mohawk.Ajax.STATE_UNINITIALIZED=0;Mohawk.Ajax.STATE_OPEN=1;Mohawk.Ajax.STATE_SENT=2;Mohawk.Ajax.STATE_RECEIVING=3;Mohawk.Ajax.STATE_LOADED=4;Mohawk.Ajax.METHOD_GET='GET';Mohawk.Ajax.METHOD_POST='POST';Mohawk.Ajax.METHOD_PUT='PUT';Mohawk.Ajax.METHOD_DELETE='DELETE';Mohawk.Ajax.METHOD_HEAD='HEAD';Mohawk.Ajax.METHOD_OPTIONS='OPTIONS';Mohawk.Ajax.TYPE_XML='text/xml';Mohawk.Ajax.TYPE_JSON='text/json';Mohawk.Ajax.TYPE_TEXT='text/text';Mohawk.Ajax.escape=function(str){if(typeof str=='string'){if(OPERA){str=str.replace(new RegExp('\r','g'),'');}
str=str.replace(new RegExp('%','g'),'%'+'25');str=str.replace(new RegExp('\n','g'),'%'+'0A');str=str.replace(new RegExp('\r','g'),'%'+'0D');str=str.replace(new RegExp('&','g'),'%'+'26');str=str.replace(new RegExp('#','g'),'%'+'23');str=str.replace(new RegExp('\\+','g'),'%'+'2B');}
return str;};Mohawk.Ajax.prepare=function(data,prefix){var query='';switch(typeof data){case'object':if(data instanceof Array){for(var i=0;i<data.length;i++){if(typeof Array.prototype[i]!='undefined'){continue;}
query+=(query.length?'&':'');switch(typeof data[i]){case'object':query+=Mohawk.Ajax.prepare(data[i],prefix?prefix+'['+i+']':i);break;case'string':case'number':case'boolean':query+=(prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'[]':'')+'=':i+'=')+Mohawk.Ajax.prepare(data[i],prefix?prefix+'['+i+']':i);break;}}}else{for(var i in data){if(typeof Object.prototype[i]!='undefined'){continue;}
query+=(query.length?'&':'');switch(typeof data[i]){case'object':if(data[i]==null){query+=prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'['+i+']':'')+'=':i+'=';}else{query+=Mohawk.Ajax.prepare(data[i],prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'['+i+']':''):i);}
break;case'string':case'number':case'boolean':query+=(prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'['+i+']':'')+'=':i+'=')+Mohawk.Ajax.prepare(data[i],prefix?prefix+'['+i+']':i);break;}}}
break;case'string':case'number':case'boolean':query=prefix?Mohawk.Ajax.escape(data):data;break;}
return query;};Mohawk.Ajax.parse_url=function(url){var chunks=url.split('&');var data={};foreach(chunks,function(){var tuple=this.split('=');var m;if(m=tuple[0].match(new RegExp('([a-z][a-z_0-9]*)((?:\\[[a-z_0-9]*\\])*)','i'))){var rec=data;var last=m[1].toString();if(m[2]){var keys=m[2].slice(1,-1).split('][');keys.unshift(m[1]);last=keys.pop();var prev_rec,prev_key;foreach(keys,function(){var key=this.toString();if(!(rec[key]instanceof Object)){rec[key]={};}
prev_rec=rec;prev_key=key;rec=rec[key];});}
if(last==''){if(!(rec instanceof Array)){prev_rec[prev_key]=[];}
prev_rec[prev_key].push(tuple[1]);}else{rec[last]=tuple[1];}}});return data;};window.Ajax=Mohawk.Ajax;Mohawk.Loader.extendLanguage({"authorization":"autorisation","remember_me":"garder ma session active","log_in":"connexion","logout":"d\u00e9connexion","logging_in":"d\u00e9connexion","logged_in":"d\u00e9connect\u00e9, redirection","error_login":"mauvais nom d'utilisateur ou mot de passe","logging_out":"d\u00e9connection en cours","logged_out":"redirection en cours","confirm_logout":"D\u00e9connecter?"})
window.Authorization=new Class({login:function(form){var req=new Mohawk.Ajax(URL.home+'api/login/',Mohawk.Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.ok){Progress.load(LNG.Logged_in);if(req.data.remember){window.location=URL.sso+'setcookie/'+req.data.sid+'/?redirect='+escape(URL.host+form.getData().redirect);}else{window.location=URL.sso+'setsession/'+req.data.sid+'/?redirect='+escape(URL.host+form.getData().redirect);}}else{Progress.done(LNG.Error_login);}};req.send(form.getData());Progress.load(LNG.Logging_in);},logout:function(sid){if(ENV.SID){var url=URL.sso+'deletecookie/'+ENV.SID+'/?redirect='+escape(window.location);window.location=URL.home+'api/login/deletecookie/'+ENV.SID+'/?redirect='+escape(url);}else{var req=new Mohawk.Ajax(URL.home+'api/login/',Mohawk.Ajax.METHOD_DELETE);req.responseHandler=function(req){Progress.load(LNG.Logged_out);window.location.reload();};req.send();Progress.load(LNG.Logging_out);}}});Mohawk.Dragdrop=new Singletone({css_class:'draggable',max_index:1000,dragged:false,caller:null,target:{elements:[],x_boxes:{},x_delim:[],y_boxes:{},y_delim:[]},over:[],events:[],reset:function(){self.target={elements:[],x_boxes:{},x_delim:[],y_boxes:{},y_delim:[]};self.over=[];self.events=[];self.dragged=false;self.caller=null;},dragging:function(){return!!self.events.length;},binSearch:function(array,value){var l=0;var r=array.length-1;if(array[l]>=value){return l;}
if(array[r]<value){return r+1;}
do{var m=Math.round((r+l)/2);if(m==l||m==r||array[m]==value){break;}else if(array[m]<value){l=m;}else{r=m;}}while(true);return m;},createTargetObjectElement:function(target,element,i,last){self=Mohawk.Dragdrop;var n=target.elements.length;var box=Rect.fromNode(element[i]);var start_x=self.binSearch(target.x_delim,box.start.x);if(typeof target.x_boxes[box.start.x]=='undefined'){target.x_boxes[box.start.x]=typeof target.x_delim[start_x-1]!='undefined'&&typeof target.x_boxes[target.x_delim[start_x-1]]!='undefined'?target.x_boxes[target.x_delim[start_x-1]].concat([]):[];target.x_delim.splice(start_x,0,box.start.x);}
var end_x=self.binSearch(target.x_delim,box.end.x);if(typeof target.x_boxes[box.end.x]=='undefined'){target.x_boxes[box.end.x]=typeof target.x_boxes[target.x_delim[end_x-1]]!='undefined'?target.x_boxes[target.x_delim[end_x-1]].concat([]):[];target.x_delim.splice(end_x,0,box.end.x);}
for(var j=start_x;j<end_x;j++){if(typeof target.x_boxes[target.x_delim[j]]=='undefined'){target.x_boxes[target.x_delim[j]]=[];}
target.x_boxes[target.x_delim[j]].push(n);}
var start_y=self.binSearch(target.y_delim,box.start.y);if(typeof target.y_boxes[box.start.y]=='undefined'){target.y_boxes[box.start.y]=typeof target.y_delim[start_y-1]!='undefined'&&typeof target.y_boxes[target.y_delim[start_y-1]]!='undefined'?target.y_boxes[target.y_delim[start_y-1]].concat([]):[];target.y_delim.splice(start_y,0,box.start.y);}
var end_y=self.binSearch(target.y_delim,box.end.y);if(typeof target.y_boxes[box.end.y]=='undefined'){target.y_boxes[box.end.y]=typeof target.y_boxes[target.y_delim[end_y-1]]!='undefined'?target.y_boxes[target.y_delim[end_y-1]].concat([]):[];target.y_delim.splice(end_y,0,box.end.y);}
for(var j=start_y;j<end_y;j++){if(typeof target.y_boxes[target.y_delim[j]]=='undefined'){target.y_boxes[target.y_delim[j]]=[];}
target.y_boxes[target.y_delim[j]].push(n);}
var actions=['ondragover','ondragout','ondrop'];for(var k=0;k<actions.length;k++){var action=element[i][actions[k]]||element[i].getAttribute(actions[k]);try{element[i][actions[k]]=action instanceof Function?new Function(['event'],action.parse().body):false;}catch(e){}}
target.elements[n]=element[i];if(++i<element.length){setTimeout(function(){self.createTargetObjectElement(target,element,i,last);},0);}else if(last){}},createTargetObject:function(element){var target={elements:[],x_boxes:{},x_delim:[],y_boxes:{},y_delim:[]};for(var n=0;n<arguments.length;n++){self.createTargetObjectElement(target,arguments[n],0,n==arguments.length-1);}
return target;},setTarget:function(element){self.target=self.createTargetObject.call(self,arguments);},setTargetObject:function(object){self.target=object;},getDraggable:function(node){if(node.hasClass(self.css_class)){return node;}else{if(node.parentNode){return self.getDraggable(node.parentNode);}else{return null;}}},pick:function(event,elements){self=Mohawk.Dragdrop;event=DOM.event(event);var caller=event.currentTarget||event.srcElement;self.caller=caller;if(!elements||!elements.length){elements=[caller];}
document.addEvent('mousemove',self.drag);document.addEvent('mouseup',self.release);if(IE){document.body.focus();}
document.addEvent('selectstart',self.returnFalse);caller.addEvent('dragstart',self.returnFalse);document.addEvent('dragstart',self.returnFalse);document.body.onselectstart=self.returnFalse;self.events=[];var cur=event.cursor();foreach(elements,function(i){var action=this.onpick||this.getAttribute('onpick');if(action instanceof Function){var handler=new Function(['event'],action.parse().body);handler.call(this,event);}
var draggable=self.getDraggable(this);if(draggable){var evt={element:this,draggable:draggable,position:draggable.style.position||'static',offset:new Pixel(draggable.offsetLeft,draggable.offsetTop),start:new Pixel(cur.x,cur.y),ondrag:handler instanceof Function?handler:false};var actions=['ondrag','ondrop','onrelease'];for(var k=0;k<actions.length;k++){var action=this[actions[k]]||this.getAttribute(actions[k]);evt[actions[k]]=action instanceof Function?new Function(['event'],action.parse().body):false;}
self.events.push(evt);draggable.style.position='absolute';if(draggable.dragFront!==false){self.bringToFront(draggable);}}});event.stopPropagation();return false;},drag:function(event){self=Mohawk.Dragdrop;event=DOM.event(event);if(!self.dragged){document.removeEvent('mouseup',self.release);document.addEvent('mouseup',self.drop);}
self.dragged=true;var cur=event.cursor();for(var i=0;i<self.events.length;i++){var evt=self.events[i];var new_pix=new Pixel(evt.offset.x+cur.x-evt.start.x,evt.offset.y+cur.y-evt.start.y);var move=true;if(evt.ondrag){if(evt.ondrag.call(evt.element,event,new_pix)===false){move=false;}}
if(move){if(evt.draggable.dragX!==false){evt.draggable.style.left=new_pix.x+'px';}
if(evt.draggable.dragY!==false){evt.draggable.style.top=new_pix.y+'px';}}}
if(self.target.elements.length){var x_boxes=self.target.x_boxes[self.target.x_delim[self.binSearch(self.target.x_delim,cur.x)-1]];var y_boxes=self.target.y_boxes[self.target.y_delim[self.binSearch(self.target.y_delim,cur.y)-1]];if(x_boxes&&y_boxes){var boxes=Array.intersect(x_boxes,y_boxes,true);for(var z=0;z<boxes.length;z++){if(cur.inside(Rect.fromNode(self.target.elements[boxes[z]]))){if(Array.find(self.over,self.target.elements[boxes[z]])===false){self.over.push(self.target.elements[boxes[z]]);}
if(self.target.elements[boxes[z]].ondragover){self.target.elements[boxes[z]].ondragover.call(self.target.elements[boxes[z]],event);}}}}}
if(self.over.length){for(var i=0;i<self.over.length;i++){var over=self.over[i];var bound=Rect.fromNode(over);if(!cur.inside(bound)){if(over.ondragout){over.ondragout.call(over,event);}
Array.remove(self.over,over);}}}
return false;},drop:function(event){self=Mohawk.Dragdrop;event=Mohawk.DOM.event(event);document.removeEvent('mousemove',self.drag);document.removeEvent('mouseup',self.drop);self.caller.removeEvent('dragstart',self.returnFalse);document.removeEvent('selectstart',self.returnFalse);document.removeEvent('dragstart',self.returnFalse);document.body.onselectstart=null;var cur=event.cursor();if(self.over.length){for(var i=0;i<self.over.length;i++){var over=self.over[i];var bound=Rect.fromNode(over);if(cur.inside(bound)){if(over.ondrop){over.ondrop.call(over,event);}}}}
for(var i=0;i<self.events.length;i++){var evt=self.events[i];if(evt.ondrop){evt.element.ondrop.call(evt.element,event);}}
self.reset();},release:function(event){self=Mohawk.Dragdrop;event=Mohawk.DOM.event(event);document.removeEvent('mousemove',self.drag);document.removeEvent('mouseup',self.release);self.caller.removeEvent('dragstart',self.returnFalse);document.removeEvent('selectstart',self.returnFalse);document.removeEvent('dragstart',self.returnFalse);document.body.onselectstart=null;for(var i=0;i<self.events.length;i++){var evt=self.events[i];if(evt.element.onrelease){evt.element.onrelease.call(evt.element,event);}}
self.reset();},bringToFront:function(element){element.style.zIndex=self.max_index;self.max_index++;},getDragObjects:function(){var objects=[];for(var i=0;i<self.events.length;i++){objects.push(self.events[i].draggable);}
return objects;},returnFalse:function(){return false;}});window.Dragdrop=Mohawk.Dragdrop;Mohawk.UI.Console=new Class({element:null,content:null,hidden:true,__construct:function(){var element=DOM.element('div');element.addClass('console');self.element=element;var content=document.createElement('UL');element.appendChild(content);element.collapse();self.content=content;var btn_clear=document.createElement('A');btn_clear.href='#clear';btn_clear.innerHTML='clear';btn_clear.object=self;btn_clear.addClass('clear');btn_clear.onclick=function(){this.object.clear();return false;};self.element.appendChild(btn_clear);var btn_hide=document.createElement('A');btn_hide.href='#hide';btn_hide.innerHTML='hide';btn_hide.object=self;btn_hide.addClass('hide');btn_hide.onclick=function(){this.object.hide();return false;};self.element.appendChild(btn_hide);var form=document.createElement('FORM');form.action='#';form.history=[];form.current=0;form.onsubmit=function(){return false;};form.onclick=function(){form.elements[0].focus();};self.element.appendChild(form);var input=document.createElement('INPUT');input.history=[];input.current=0;input.onkeydown=function(event){event=DOM.event(event);switch(event.key()){case 38:if(this.current>0){this.current--;this.value=this.history[this.current];}
break;case 40:if(this.current<this.history.length-1){this.current++;this.value=this.history[this.current];}
break;case 13:try{var val=eval(this.value);self.log(val);}catch(e){self.log('Error occured: '+self.hash(e),'error');}
this.history.push(this.value);this.current=this.history.length;this.value='';return false;}};input.onfocus=function(){input.addClass('onfocus');};input.onblur=function(){input.removeClass('onfocus');};form.appendChild(input);self.input=input;},append:function(){document.body.appendChild(self.element);},log:function(text,type){var now=new Date;var line=document.createElement('LI');line.innerHTML=IE?'<pre>'+text+'</pre>':text;if(type){line.addClass(type);}
var date=document.createElement('SPAN');date.innerHTML=now.toLocaleString();line.appendChild(date);self.content.appendChild(line);self.content.scrollTop=self.content.scrollHeight;},log2:function(title,text){var line=self.content.lastChild?self.content.lastChild:document.createElement('LI');var p=document.createElement('P');var toggle=document.createElement('A');var container=document.createElement('DIV');p.innerHTML=title+': ';toggle.innerHTML='+';toggle.href='#toggle';toggle.onclick=function(){if(toggle.innerHTML=='+'){container.display();toggle.innerHTML='-';}else{container.collapse();toggle.innerHTML='+';}
return false;};container.collapse();container.innerHTML=text;line.appendChild(p);p.appendChild(toggle);line.appendChild(container);self.content.appendChild(line);self.content.scrollTop=self.content.scrollHeight;},error:function(text){self.log(text,'error');},clear:function(){self.content.removeChildren();},hide:function(){self.hidden=true;self.element.collapse();},show:function(){self.hidden=false;self.element.display();self.element.scrollTop=self.element.scrollHeight;self.input.focus();Mohawk.Dragdrop.bringToFront(self.element);},toggle:function(){if(self.hidden){self.show();}else{self.hide();}},hash:function(data){var hash='';switch(typeof data){case'object':if(data==null){hash+='NULL';}else{if(data.forEach){foreach(data,function(i){hash+='\n'+i+':'+this;});}else{for(var i in data){hash+='\n'+i+':'+data[i];};}}
break;case'function':hash+='\n'+i+'()';break;case'string':hash+='"'+data+'"';break;case'number':hash+=data;break;case'boolean':hash+=data?'TRUE':'FALSE';break;case'undefined':hash+='UNDEFINED';break;default:hash+=typeof data;}
return hash;},describe:function(data){self.log(self.hash(data));},regKey:function(){document.console=self;document.addEvent('keydown',function(event){event=DOM.event(event);if(event.ctrlKey){switch(event.key()){case 96:if(!OPERA){break;}
case 192:document.console.toggle();break;}}});},handleErrors:function(flag){try{if(flag=='undefined'){flag=true;}
if(flag){if(!window.Console){window.Console=self;}
window._onerror=window.onerror;window.onerror=function(message,url,line){window.Console.error(message+' (<a href="'+url+'">'+url+'</a> #'+line+')');return false;}}else{if(window._onerror instanceof Function){window.onerror=window._onerror;}}}catch(e){}}});document.addLoader(function(){window.Console=new Mohawk.UI.Console();window.Console.append();window.Console.regKey();window.Console.handleErrors(false);});Mohawk.UI.Progress=new Class({element:null,text:null,loading:false,__construct:function(){var element=document.createElement('DIV');element.id='progress';self.element=element;self.element.onmouseover=function(){if(!self.loading){self.element.collapse(Mohawk.Effects.vanish);}}
var text=document.createElement('P');element.appendChild(text);self.text=text;self.element.collapse();},appendTo:function(node){node.appendChild(self.element);},append:function(){self.appendTo(document.body);},load:function(text){self.element.display();Mohawk.Dragdrop.bringToFront(self.element);self.text.innerHTML=text;self.text.addClass('active');self.loading=true;},done:function(text,hide){self.element.display();Mohawk.Dragdrop.bringToFront(self.element);self.text.setHTML(text);self.text.removeClass('active');if(hide){self.element.collapse(Mohawk.Effects.vanish);}
self.loading=false;}});document.addLoader(function(){window.Progress=new Mohawk.UI.Progress;Progress.append();});window.Auth=new Authorization;
window.MOBILE_NUMBER="<div class=\"wrapper\">"+"\n    <div class=\"container\">"+"\n        <div class=\"input\">"+"\n            <input class=\"mobile-number-input\" />"+"\n            <button type=\"button\" class=\"mode\" onclick=\"Mobile.Number.mode()\">+</button>"+"\n            <a href=\"#backspace\" onclick=\"Mobile.Number.backspace(); return false;\" class=\"backspace\"><img src=\"{%URL.img}site/backspace.png\" alt=\"&rarr;\" /></a>"+"\n        </div>"+"\n        <table class=\"keypad\">"+"\n            <tr>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.inp('7')\">7</button></td>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.inp('8')\">8</button></td>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.inp('9')\">9</button></td>"+"\n            </tr>"+"\n            <tr>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.inp('4')\">4</button></td>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.inp('5')\">5</button></td>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.inp('6')\">6</button></td>"+"\n            </tr>"+"\n            <tr>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.inp('1')\">1</button></td>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.inp('2')\">2</button></td>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.inp('3')\">3</button></td>"+"\n            </tr>"+"\n            <tr>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.sign()\">&plusmn;</button></td>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.inp('0')\">0</button></td>"+"\n                <td><button type=\"button\" onclick=\"Mobile.Number.dec('.')\">.</button></td>"+"\n            </tr>"+"\n        </table>"+"\n        <div class=\"buttons\">"+"\n            <button type=\"button\" onclick=\"Mobile.Number.save();\">OK</button>"+"\n            <button type=\"button\" onclick=\"Mobile.Number.hide();\">Cancel</button>"+"\n            <a href=\"#clear\" class=\"clear\" onclick=\"Mobile.Number.clear(); return false;\"><img src=\"{%URL.img}site/trash.png\" alt=\"Clear\" /></a>"+"\n        </div>"+"\n    </div>"+"\n</div>";window.MobileNumber=new Class({__construct:function(){var element=DOM.element('DIV');element.addClass('hidden');self.element=element;element.setHTML(Template.transform(MOBILE_NUMBER));self.input=self.element.getElementsByClassName('mobile-number-input')[0];self.mode_indicator=self.element.getElementsByClassName('mode')[0];},inp:function(str){var value=self.input.value;value+=str;self.input.value=value;},dec:function(str){var value=self.input.value;if(value.indexOf('.')==-1){if(!value.length){value=0;}
value+='.';}
self.input.value=value;},sign:function(){var value=self.input.value;value=-value;self.input.value=value;},backspace:function(){var value=self.input.value;value=value.substr(0,value.length-1);self.input.value=value;},save:function(){self.hide();var input_value=parseFloat(self.input.value);if(isNaN(input_value)){return;}
var goal_value=parseFloat(Data.goals[self.goal_id].data.value||0);var total_value=0;if(self.mode_indicator.innerHTML=='+'){total_value=goal_value+input_value;}else if(self.mode_indicator.innerHTML=='-'){total_value=goal_value-input_value;}else{total_value=input_value;}
Mobile.setValue(self.goal_id,total_value);Data.goals[self.goal_id].data.value=total_value;Mobile.save(self.goal_id);},clear:function(){self.hide();Mobile.setValue(self.goal_id,'');Data.goals[self.goal_id].data.value='';Mobile.save(self.goal_id);},show:function(id){self.goal_id=id;self.input.value='';self.mode_indicator.innerHTML='+';Shadow.show();self.element.removeClass('hidden');Dragdrop.bringToFront(self.element);},mode:function(){if(self.mode_indicator.innerHTML=='+'){self.mode_indicator.innerHTML='=';}else if(self.mode_indicator.innerHTML=='='){self.mode_indicator.innerHTML='-';}else{self.mode_indicator.innerHTML='+';}},hide:function(){Shadow.hide();self.element.addClass('hidden');}});window.Shadow=new Singletone({element:null,__construct:function(){var shadow=document.createElement('DIV');shadow.addClass('hidden');shadow.id='shadow';self.element=shadow;},init:function(){document.body.appendChild(self.element);},hide:function(){self.element.addClass('hidden');},show:function(){self.element.removeClass('hidden');self.element.style.height=(document.body.scrollHeight||document.documentElement.scrollHeight)+'px';window.scrollTo(0,0);Dragdrop.bringToFront(self.element);}});document.addLoader(function(){if(document.body.id!='mobile-page'){return;}
window.Mobile=new Singletone({__construct:function(){self.Number=new MobileNumber;self.Number.element.id='mobile-number';self.Number.element.appendTo(document.body);Shadow.element.appendTo(document.body);self.date=Data.today;},input:function(id){var goal=Data.goals[id];if(!goal){return;}
switch(goal.type){case'numeric':Mobile.Number.show(id);break;case'boolean':self.iterate(id);break;case'counter':self.increment(id);break;case'time':case'timer':try{var h=document.getElementsByName('data['+id+'][h]')[0].value;var m=document.getElementsByName('data['+id+'][m]')[0].value;var s=document.getElementsByName('data['+id+'][s]')[0].value;goal.data.value=h*3600+m*60+s*1;self.save(id);}catch(e){console.log(e);}
break;}},save:function(id){var req=new Ajax(URL.home+'api/goals/'+id+'/'+self.date+'/data/',Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.ok){Progress.done('Saved',true);}else{Progress.done('Error');}};req.errorHandler=function(req){Progress.done('Handler: Error');};var data={value:Data.goals[id].data.value};req.send(data);Progress.load('Saving');},iterate:function(id){var goal=Data.goals[id];if(!goal){return;}
var row=ID('goal-'+id);if(!row){return;}
var cell=row.getElementsByTagName('TD')[0];var button=row.getElementsByClassName('add')[0].firstTag('BUTTON');var img=cell.firstTag('IMG');if(goal.data.value===1){img.src=goal.icon_false;img.removeClass('hidden');button.addClass('hidden');goal.data.value=0;}else if(goal.data.value===0){img.addClass('hidden');button.removeClass('hidden');goal.data.value='';}else{img.src=goal.icon_true;img.removeClass('hidden');button.addClass('hidden');goal.data.value=1;}
self.save(id);},decrement:function(id){var goal=Data.goals[id];if(!goal){return;}
var row=ID('goal-'+id);if(!row){return;}
var cell=row.getElementsByTagName('TD')[0];var button=row.getElementsByClassName('add')[0].firstTag('BUTTON');var img=cell.firstTag('IMG');if(!img){return;}
img.purge();goal.data.value-=1;self.save(id);},increment:function(id,no_save){var goal=Data.goals[id];if(!goal){return;}
var row=ID('goal-'+id);if(!row){return;}
var cell=row.getElementsByTagName('TD')[0];var button=row.getElementsByClassName('add')[0].firstTag('BUTTON');var img=DOM.element('IMG');img.src=goal.icon_item;img.appendTo(cell);img.onclick=function(){self.decrement(id);};goal.data.value+=1;self.save(id);},setValue:function(id,value){var goal=Data.goals[id];if(!goal){return;}
var row=ID('goal-'+id);if(!row){return;}
var cell=row.getElementsByTagName('TD')[0];var button=row.getElementsByClassName('add')[0].firstTag('BUTTON');switch(goal.type){case'numeric':var label=cell.firstTag('BIG');if(!label){label=DOM.element('BIG');label.onclick=function(){Mobile.Number.show(id);};cell.setChild(label);}
label.setHTML(value);if(value===''){button.removeClass('hidden');}else{button.addClass('hidden');}
break;case'boolean':var img=cell.firstTag('IMG');if(!img){img=DOM.element('IMG');cell.setChild(img);cell.onclick=function(){self.iterate(id);};}
if(value===1){img.src=goal.icon_true;img.removeClass('hidden');button.addClass('hidden');}else if(goal.data.value===0){img.src=goal.icon_false;img.removeClass('hidden');button.addClass('hidden');}else{img.addClass('hidden');button.removeClass('hidden');}
break;case'counter':cell.purgeChildren();for(var i=0;i<value&&i<100;i++){var img=DOM.element('IMG');img.src=goal.icon_item;img.appendTo(cell);img.onclick=function(){self.decrement(id);};}
break;}}});foreach(Data.goals,function(i,goal){var value=goal.data.value;if(goal.type=='counter'){value=parseInt(value);if(isNaN(value)){value=0;}}else if(goal.type=='numeric'){value=parseFloat(value);if(isNaN(value)){value='';}}else if(goal.type=='boolean'){value=value===''?'':(value==='1'?1:0);}
Data.goals[i].data.value=value;Mobile.setValue(i,value);});ID('goals-form').onclick=function(){return false;};ID('tab-select').onchange=function(){var tab=this.value;foreach(ID('goals-table').tBodies[0].getElementsByTagName('tr'),function(i,row){if(!tab||row.hasClass('tab-'+tab)){row.removeClass('hidden');}else{row.addClass('hidden');}});};});